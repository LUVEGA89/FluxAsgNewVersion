@{
    ViewBag.Title = "Precios";
}
<style>
        #reference-table {
            z-index: 99;
            display: none;
            right: 0px;
            position: absolute;
            height: auto;
        }

        .direct-chat-messages {
            -webkit-transform: translate(0, 0);
            -ms-transform: translate(0, 0);
            -o-transform: translate(0, 0);
            transform: translate(0, 0);
            padding: 10px;
            height: 500px;
            overflow: auto;
        }
        /*
        #reference-table{
        z-index:99;
        width:auto;
        height:auto;
        display:none;
        position:absolute;
        left:auto;
        right:auto;
        top:0 auto;
    }

    .reference-table {
        border-style: solid;
        border-width: 5px;
    }
            */
</style>
<section class="content-header">
    <h1>
        Productos
        <small>Aprobación de Precios</small>
    </h1>
    <ol class="breadcrumb">
        <li><a href="#"><i class="fa fa-dashboard"></i> Productos </a></li>
        <li class="active"> Precios</li>
        <li class="active"> APG</li>
    </ol>
</section>

<section class="content">

    <div class="row">

        <div class="col-md-3" id="reference-table">

            <div class="box box-danger direct-chat direct-chat-danger">
                <div class="box-header with-border">
                    <h3 class="box-title">Busqueda de referencias</h3>
                    <div class="box-tools pull-right">
                        <button type="button" class="btn btn-box-tool" data-widget="collapse">
                            <i class="fa fa-minus"></i>
                        </button>
                        <!--<button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>-->
                    </div>
                </div>
                <div class="box-body">
                    <div class="direct-chat-messages">
                        <div class="direct-chat-msg">
                            <div class="box box-custom">
                                <table class="table table-bordered">
                                    <thead>
                                        <tr>
                                            <th style="width: 10px">SKU</th>
                                            <th style="width: 30px">LISTA</th>
                                            <th style="width: 20px">PRECIOS CON IVA</th>
                                        </tr>
                                    </thead>
                                    <tbody id="table-search-reference"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="box-footer">
                    <form action="#" method="post">
                        <div class="input-group">
                            <input name="message" placeholder="Referencia ..." class="form-control" id="txt-search-reference" type="text">
                            <span class="input-group-btn">
                                <button type="submit" class="btn btn-success btn-flat" id="btn-search-reference">Buscar</button>
                            </span>
                        </div>
                    </form>
                </div>

            </div>

        </div>

        <div class="box box-danger">
            <div id="loading-sap-update" style="display:none;" class="overlay">
                <i class="fa fa fa-refresh fa-spin"></i>

                <h4 class="text-center">Sincronizando a SAP.....</h4>
            </div>
            <div class="box-header">
                <i class="fa fa-level-down"></i>
                <h3 class="box-title">Lista de precios para su aprobación</h3>
                <div style="right: 81px;" class="box-tools ">
                    <div class="form-inline">
                        <div class="form-group" style="display:none;">
                            <div class="input-group">
                                <div class="input-group-addon">
                                    <i class="glyphicon glyphicon-calendar"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="box-tools pull-right">
                    <button type="button" class="btn btn-box-tool" data-widget="collapse">
                        <i class="fa fa-minus"></i>
                    </button>
                    <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
                </div>
            </div>

            <div class="box-body" style="display: block;">
                <div class="table-responsive">
                    <!-----------------------------------Tabla de Aprobación de Precios------------------------------>
                    <table id="tabla-aprobadora" class="table table-bordered">
                        <thead>
                            <tr>
                                <th rowspan="2" class="aprovate-fields">SKU</th>
                                <th rowspan="2" class="aprovate-fields">Comentario</th>
                                <th rowspan="2" class="aprovate-fields">Familia</th>
                                <th rowspan="2" class="aprovate-fields">May Des</th>
                                <th rowspan="2" class="aprovate-fields">May Dis</th>
                                <th colspan="2" class="thlpp1">SAP 41</th>
                                <th colspan="2" class="colorefxhp">SAP 10</th>
                                <th colspan="3" class="thlpp1">SAP 40 <br /> ULTRA</th>
                                <th colspan="2" class="colorefxhp">SAP 39 PREMIUM</th>
                                <th colspan="2" class="thlpp1">SAP 38 EXCELENCIA</th>
                                <th colspan="3" class="colorefxhp">SAP 15</th>
                                <th colspan="3" class="thlpp1">SAP 6 <br /> Retail A</th>
                                <th colspan="3" class="colorefxhp">SAP 3 <br />Retail AA</th>
                                <th colspan="3" class="thlpp1">SAP 2<br />Retail AAA</th>
                                <th colspan="3" class="colorefxhp">Mayoreo Tiendas Locales 33</th>
                                <th colspan="3" class="thlpp1">Mayoreo Foraneas 25</th>
                                <th colspan="3" class="colorefxhp">Publico Suc 14</th>
                                <th colspan="3" class="thlpp1">Mayoreo WEB 48</th>
                                <th colspan="3" class="colorefxhp">Publico WEB 47</th>
                                <th colspan="3" class="thlpp1">Mayoreo Franquicias 29 </th>
                                <th colspan="3" class="colorefxhp">Publico Franquicias 28</th>
                                <th colspan="3" class="thlpp1">Distribuidor Local 22</th>
                                <th colspan="3" class="colorefxhp">Distribuidor Foraneo 42</th>
                                <th rowspan="2" class="thlpp1">Fecha Modificación</th>
                            </tr>
                            <tr class="thlppc">
                                <!-------------------SAP 41-------------------->
                                <th class="coloref">SAP</th>
                                <th class="coloref">PRO</th>
                                <!-------------------SAP 10-------------------->
                                <th class="colorefxp">SAP</th>
                                <th class="colorefxp">PRO</th>
                                <!-------------------SAP 40-------------------->
                                <th class="coloref">SAP</th>
                                <th class="coloref">PRO</th>
                                <th class="coloref">MARGEN</th>
                                <!-------------------SAP 39-------------------->
                                <th class="colorefxp">SAP</th>
                                <th class="colorefxp">PRO</th>
                                <!-------------------SAP 38-------------------->
                                <th class="coloref">SAP</th>
                                <th class="coloref">PRO</th>
                                <!-------------------SAP 15-------------------->
                                <th class="colorefxp">SAP</th>
                                <th class="colorefxp">PRO</th>
                                <th class="colorefxp">MARGEN</th>
                                <!-------------------SAP 3--------------------->
                                <th class="coloref">SAP </th>
                                <th class="coloref">PRO</th>
                                <th class="coloref">MARGEN</th>
                                <!-------------------SAP 6--------------------->
                                <th class="colorefxp">SAP</th>
                                <th class="colorefxp">PRO</th>
                                <th class="colorefxp">MARGEN</th>
                                <!-------------------SAP 2--------------------->
                                <th class="coloref">SAP</th>
                                <th class="coloref">PRO</th>
                                <th class="coloref">MARGEN</th>
                                <!---------Mayoreo Tiendas Locales 33----------->
                                <th class="colorefxp">SAP</th>
                                <th class="colorefxp">PRO</th>
                                <th class="colorefxp">MARGEN</th>
                                <!-----------Mayoreo Foraneas 25---------------->
                                <th class="coloref">SAP</th>
                                <th class="coloref">PRO</th>
                                <th class="coloref">MARGEN</th>
                                <!---------------Publico Suc 14------------------>
                                <th class="colorefxp">SAP</th>
                                <th class="colorefxp">PRO</th>
                                <th class="colorefxp">MARGEN</th>
                                <!---------------Mayoreo WEB 48------------------>
                                <th class="coloref">SAP</th>
                                <th class="coloref">PRO</th>
                                <th class="coloref">MARGEN</th>
                                <!-----------------Publico WEB 47---------------->
                                <th class="colorefxp">SAP</th>
                                <th class="colorefxp">PRO</th>
                                <th class="colorefxp">MARGEN</th>
                                <!------------Mayoreo Franquicias 29------------->
                                <th class="coloref">SAP</th>
                                <th class="coloref">PRO</th>
                                <th class="coloref">MARGEN</th>
                                <!-------------Publico Franquicias 28------------>
                                <th class="colorefxp">SAP</th>
                                <th class="colorefxp">PRO</th>
                                <th class="colorefxp">MARGEN</th>
                                <!---------Distribuidor 22----------->
                                <th class="coloref">SAP</th>
                                <th class="coloref">PRO</th>
                                <th class="coloref">MARGEN</th>
                                <!---------Distribuidor 42----------->
                                <th class="colorefxp">SAP</th>
                                <th class="colorefxp">PRO</th>
                                <th class="colorefxp">MARGEN</th>
                            </tr>
                        </thead>
                        <tbody id="aprobar-lista-precios"></tbody>
                    </table>
                    <div class="form-group pull-right">
                        <div id="rechazar-propuestas" class="btn btn-danger btn-block">Rechazar todo</div>
                    </div>

                    <div class="form-group pull-left">
                        <div id="aprobar-propuestas" class="btn btn-success btn-block">Aprobar todo</div>
                    </div>

                </div>
                <div class="form-group pull-left">
                    <div id="update-sap" class="btn btn-success btn-block">Sincronizar a SAP</div>
                </div>

            </div>
        </div>
    </div>

    <div class="box box-danger">
        <div class="box-header">
            <i class="fa fa-level-down"></i>
            <h3 class="box-title"></h3>
            <div style="right: 81px;" class="box-tools ">
                <div class="form-inline">
                    <div class="form-group" style="display:none;">
                        <div class="input-group">
                            <div class="input-group-addon">
                                <i class="glyphicon glyphicon-calendar"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="box-tools pull-right">
                <button type="button" class="btn btn-box-tool" data-widget="collapse">
                    <i class="fa fa-minus"></i>
                </button>
                <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
            </div>
        </div>
        <div class="box-body" style="display: block;">
            <div class="table-responsive">
                <!-----------------------------------Tabla de Precios Modificados------------------------------>
                <table id="precios-modificados-all" class="table table-bordered stripe hover order-column row-border">
                    <thead>
                        <tr>
                            <th rowspan="2" class="aprovate-fields">Estatus</th>
                            <th rowspan="2" class="aprovate-fields">SKU</th>
                            <th rowspan="2" class="aprovate-fields">Comentario</th>
                            <th rowspan="2" class="aprovate-fields">Familia</th>
                            <th rowspan="2" class="aprovate-fields">May Des</th>
                            <th rowspan="2" class="aprovate-fields">May Dis</th>
                            <th colspan="2" class="thlpp1">SAP CMex</th>
                            <th colspan="2" class="colorefxhp">SAP 10</th>
                            <th colspan="2" class="thlpp1">SAP 40 <br /> ULTRA</th>
                            <th colspan="2" class="colorefxhp">SAP 39 PREMIUM</th>
                            <th colspan="2" class="thlpp1">SAP 38 EXCELENCIA</th>
                            <th colspan="2" class="colorefxhp">SAP 15</th>
                            <th colspan="2" class="thlpp1">SAP 6<br /> Retail A</th>
                            <th colspan="2" class="colorefxhp">SAP 3 <br />Reatil AA</th>
                            <th colspan="2" class="thlpp1">SAP 2 <br />Reatil AAA</th>
                            <th colspan="2" class="colorefxhp">Mayoreo Tiendas Locales 33</th>
                            <th colspan="2" class="thlpp1">Mayoreo Foraneas 25</th>
                            <th colspan="2" class="colorefxhp">Publico Suc 14</th>
                            <th colspan="2" class="thlpp1">Mayoreo WEB 48</th>
                            <th colspan="2" class="colorefxhp">Publico WEB 47</th>
                            <th colspan="2" class="thlpp1">Mayoreo Franquicias 29</th>
                            <th colspan="2" class="colorefxhp">Publico Franquicias 28</th>
                            <th colspan="2" class="thlpp1">Distribuidor Local 22</th>
                            <th colspan="2" class="colorefxhp">Distribuidor Foraneo 42</th>
                            <th rowspan="2" class="thlpp1">Fecha Modificación</th>
                        </tr>
                        <tr class="thlppc">

                            <th class="thlpp">SAP</th>
                            <th class="thlpp">PRO</th>

                            <th class="colorefxp">SAP</th>
                            <th class="colorefxp">PRO</th>

                            <th class="thlpp">SAP</th>
                            <th class="thlpp">PRO</th>

                            <th class="colorefxp">SAP</th>
                            <th class="colorefxp">PRO</th>

                            <th class="thlpp">SAP</th>
                            <th class="thlpp">PRO</th>

                            <th class="colorefxp">SAP</th>
                            <th class="colorefxp">PRO</th>

                            <th class="thlpp">SAP</th>
                            <th class="thlpp">PRO</th>

                            <th class="colorefxp">SAP</th>
                            <th class="colorefxp">PRO</th>

                            <th class="thlpp">SAP</th>
                            <th class="thlpp">PRO</th>

                            <th class="colorefxp">SAP</th>
                            <th class="colorefxp">PRO</th>

                            <th class="thlpp">SAP</th>
                            <th class="thlpp">PRO</th>

                            <th class="colorefxp">SAP</th>
                            <th class="colorefxp">PRO</th>

                            <th class="thlpp">SAP</th>
                            <th class="thlpp">PRO</th>

                            <th class="colorefxp">SAP</th>
                            <th class="colorefxp">PRO</th>

                            <th class="thlpp">SAP</th>
                            <th class="thlpp">PRO</th>

                            <th class="colorefxp">SAP</th>
                            <th class="colorefxp">PRO</th>

                            <th class="thlpp">SAP</th>
                            <th class="thlpp">PRO</th>

                            <th class="colorefxp">SAP</th>
                            <th class="colorefxp">PRO</th>


                        </tr>
                    </thead>
                    <tbody id="bodyPreciosModificacos" ></tbody>
                </table>
                <div class="clearfix"></div>
                <div class="form-group pull-left">
                    <div id="mandar-solicitud" class="btn btn-success btn-block">Mandar para su aprobación</div>
                </div>
            </div>
        </div>
    </div>



    <div class="modal fade" id="myModal2" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title">Nueva Familia</h4>
                </div>
                <div class="modal-body">
                    <form class="form-horizontal" onsubmit="required()">
                        <div class="box-body">
                            <div class="form-group">
                                <label class="col-sm-2 control-label">Familia</label>
                                <div class="col-sm-10">
                                    <input class="form-control" id="input-familia" placeholder="Nombre" type="text" autocomplete="off" required />
                                </div>
                            </div>
                        </div>
                        <div class="box-body">
                            <div class="form-group">
                                <label class="col-sm-2 control-label">Piezas Mayoreo</label>
                                <div class="col-sm-10">
                                    <input class="form-control" id="input-mayoreo" placeholder="Mayoreo" type="number" onkeypress="return isNumberKey(event)" autocomplete="off" required />
                                </div>
                            </div>
                        </div>
                        <div class="box-body">
                            <div class="form-group">
                                <label class="col-sm-2 control-label">Piezas Mayoreo Corporativo</label>
                                <div class="col-sm-10">
                                    <input class="form-control" id="input-mayoreo-crpo" placeholder="Mayoreo Crpo" type="number" onkeypress="return isNumberKey(event)" autocomplete="off" required />
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="submit" id="insertar-familia" class="btn btn-primary pull-right">Nueva Familia</button>
                    <button type="button" class="btn btn-default pull-right" data-dismiss="modal">Cancelar</button>
                </div>
            </div>
        </div>
    </div>

    @*tabla para correos cuando los  precios modificados sean por el usario de precios*@
    <div style="display:none" id='correoAprobacionUsuarioPrecios'>
        <table id='tablaCorreoUno' style='text-align:center;font-family: arial, sans-serif; border-collapse: collapse; width: 100%;'>
            <thead>
                <tr style='border: 1px solid black; text-align:center; background-color: rgb(221, 75, 57); color:#FFFFFF'>
                    <th width="20%">SKU</th>
                    <th width="12%">ULTRA c/IVA</th>
                    <th width="12%">PREMIUM c/IVA</th>
                    <th width="12%">EXCELENCIA c/IVA</th>
                    <th width="12%">COMENTARIOS</th>
                </tr>
            </thead>
            <tbody id='bodyCorreoUno'></tbody>
        </table>
    </div>

    @*tabla para correos cuando los  precios modificados sean por el usario de Rafa (ADMIN)*@
    <div style="display:none" id='correoAprobacionUsuarioAdmin'>
        <table id='tablaCorreoDos' style='text-align:center; font-family: arial, sans-serif; border-collapse: collapse; width: 100%;'>
            <thead>
                <tr style='border: 1px solid black; text-align:center; background-color: rgb(221, 75, 57); color:#FFFFFF'>
                    <th width="10%">SKU</th>
                    <th width="10%">Tipo de precio</th>
                    <th width="10%">Mayoreo Locales</th>
                    <th width="10%">Mayoreo Foraneas</th>
                    <th width="10%">Publico Sucursales</th>
                    <th width="10%">Mayoreo Web</th>
                    <th width="10%">Publico Web</th>
                    <th width="10%">Mayoreo Franquicia</th>
                    <th width="10%">Publico Franquicia</th>
                    <th width="10%">Distribuidor Local</th>
                    <th width="10%">Distribuidor Foraneo</th>
                </tr>
            </thead>
            <tbody id='bodyCorreoDos'></tbody>
        </table>
    </div>


</section>
<script type="text/javascript">

//Tablas para envio de aprobacion de una sola fila, la etiqueta de cierre de tabla Se agrega al estructurar el correo

    var estructuraTablaCorreoDos = " <table style=' text-align: center; font-family: arial, sans-serif; border-collapse: collapse; width: 100%;'>"+
                                    "<thead>"+
                                    "<tr style='border: 1px solid black; text-align:center; background-color: rgb(221, 75, 57); color:#FFFFFF'>"+
                                        "<th width='9%'>SKU</th>"+
                                        "<th width='9%'>Tipo Precio</th>"+
                                        "<th width='9%'>Mayoreo Locales</th>"+
                                        "<th width='9%'>Mayoreo Foraneas</th>"+
                                        "<th width='9%'>Publico Sucursales</th>"+
                                        "<th width='9%'>Mayoreo Web</th>"+
                                        "<th width='9%'>Publico Web</th>"+
                                        "<th width='9%'>Mayoreo Franquicia</th>"+
                                        "<th width='9%'>Publico Franquicia</th>"+
                                        "<th width='9%'>Distribuidor local</th>"+
                                        "<th width='9%'>Distribuidor Foraneo</th>"+
                                    "</tr>"+
                                        "</thead >"+
                                    "<tbody ></tbody>";
    var estructuraTablaCorreoUno = "<table  style='text-align:center; font-family: arial, sans-serif; border-collapse: collapse; width: 100%;'>"+
                                    "<thead>"+
                                        "<tr style='border: 1px solid black; text-align:center; background-color: rgb(221, 75, 57); color:#FFFFFF'>"+
                                            "<th width='34%'>SKU:</th>"+
                                            "<th width='12%'>ULTRA c/IVA </th>"+
                                            "<th width='12%'>PREMIUM c/IVA </th>"+
                                            "<th width='12%'>EXCELENCIA c/IVA </th>"+
                                            "<th width='12%'>COMENTARIOS </th>"+
                                        "</tr>"+
                                    "</thead>"+
                                    "<tbody ></tbody>";

    //Busca la lista de precios por item cod

    $("#mandar-solicitud").hide();

    //Consigue todos los estados de precios actuales
    function onLoadPrecioModificados() {
        $('#bodyPreciosModificacos').empty();
        $.post('@Url.Action("ObtenerTodosPreciosEstadosAll", "Precios")', {
        }, function (data) {
            if (data != null && $.isArray(data.Context)) {
                $.each(data.Context, function (index, value) {
                    if (value.Comentario == '') {
                        value.Comentario = 'Sin comentario'
                    }
                    var t = $('#precios-modificados-all').DataTable();
                    t.row.add([
                        '<td id="Modificado">' + value.Estatus + '</td>',
                        '<td class="nr">' + value.ItemCode + '</td>',
                        '<td>' + value.Comentario + '</td>',
                        '<td><div id="td-ar-familiac-' + index + '" ><input type="text" id="nombre-familiac-' + index + '" class="nombre-familia-class" value="' + value.Familia + '" disabled>\<input type="text" id="estatus-familiac-' + index + '" style="display:none" value="' + value.EstatusFamilia + '"></div></td>',
                        '<td>' + value.MayoreoDesde + '</td>',
                        '<td>' + value.MayoreoDistribuidorDesde + '</td>',
                        '<td>' + formatNumber.new(value.ListaCMex_Sap.toFixed(2), "$ ") + '</td>',
                        '<td>' + formatNumber.new(value.ListaCMex.toFixed(2), "$ ") + '</td>',
                        '<td>' + formatNumber.new(value.Lista10_Sap.toFixed(2), "$ ") + '</td>',
                        '<td>' + formatNumber.new(value.Lista10.toFixed(2), "$ ") + '</td>',
                        '<td>' + formatNumber.new(value.Lista40_Sap.toFixed(2), "$ ") + '</td>',
                        '<td>' + formatNumber.new(value.Lista40.toFixed(2), "$ ") + '</td>',
                        '<td>' + formatNumber.new(value.Lista39_Sap.toFixed(2), "$ ") + '</td>',
                        '<td>' + formatNumber.new(value.Lista39.toFixed(2), "$ ") + '</td>',
                        '<td>' + formatNumber.new(value.Lista38_Sap.toFixed(2), "$ ") + '</td>',
                        '<td>' + formatNumber.new(value.Lista38.toFixed(2), "$ ") + '</td>',
                        '<td>' + formatNumber.new(value.Lista15_Sap.toFixed(2), "$ ") + '</td>',
                        '<td>' + formatNumber.new(value.Lista15.toFixed(2), "$ ") + '</td>',
                        '<td>' + formatNumber.new(value.Lista6_Sap.toFixed(2), "$ ") + '</td>',
                        '<td>' + formatNumber.new(value.Lista6.toFixed(2), "$ ") + '</td>',
                        '<td>' + formatNumber.new(value.Lista3_Sap.toFixed(2), "$ ") + '</td>',
                        '<td>' + formatNumber.new(value.Lista3.toFixed(2), "$ ") + '</td>',
                        '<td>' + formatNumber.new(value.Lista2_Sap.toFixed(2), "$ ") + '</td>',
                        '<td>' + formatNumber.new(value.Lista2.toFixed(2), "$ ") + '</td>',
                        '<td>' + formatNumber.new(value.Lista33_Sap.toFixed(2), "$ ") + '</td>',
                        '<td>' + formatNumber.new(value.Lista33.toFixed(2), "$ ") + '</td>',
                        '<td>' + formatNumber.new(value.Lista25_Sap.toFixed(2), "$ ") + '</td>',
                        '<td>' + formatNumber.new(value.Lista25.toFixed(2), "$ ") + '</td>',
                        '<td>' + formatNumber.new(value.Lista14_Sap.toFixed(2), "$ ") + '</td>',
                        '<td>' + formatNumber.new(value.Lista14.toFixed(2), "$ ") + '</td>',
                        '<td>' + formatNumber.new(value.Lista48_Sap.toFixed(2), "$ ") + '</td>',
                        '<td>' + formatNumber.new(value.Lista48.toFixed(2), "$ ") + '</td>',
                        '<td>' + formatNumber.new(value.Lista47_Sap.toFixed(2), "$ ") + '</td>',
                        '<td>' + formatNumber.new(value.Lista47.toFixed(2), "$ ") + '</td>',
                        '<td>' + formatNumber.new(value.Lista29_Sap.toFixed(2), "$ ") + '</td>',
                        '<td>' + formatNumber.new(value.Lista29.toFixed(2), "$ ") + '</td>',
                        '<td>' + formatNumber.new(value.Lista28_Sap.toFixed(2), "$ ") + '</td>',
                        '<td>' + formatNumber.new(value.Lista28.toFixed(2), "$ ") + '</td>',
                        '<td>' + formatNumber.new(value.Lista22_Sap.toFixed(2), "$ ") + '</td>',
                        '<td>' + formatNumber.new(value.Lista22.toFixed(2), "$ ") + '</td>',
                        '<td>' + formatNumber.new(value.Lista42_Sap.toFixed(2), "$ ") + '</td>',
                        '<td>' + formatNumber.new(value.Lista42.toFixed(2), "$ ") + '</td>',
                        '<td>' + value.FechaModificacion + '</td>'
                    ]).draw(false);
                });
            } else {
                swal("Error en la api: Obtener Precios Modificados");
            }
        });
    }
    onLoadPrecioModificados();



    //CARGA APROBACION DE MODIFICADOS
    function onLoadAprovarPreciosModificados() {
        $.post('@Url.Action("ObtenerEstatusTresAll", "Precios")', {
        }, function (data) {
            if (data != null && $.isArray(data.Context)) {
                $("#aprobar-lista-precios").html('');
                $.each(data.Context, function (index, value) {
                    let stringCorreo = value.UsuarioModificador

                    $("#aprobar-lista-precios").append(
                        "<tr class='Listas'>\
                            <td>\
                                <input type='text' class='Listax' id='keySelected-1-"+index+"' value='"+value.ItemCode+"' disabled/>\
                                <div class='btn-group'>\
                                  <button type='button' class='btn btn-danger' onclick='return RejectOneRowPriceList(\"" + value.UsuarioModificador + "\"" + "," + index +  ")'><i class='fa  fa-thumbs-down'></i></button>\
                                  <button type='button' class='btn btn-success' onclick='return AproveOneRowPriceList(\"" + value.UsuarioModificador + "\""+ "," +index+")' ><i class='fa fa-thumbs-up'></i></button>\
                                </div>\
                            </td>\
                            <td><textarea id='comentario-"+index+"' rows='1' cols='10'></textarea></td>\
                            <td id='td-ar-familia-"+index+"'>\
                                <input type='text' id='nombre-familiaz' class='nombre-familia-class' value='"+value.Familia+"' disabled>\
                                <input type='text' id='estatus-familia-"+index+"' style='display:none' value='" + value.EstatusFamilia + "' disabled>\
                                <input type='hidden' id='idModificacion-"+ index + "' style='display:none' value='" + value.IdModificacion + "' disabled>\
                                <div class='btn-group'>\
                                    <button type='button' class='btn btn-danger' id='button-reject-famiy-"+index+"' onclick='return RejectFamily(" + index + ")' ><i class='fa fa-thumbs-down'></i></button>\
                                    <button type='button' class='btn btn-success' id='button-aprove-famiy-" + index + "' onclick='return AproveFamily(" + index + ")' ><i class='fa fa-thumbs-up'></i></button>\
                                </div>\
                            </td>\
                            <td>" + value.MayoreoDesde + "</td>\
                            <td>" + value.MayoreoDistribuidorDesde + "</td>\
                            <td class='under-price-41-" + index + " colore'>" + formatNumber.new(value.ListaCMex_Sap.toFixed(2), "$ ") + "</td>\
                            <td class='under-price-41-" + index + " colore'>" + formatNumber.new(value.ListaCMex.toFixed(2), "$ ") + "</td>\
                            <td class='under-price-10-" + index + " colorefp'>" + formatNumber.new(value.Lista10_Sap.toFixed(2), "$ ") + "</td>\
                            <td class='under-price-10-" + index + " colorefp'>" + formatNumber.new(value.Lista10.toFixed(2), "$ ") + "</td>\
                            <td class='under-price-40-" + index + " colore'>" + formatNumber.new(value.Lista40_Sap.toFixed(2), "$ ") + "</td>\
                            <td class='under-price-40-" + index + " colore'>" + formatNumber.new(value.Lista40.toFixed(2), "$ ") + "</td>\
                            <td class='under-price-40-" + index + " colore'>" + formatNumber.new(value.Mbvsstgp_40.toFixed(2), "% ") + "</td>\
                            <td class='under-price-39-" + index + " colorefp'>" + formatNumber.new(value.Lista39_Sap.toFixed(2), "$ ") + "</td>\
                            <td class='under-price-39-" + index + " colorefp'>" + formatNumber.new(value.Lista39.toFixed(2), "$ ") + "</td>\
                            <td class='under-price-38-" + index + " colore'>" + formatNumber.new(value.Lista38_Sap.toFixed(2), "$ ") + "</td>\
                            <td class='under-price-38-" + index + " colore'>" + formatNumber.new(value.Lista38.toFixed(2), "$ ") + "</td>\
                            <td class='under-price-15-" + index + " colorefp'>" + formatNumber.new(value.Lista15_Sap.toFixed(2), "$ ") + "</td>\
                            <td class='under-price-15-" + index + " colorefp'>" + formatNumber.new(value.Lista15.toFixed(2), "$ ") + "</td>\
                            <td class='under-price-15-" + index + " colorefp'>" + formatNumber.new(value.Mbvsstgp_15.toFixed(2), "% ") + "</td>\
                            <td class='under-price-15-" + index + " colore'>" + formatNumber.new(value.Lista6_Sap.toFixed(2), "$ ") + "</td>\
                            <td class='under-price-15-" + index + " colore'>" + formatNumber.new(value.Lista6.toFixed(2), "$ ") + "</td>\
                            <td class='under-price-15-" + index + " colore'>" + formatNumber.new(value.Mbvsstgp_6.toFixed(2), "% ") + "</td>\
                            <td class='under-price-15-" + index + " colorefp'>" + formatNumber.new(value.Lista3_Sap.toFixed(2), "$ ") + "</td>\
                            <td class='under-price-15-" + index + " colorefp'>" + formatNumber.new(value.Lista3.toFixed(2), "$ ") + "</td>\
                            <td class='under-price-15-" + index + " colorefp'>" + formatNumber.new(value.Mbvsstgp_3.toFixed(2), "% ") + "</td>\
                            <td class='under-price-15-" + index + " colore'>" + formatNumber.new(value.Lista2_Sap.toFixed(2), "$ ") + "</td>\
                            <td class='under-price-15-" + index + " colore'>" + formatNumber.new(value.Lista2.toFixed(2), "$ ") + "</td>\
                            <td class='under-price-15-" + index + " colore'>" + formatNumber.new(value.Mbvsstgp_2.toFixed(2), "% ") + "</td>\
                            <td class='under-price-33-" + index + " colorefp'>" + formatNumber.new(value.Lista33_Sap.toFixed(2), "$ ") + "</td>\
                            <td class='under-price-33-" + index + " colorefp'>" + formatNumber.new(value.Lista33.toFixed(2), "$ ") + "</td>\
                            <td class='under-price-33-" + index + " colorefp'>" + formatNumber.new(value.Mbvsstgp_33.toFixed(2), "% ") + "</td>\
                            <td class='under-price-25-" + index + " colore'>" + formatNumber.new(value.Lista25_Sap.toFixed(2), "$ ") + "</td>\
                            <td class='under-price-25-" + index + " colore'>" + formatNumber.new(value.Lista25.toFixed(2), "$ ") + "</td>\
                            <td class='under-price-25-" + index + " colore'>" + formatNumber.new(value.Mbvsstgp_25.toFixed(2), "% ") + "</td>\
                            <td class='under-price-14-" + index + " colorefp'>" + formatNumber.new(value.Lista14_Sap.toFixed(2), "$ ") + "</td>\
                            <td class='under-price-14-" + index + " colorefp'>" + formatNumber.new(value.Lista14.toFixed(2), "$ ") + "</td>\
                            <td class='under-price-14-" + index + " colorefp'>" + formatNumber.new(value.Mbvsstgp_14.toFixed(2), "% ") + "</td>\
                            <td class='under-price-48-" + index + " colore'>" + formatNumber.new(value.Lista48_Sap.toFixed(2), "$ ") + "</td>\
                            <td class='under-price-48-" + index + " colore'>" + formatNumber.new(value.Lista48.toFixed(2), "$ ") + "</td>\
                            <td class='under-price-48-" + index + " colore'>" + formatNumber.new(value.Mbvsstgp_48.toFixed(2), "% ") + "</td>\
                            <td class='under-price-47-" + index + " colorefp'>" + formatNumber.new(value.Lista47_Sap.toFixed(2), "$ ") + "</td>\
                            <td class='under-price-47-" + index + " colorefp'>" + formatNumber.new(value.Lista47.toFixed(2), "$ ") + "</td>\
                            <td class='under-price-47-" + index + " colorefp'>" + formatNumber.new(value.Mbvsstgp_47.toFixed(2), "% ") + "</td>\
                            <td class='under-price-29-" + index + " colore'>" + formatNumber.new(value.Lista29_Sap.toFixed(2), "$ ") + "</td>\
                            <td class='under-price-29-" + index + " colore'>" + formatNumber.new(value.Lista29.toFixed(2), "$ ") + "</td>\
                            <td class='under-price-29-" + index + " colore'>" + formatNumber.new(value.Mbvsstgp_29.toFixed(2), "% ") + "</td>\
                            <td class='under-price-28-" + index + " colorefp'>" + formatNumber.new(value.Lista28_Sap.toFixed(2), "$ ") + "</td>\
                            <td class='under-price-28-" + index + " colorefp'>" + formatNumber.new(value.Lista28.toFixed(2), "$ ") + "</td>\
                            <td class='under-price-28-" + index + " colorefp'>" + formatNumber.new(value.Mbvsstgp_28.toFixed(2), "% ") + "</td>\
                            <td class='under-price-29-" + index + " colore'>" + formatNumber.new(value.Lista22_Sap.toFixed(2), "$ ") + "</td>\
                            <td class='under-price-29-" + index + " colore'>" + formatNumber.new(value.Lista22.toFixed(2), "$ ") + "</td>\
                            <td class='under-price-29-" + index + " colore'>" + formatNumber.new(value.Mbvsstgp_22.toFixed(2), "% ") + "</td>\
                            <td class='under-price-42-" + index + " colorefp'>" + formatNumber.new(value.Lista42_Sap.toFixed(2), "$ ") + "</td>\
                            <td class='under-price-42-" + index + " colorefp'>" + formatNumber.new(value.Lista42.toFixed(2), "$ ") + "</td>\
                            <td class='under-price-42-" + index + " colorefp'>" + formatNumber.new(value.Mbvsstgp_42.toFixed(2), "% ") + "</td>\
                            <td>" + value.FechaModificacion + "</td>\
                         </tr>\>");

                        //if (value.Lista33 < value.Lista10) {
                        //    $(".under-price-33-"+index).addClass("underPrice");
                        //}
                        //if (value.Lista25 < value.Lista10) {
                        //    $(".under-price-25-"+index).addClass("underPrice");
                        //}
                        // if (value.Lista14 < value.Lista10) {
                        //    $(".under-price-14-"+index).addClass("underPrice");
                        //}
                        // if (value.Lista29_iva < value.Frn) {
                        //    $(".under-price-29-" + index).addClass("underPrice");
                        //}
                        // if (value.Lista28_iva < value.Frn) {
                        //    $(".under-price-28-"+index).addClass("underPrice");
                        //}

                        $(".hidden-price-id-11" + index).hide();
                        changeColorEstatusFamilia(index);
                });
            } else {
                swal("Error en la api: Obtener estaus aprobados ");
            }
        });
    }

    onLoadAprovarPreciosModificados();

    //CARGA LOTE RECHAZADOS PARA ENVIO DE EMAIL KEYUP
    function onLoadPreciosRechazadosEmail() {
        $.post('@Url.Action("ObtenerEstatusTresAll", "Precios")', {
        }, function (data) {
            if (data != null && $.isArray(data.Context)) {
                $.each(data.Context, function (index, value) {
                    $("#comentario-" + index).keyup(function () {
                        var comentarix = this.value;

                    });
                });

            } else {
                swal("Error en la api: Obtener precios rechazados");
            }
        });
    }
    onLoadPreciosRechazadosEmail();
    //RECHAZA LISTA DE PRECIOS OK
    function RejectOneRowPriceList(Modificador,index) {
        let UsuarioAprobador = "rafael.massorivera@fussionweb.com";
        let arregloCorreos;
        let idModificacion = $("#idModificacion-" + index).val();
        ItemCode = $("#keySelected-1-" + index).val();

        Comentario = $("#comentario-" + index).val();
        swal({
            title: "¿Estas seguro?",
            text: "Usted esta apunto de rechazar una lista de precios",
            icon: "warning",
            buttons: [
              'No, cancelar esta operación',
              'Si, estoy seguro'
            ],
            dangerMode: true,
        }).then(function (isConfirm) {
            if (isConfirm) {

                    $.ajax({
                        contentType: "application/json; charset=utf-8",
                        url: '@Url.Action("RechazarUnaListaPrecios", "Precios")',
                        async: false,
                        timeout: 3000,
                        type: 'POST',
                        data: '{"ItemCode":"' + ItemCode + '","UsuarioAprobador":"' + UsuarioAprobador + '","Comentario":"' + Comentario + '","idModificacion":"' + idModificacion + '"}',
                        dataType: "json",
                        success: function (data) {

                        },
                        error: function () {
                            swal("Error al procesar el registro");
                        }
                    });
                    let BodyEmail = "<html><body><h4>Lista de precios rechazada</h4><div>" + "El SKU rechazado: " + ItemCode + "</div><br/><div>" + Comentario + "</div><br /></body></html>";
                    let UsuarioModificador = localStorage.getItem("UserEmail");

                    if (Modificador == "rafael.massorivera@fussionweb.com@fussionweb.com") {
                        //*************************************correos Productivo**************************************************//
                        //********************************************************************************************************//
                        arregloCorreos = new Array("angel_garcia@fussionweb.com");

                        //**************************************correos Purebas***************************************************//
                        //********************************************************************************************************//
                        //arregloCorreos = new Array("armando_pena@fussionweb.com");


                    } else {
                        //*************************************correos Productivo**************************************************//
                        //********************************************************************************************************//
                        arregloCorreos = new Array("angel_garcia@fussionweb.com");

                         //**************************************correos Purebas***************************************************//
                        //********************************************************************************************************//
                       //arregloCorreos = new Array("armando_pena@fussionweb.com");

                    }

                    let FromEmail = UsuarioModificador;
                    let SubjectEmail = "Lista de precios rechazada, SKU: " + ItemCode;
                    $.ajax({
                        contentType: "application/json; charset=utf-8",
                        url: '@Url.Action("EmailListPrice", "Precios")',
                        async: false,
                        timeout: 3000,
                        type: 'POST',
                        data: '{"FromEmail":"' + FromEmail + '","SubjectEmail":"' + SubjectEmail + '","BodyEmail":"' + BodyEmail + '","listaCorreos":' + JSON.stringify(arregloCorreos) + '}',
                        dataType: "json",
                        success: function (data) {
                            swal({
                                title: 'Operación correcta',
                                text: 'Se ha enviado un correo de notificación',
                                icon: 'success',
                                buttons: false,
                                timer: 1000
                            })
                        },
                        error: function () {
                            swal("Error en la api: No se ha enviado el correo");
                        }
                    });
                    clearTableModificados();
                    onLoadPrecioModificados();
                    onLoadAprovarPreciosModificados();
                    onLoadPreciosAprobadosEmail();

            } else {
                swal({
                    title: 'Cancelado',
                    text: 'Operación cancelada',
                    icon: 'error',
                    buttons: false,
                    timer: 1000

                })
            }
        });
    }
    //RECHAZADOS LOTE PRECIOS
    document.querySelector('#rechazar-propuestas').addEventListener('click', function (e) {
        e.preventDefault();
        swal({
            title: "¿Estas seguro?",
            text: "Usted esta a punto de rechazar todas las propuestas",
            icon: "warning",
            buttons: [
              'No, cancelar esta operación',
              'Si, estoy seguro'
            ],
            dangerMode: true,
        }).then(function (isConfirm) {
            if (isConfirm) {

                let rowCount = $('#tabla-aprobadora >tbody >tr').length;
                for (let i = 0; i < rowCount; i++) {
                    var Comentario = $('#comentario-' + i).val();

                    var UsuarioAprobador = "rafael.massorivera@fussionweb.com";
                    var ItemCode = $('#keySelected-1-' + i).val();
                    if (ItemCode == null) {
                        $.alert("El proceso ha terminado");
                    } else {
                        $.ajax({
                            contentType: "application/json; charset=utf-8",
                            url: '@Url.Action("RechazarListaPreciosToda", "Precios")',
                            async: false,
                            timeout: 3000,
                            type: 'POST',
                            data: '{"Comentario":"' + Comentario + '","UsuarioAprobador":"' + UsuarioAprobador + '","ItemCode":"' + ItemCode + '"}',
                            dataType: "json",
                            success: function (data) {
                            },
                            error: function () {
                                swal("Error en la api: Rechazar Lista Precios)");
                            }
                        });
                    }
                }
                clearTableModificados();
                onLoadPrecioModificados();
                onLoadAprovarPreciosModificados();
                sendEmailLoteReject();

            } else {
                swal({
                    title: 'Cancelado',
                    text: 'Operación cancelada',
                    icon: 'error',
                    buttons: false,
                    timer: 1000

                })
            }
        });
    });
    //RECHAZADOS LOTE PRECIOS EMAIL
    function sendEmailLoteReject() {

        let UsuarioModificador = localStorage.getItem("UserEmail");

        //*************************************correos Productivo**************************************************//
        //********************************************************************************************************//
       arregloCorreos = new Array("angel_garcia@fussionweb.com");

        //**************************************correos Purebas***************************************************//
        //********************************************************************************************************//
        //arregloCorreos = new Array("armando_pena@fussionweb.com");

        let FromEmail = UsuarioModificador;
        let SubjectEmail = "Lote de precios rechazados";
        let BodyEmail = "<html><body><h4>Lote precios rechazados</h4><br/><div>" + html2 + "</div><br /></body></html>";
        onLoadAprovarPreciosModificados();
        $.ajax({
            contentType: "application/json; charset=utf-8",
            url: '@Url.Action("EmailListPrice", "Precios")',
            async: false,
            timeout: 3000,
            type: 'POST',
            data: '{"FromEmail":"' + FromEmail + '","SubjectEmail":"' + SubjectEmail + '","BodyEmail":"' + BodyEmail + '","listaCorreos":' + JSON.stringify(arregloCorreos) + '}',
            dataType: "json",
            success: function (data) {
                swal({
                    title: 'Operación correcta',
                    text: 'Se ha enviado un correo de notificación',
                    icon: 'success',
                    buttons: false,
                    timer: 1000
                })
            },
            error: function () {
                swal("Error en la api: No se ha enviado el correo");
            }
        });

    }
    //CARGA STORAGE PARA MANDAR EMAIL
    function onLoadPreciosAprobadosEmail() {
        $.post('@Url.Action("ObtenerEstatusTresAll", "Precios")', {
        }, function (data) {
            $("#bodyCorreoUno").empty();
            $("#bodyCorreoDos").empty();
            if (data != null && $.isArray(data.Context)) {
                $.each(data.Context, function (index, value) {
                    let usuarioModificador = value.UsuarioModificador;
                    let listxz_33 = formatNumber.new(value.Lista33.toFixed(2), "$");
                    let listxz_25 = formatNumber.new(value.Lista25.toFixed(2), "$");
                    let listxz_14 = formatNumber.new(value.Lista14.toFixed(2), "$");
                    let listxz_48 = formatNumber.new(value.Lista48.toFixed(2), "$");
                    let listxz_47 = formatNumber.new(value.Lista47.toFixed(2), "$");
                    let listxz_29 = formatNumber.new(value.Lista29.toFixed(2), "$");
                    let listxz_28 = formatNumber.new(value.Lista28.toFixed(2), "$");
                    ////////////////////////////////////////////////////////////////////
                    let listx_40 = formatNumber.new(value.Lista40.toFixed(2), "$ ");
                    let listx_39 = formatNumber.new(value.Lista39.toFixed(2), "$ ");
                    let listx_38 = formatNumber.new(value.Lista38.toFixed(2), "$ ");
                    let listx_33 = formatNumber.new(value.Lista33.toFixed(2), "$ ");
                    let listx_25 = formatNumber.new(value.Lista25.toFixed(2), "$ ");
                    let listx_14 = formatNumber.new(value.Lista14.toFixed(2), "$ ");
                    let listx_48 = formatNumber.new(value.Lista48.toFixed(2), "$ ");
                    let listx_47 = formatNumber.new(value.Lista47.toFixed(2), "$ ");
                    let listx_29 = formatNumber.new(value.Lista29.toFixed(2), "$ ");
                    let listx_28 = formatNumber.new(value.Lista28.toFixed(2), "$ ");
                    let listx_22 = formatNumber.new(value.Lista22.toFixed(2), "$ ");
                    let listx_42 = formatNumber.new(value.Lista42.toFixed(2), "$ ");

                    //Si el usuario modificador tiene rol de precios y solo se modificaron las listas 10,15,38,39,40 y 41, por tanto se enviara correo a mayoristas, Eduardo Masso,Rafa Masso y Rafael Masso (direccion)
                    //Si el usuario modificador fue Rafa y  solo se modificaron las listas 14,25,28,29,33,47 y 48, por tanto se enviara correo a Tiendas y Rafa Masso
                    if (usuarioModificador == "rafael.massorivera@fussionweb.com") {

                        $("#bodyCorreoDos").append(
                            "<tr id='listaPreciosDos-" + index + "' style ='text-align:center; border: 1px solid black'>\
                                <td width='9%' style ='border: 1px solid black'>" + value.ItemCode + "</td>\
                                <td width='9%' style ='border: 1px solid black'>" + value.TipoPrecio + "</td>\
                                <td width='9%' style ='border: 1px solid black'>" + listx_33 + "</td>\
                                <td width='9%' style ='border: 1px solid black'>" + listx_25 + "</td>\
                                <td width='9%' style ='border: 1px solid black'>" + listx_14 + "</td>\
                                <td width='9%' style ='border: 1px solid black'>" + listx_48 + "</td>\
                                <td width='9%' style ='border: 1px solid black'>" + listx_47 + "</td>\
                                <td width='9%' style ='border: 1px solid black'>" + listx_29 + "</td>\
                                <td width='9%' style ='border: 1px solid black'>" + listx_28 + "</td>\
                                <td width='9%' style ='border: 1px solid black'>" + listx_22 + "</td>\
                                <td width='9%' style ='border: 1px solid black'>" + listx_42 + "</td>\
                            </tr > ");
                    } else {

                        $("#bodyCorreoUno").append(
                            "<tr id='listaPreciosUno-" + index + "' style ='text-align:center; border: 1px solid black'>\
                                <td  width='34%' style ='border: 1px solid black'>" + value.ItemCode + "</td>\
                                <td  width='12%' style ='border: 1px solid black'>" + listx_40 + "</td>\
                                <td  width='12%' style ='border: 1px solid black'>" + listx_39 + "</td>\
                                <td  width='12%' style ='border: 1px solid black'>" + listx_38 + "</td>\
                            </tr > ");
                    }
                });

            } else {
                swal("Error en la api: Obtener modificados para correo");
            }
        });
    }
    onLoadPreciosAprobadosEmail();
    //APRUEBA LISTA DE PRECIOS OK
    function AproveOneRowPriceList(Modificador, index) {
        let html;
        let arregloCorreos;
        let UsuarioModificador = localStorage.getItem("UserEmail");
        let BodyEmail;
        let comentario = $("#comentario-" + index).val();


        swal({
            title: "¿Estas seguro?",
            text: "Usted esta a punto de aprobar una lista de precios",
            icon: "warning",
            buttons: [
              'No, cancelar esta operación',
              'Si, estoy seguro'
            ],
            dangerMode: true,
        }).then(function (isConfirm) {
            if (isConfirm) {

                //Si el usuario modificador tiene rol de precios y solo se modificaron las listas 10,15,38,39,40 y 41, por tanto se enviara correo a mayoristas, Eduardo Masso,Rafa Masso y Rafael Masso (direccion)
                //Siel usuario modificador fue Rafa y  solo se modificaron las listas 14,25,28,29,33,47 y 48, por tanto se enviara correo a Tiendas y Rafa Masso
                if (Modificador == "rafael.massorivera@fussionweb.com") {

                    let oneRowAprove = $('#listaPreciosDos-' + index).html();
                    html = estructuraTablaCorreoDos + oneRowAprove + "</table>"
                    html = html.replace(/['"]+/g, "'");
                    //*************************************correos Productivo**************************************************//
                    //********************************************************************************************************//
                    arregloCorreos = new Array("rafael.massorivera@fussionweb.com","tiendas@fussionweb.com");


                    //**************************************correos Purebas***************************************************//
                    //********************************************************************************************************//
                    //arregloCorreos = new Array("armando_pena@fussionweb.com");

                    BodyEmail = "<html><body><p style='color:black;font: 15px arial, sans-serif;display: block;'>Estimado Equipo Fussion:</p><p style='color:black;font: 15px arial, sans-serif;' display: block;>Se les notifica que los siguientes SKUs sufrieron un ajuste de precio en Sistema, por lo que se les pide ejecutar las siguientes actividades:</p><div> <p style='color:black;font: 15px arial, sans-serif; display: block; font-weight: bold;' >IMPORTANTE:</p><p style='color:black;font: 15px arial, sans-serif; display: block; font-weight: bold;'>1) Sincronizar el SIAT para actualizar los precios en Sistema.</p><p style='color:black;font: 15px arial, sans-serif; display: block; font-weight: bold;'> 2) Realizar el re-etiquetado de precios en Piso de Venta del Sku y toda su Familia (Colores). </p><p style='color:black;font: 15px arial, sans-serif; display: block; font-weight: bold; margin-top:20px;'> NOTA: El cambio de precio de cualquier SKU afecta de la misma manera a su Familia (Colores). </p> </div>      <div>" + html + "</div><br /></body></html>";

                } else {
                    let oneRowAprove = $('#listaPreciosUno-' + index).html();
                    html = estructuraTablaCorreoUno + oneRowAprove + "<td width='12%' style='border: 1px solid black'>" + comentario + "</td>" + "</table>"
                    html = html.replace(/['"]+/g, "'");
                    //*************************************correos Productivo**************************************************//
                    //********************************************************************************************************//
                   arregloCorreos = new Array("rafael.massorivera@fussionweb.com","ventas@fussionweb.com","rafael_masso@fussionweb.com", "adrian_rivera@fussionweb.com", "eduardo.masso@fussionweb.com");


                    //**************************************correos Purebas***************************************************//
                    //********************************************************************************************************//
                    //arregloCorreos = new Array("armando_pena@fussionweb.com");

                    BodyEmail = "<html><body><p style='color:black;font: 15px arial, sans-serif;display: block;'>Estimado Equipo Fussion:</p><p style='color:black;font: 15px arial, sans-serif;' display: block;>Se les notifica que los siguientes SKUs sufrieron un ajuste de precio en Sistema:</p><div>" + html + "</div><br /><p style='color:black;font: 15px arial, sans-serif; display: block; font-weight: bold; margin-top:20px;'> NOTA: El cambio de precio de cualquier SKU afecta de la misma manera a su Familia (Colores). </p></body></html>";

                }

                let FromEmail = UsuarioModificador;
                let SubjectEmail = "URGENTE! LLEGADA / CAMBIO DE PRECIOS EN SKUS";
                let UsuarioAprobador = "rafael.massorivera@fussionweb.com";
                ItemCode = $("#keySelected-1-" + index).val();
                let SequenceItem = $("#sequence" + index).val();
                let idModificacion = $("#idModificacion-" + index).val();


                $.ajax({
                    contentType: "application/json; charset=utf-8",
                    url: '@Url.Action("EmailListPrice", "Precios")',
                    async: false,
                    timeout: 3000,
                    type: 'POST',
                    data: '{"FromEmail":"' + FromEmail + '","SubjectEmail":"' + SubjectEmail + '","BodyEmail":"' + BodyEmail + '","listaCorreos":' + JSON.stringify(arregloCorreos) + '}',
                    dataType: "json",
                    success: function (data) {
                            $.ajax({
                            contentType: "application/json; charset=utf-8",
                            url: '@Url.Action("AprobarUnaListaPrecios", "Precios")',
                            async: false,
                            timeout: 3000,
                                type: 'POST',
                                data: '{"ItemCode":"' + ItemCode + '","UsuarioAprobador":"' + UsuarioAprobador + '","IdModificacion":"' + idModificacion + '","Comentario":"' + comentario + '"}',
                            dataType: "json",
                                success: function (data) {
                                    swal({
                                        title: 'Operación correcta',
                                        text: 'Se ha enviado un correo de notificación',
                                        icon: 'success',
                                        buttons: false,
                                        timer: 2000
                                    })
                                    //for (let i = 0; i < 30; i++) {
                                    //    localStorage.removeItem("listprice-apr-" + i);
                                    //}
                                },
                                error: function () {
                                    swal("Error en la api: Aprobar una Lista  de Precios)");
                                }
                            });
                    },
                    error: function () {
                        swal("Error en la api: No se ha enviado el correo");
                    }
                });

                    clearTableModificados();
                    onLoadPrecioModificados();
                    onLoadAprovarPreciosModificados();
                    onLoadPreciosAprobadosEmail();
                //});
            } else {
                swal({
                    title: 'Cancelado',
                    text: 'Operación cancelada',
                    icon: 'error',
                    buttons: false,
                    timer: 1000

                })
            }
        });
    }
    //APRUEBA TODA LA LISTA DE PRECIOS OK
    document.querySelector('#aprobar-propuestas').addEventListener('click', function (e) {
        e.preventDefault();
        swal({
            title: "¿Estas seguro?",
            text: "Usted esta a punto de aprobar todas las propuestas",
            icon: "warning",
            buttons: [
              'No, cancelar esta operación',
              'Si, estoy seguro'
            ],
            dangerMode: true,
        }).then(function (isConfirm) {
            if (isConfirm) {

                var UsuarioAprobador = "rafael.massorivera@fussionweb.com";
                $.post('@Url.Action("ApruebaTodaListaPrecio", "Precios")', {
                    UsuarioAprobador
                    }, function (data) { });
                clearTableModificados();
                onLoadPrecioModificados();
                onLoadAprovarPreciosModificados();
                sendEmailLoteAprove();

            } else {
                swal({
                    title: 'Cancelado',
                    text: 'Operación cancelada',
                    icon: 'error',
                    buttons: false,
                    timer: 1000

                })
            }
        });
    });
    //MANDA EMAIL DE LO APROBADO
    function sendEmailLoteAprove() {

        let htmlUno;
        let arregloCorreosUno;
        let BodyEmailUno;
        let htmlDos;
        let arregloCorreosDos;
        let BodyEmailDos;
        let UsuarioModificador = localStorage.getItem("UserEmail");
        let FromEmail = UsuarioModificador;
        let SubjectEmail = "URGENTE! LLEGADA / CAMBIO DE PRECIOS EN SKUS";

        if ($('#bodyCorreoUno').html()) {

            //**correo Uno es para CORPORATIVO, Se recuperan las tablas creadas y que remplazan las " por ' para el envio con ajax
            htmlUno = $('#correoAprobacionUsuarioPrecios').html();
            htmlUno = htmlUno.replace(/['"]+/g, "'");

            //***************************************correos Productivo************************************************//
            //********************************************************************************************************//
            arregloCorreosUno = new Array("rafael.massorivera@fussionweb.com", "ventas@fussionweb.com", "rafael_masso@fussionweb.com", "adrian_rivera@fussionweb.com", "eduardo.masso@fussionweb.com");


            //***************************************correos Purebas**************************************************//
            //********************************************************************************************************//
            //arregloCorreosUno = new Array("armando_pena@fussionweb.com");


            BodyEmailUno = "<html><body><p style='color:black;font: 15px arial, sans-serif;display: block;'>Estimado Equipo Fussion:</p><p style='color:black;font: 15px arial, sans-serif;' display: block;>Se les notifica que los siguientes SKUs sufrieron un ajuste de precio en Sistema:</p><div>" + htmlUno + "</div><br /><p style='color:black;font: 15px arial, sans-serif; display: block; font-weight: bold; margin-top:20px;'> NOTA: El cambio de precio de cualquier SKU afecta de la misma manera a su Familia (Colores). </p></body></html>";
             $.ajax({
                contentType: "application/json; charset=utf-8",
                url: '@Url.Action("EmailListPrice", "Precios")',
                async: false,
                timeout: 3000,
                type: 'POST',
                data: '{"FromEmail":"' + FromEmail + '","SubjectEmail":"' + SubjectEmail + '","BodyEmail":"' + BodyEmailUno + '","listaCorreos":' + JSON.stringify(arregloCorreosUno) + '}',
                dataType: "json",
                success: function (data) {

                    swal({
                        title: 'Correcto',
                        text: 'Aprobación correcta, se ha enviado un correo de notificación',
                        icon: 'success',
                        buttons: false,
                        timer: 2000

                    })
                },
                error: function () {
                    swal({
                        title: 'Error',
                        text: 'Error en la api: No se ha enviado el correo ',
                        icon: 'error',
                        buttons: false,
                        timer: 2000

                    })
                }
            });
        } else {

        }
        if ($('#bodyCorreoDos').html()) {

            //**correo Dos es para TIENDAS, Se recuperan las tablas creadas y que remplazan las " por ' para el envio con ajax
            htmlDos = $('#correoAprobacionUsuarioAdmin').html();
            htmlDos = htmlDos.replace(/['"]+/g, "'");

            //***************************************correos Productivo************************************************//
            //********************************************************************************************************//
            arregloCorreosDos = new Array("rafael.massorivera@fussionweb.com", "tiendas@fussionweb.com");

            //***************************************correos Purebas**************************************************//
            //********************************************************************************************************//
           //arregloCorreosDos = new Array("armando_pena@fussionweb.com");

            BodyEmailDos = "<html><body><p style='color:black;font: 15px arial, sans-serif;display: block;'>Estimado Equipo Fussion:</p><p style='color:black;font: 15px arial, sans-serif;' display: block;>Se les notifica que los siguientes SKUs sufrieron un ajuste de precio en Sistema, por lo que se les pide ejecutar las siguientes actividades:</p><div> <p style='color:black;font: 15px arial, sans-serif; display: block; font-weight: bold;' >IMPORTANTE:</p><p style='color:black;font: 15px arial, sans-serif; display: block; font-weight: bold;'>1) Sincronizar el SIAT para actualizar los precios en Sistema.</p><p style='color:black;font: 15px arial, sans-serif; display: block; font-weight: bold;'> 2) Realizar el re-etiquetado de precios en Piso de Venta del Sku y toda su Familia (Colores). </p><p style='color:black;font: 15px arial, sans-serif; display: block; font-weight: bold; margin-top:20px;'> NOTA: El cambio de precio de cualquier SKU afecta de la misma manera a su Familia (Colores). </p> </div>      <div>" + htmlDos + "</div><br /></body></html>";

             $.ajax({
                contentType: "application/json; charset=utf-8",
                url: '@Url.Action("EmailListPrice", "Precios")',
                async: false,
                timeout: 3000,
                type: 'POST',
                data: '{"FromEmail":"' + FromEmail + '","SubjectEmail":"' + SubjectEmail + '","BodyEmail":"' + BodyEmailDos + '","listaCorreos":' + JSON.stringify(arregloCorreosDos) + '}',
                dataType: "json",
                 success: function (data) {
                     swal({
                         title: 'Correcto',
                         text: 'Aprobación correcta, se ha enviado un correo de notificación',
                         icon: 'success',
                         buttons: false,
                         timer: 1000

                     })
                },
                error: function () {
                    swal({
                        title: 'Error',
                        text: 'Error en la api: No se ha enviado el correo',
                        icon: 'error',
                        buttons: false,
                        timer: 1000

                    })
                }
            });

        }


        onLoadAprovarPreciosModificados();

    }
    //APRUEBA FAMILIA OK
    function AproveFamily(index) {
        swal({
            title: "¿Estas seguro?",
            text: "Usted esta a punto de aprobar familia",
            icon: "warning",
            buttons: [
              'No, cancelar esta operación',
              'Si, estoy seguro'
            ],
            dangerMode: true,
        }).then(function (isConfirm) {
            if (isConfirm) {

                let UsuarioAprobador = "rafael.massorivera@fussionweb.com";
                let ItemCode = $("#keySelected-1-" + index).val();
                $.ajax({
                    contentType: "application/json; charset=utf-8",
                    url: '@Url.Action("AprobarFamiliaEnProducto", "Precios")',
                    async: false,
                    timeout: 3000,
                    type: 'POST',
                    data: '{"UsuarioAprobador":"' + UsuarioAprobador + '","ItemCode":"' + ItemCode + '"}',
                    dataType: "json",
                    success: function (data) {
                    },
                    error: function () {
                        swal("Error al procesar el registro");
                    }
                });
                clearTableModificados();
                onLoadPrecioModificados();
                onLoadAprovarPreciosModificados();

            } else {
                swal("Cancelado", "Operación cancelada", "error");
            }
        });
    }
    //RECHAZA FAMILIA
    function RejectFamily(index) {
        swal({
            title: "¿Estas seguro?",
            text: "Usted esta a punto de rechazar la familia",
            icon: "warning",
            buttons: [
              'No, cancelar esta operación',
              'Si, estoy seguro'
            ],
            dangerMode: true,
        }).then(function (isConfirm) {
            if (isConfirm) {

                    let UsuarioAprobador = "rafael.massorivera@fussionweb.com";
                    let ItemCode = $("#keySelected-1-" + index).val();
                    //*************************************correos Productivo**************************************************//
                    //********************************************************************************************************//
                    arregloCorreos = new Array("angel_garcia@fussionweb.com");

                    //**************************************correos Purebas***************************************************//
                    //********************************************************************************************************//
                    //arregloCorreos = new Array("armando_pena@fussionweb.com");


                    let FromEmail = UsuarioAprobador;
                    let SubjectEmail = "Familia rechazada en el sku " + ItemCode;
                    let BodyEmail = "<html><body><h4>Asignación de familia rechazada en el sku </h4><br/><div>" + ItemCode + "</div><br /></body></html>";
                    $.ajax({
                        contentType: "application/json; charset=utf-8",
                        url: '@Url.Action("RechazarFamiliaEnProducto", "Precios")',
                        async: false,
                        timeout: 3000,
                        type: 'POST',
                        data: '{"UsuarioAprobador":"' + UsuarioAprobador + '","ItemCode":"' + ItemCode + '"}',
                        dataType: "json",
                        success: function (data) {
                        },
                        error: function () {
                            swal("Error al procesar el registro");
                        }
                    });
                    $.ajax({
                        contentType: "application/json; charset=utf-8",
                        url: '@Url.Action("EmailListPrice", "Precios")',
                        async: false,
                        timeout: 3000,
                        type: 'POST',
                        data: '{"FromEmail":"' + FromEmail + '","SubjectEmail":"' + SubjectEmail + '","BodyEmail":"' + BodyEmail + '","listaCorreos":' + JSON.stringify(arregloCorreos) + '}',
                        dataType: "json",
                        success: function (data) {
                        },
                        error: function () {
                            swal("Error en la api: EmailListPrice");
                        }
                    });
                    clearTableModificados();
                    onLoadPrecioModificados();
                    onLoadAprovarPreciosModificados();
                    onLoadPreciosRechazadosEmail();

            } else {
                swal("Cancelado", "Operación cancelada", "error");
            }
        });
    }
    //UPDATE TO SAP OK
    document.querySelector('#update-sap').addEventListener('click', function (e) {
        e.preventDefault();
        swal({
            title: "¿Sincronizar a SAP?",
            text: "Este proceso tarda algunos minutos",
            icon: "warning",
            buttons: [
              'No, cancelar esta operación',
              'Si, estoy seguro'
            ],
            dangerMode: true,
        }).then(function (isConfirm) {
            if (isConfirm) {

                $('#loading-sap-update').show();
                $.ajax({
                    contentType: "application/json; charset=utf-8",
                    url: '@Url.Action("UpdateListPriceToSap", "Precios")',
                    async: true,
                    type: 'POST',
                    data: '{}',
                    dataType: "json",
                    success: function (data) {
                        $('#loading-sap-update').hide();
                       
                        if (data.Code == -1) {
                            swal('Error', "Error: " + data.Message, 'error')
                            return;
                        }
                        swal('Operación correcta', 'Se completo la sincronización a SAP', 'success')
                        onLoadPrecioModificados();

                    },
                    error: function ( jqXHR,  textStatus,  errorThrown) {
                        $('#loading-sap-update').hide();                       
                        swal('Error', "Error: " + errorThrown , 'error')
                    }
                });

            } else {
                swal({
                    title: 'Cancelado',
                    text: 'Operación cancelada.',
                    icon: 'error',
                    buttons: false,
                    timer: 2000

                })
            }
        });
    });
</script>

<script>

    /*********************************************/
    function changeColorEstatusFamilia(index) {
        var FamiliaAsignada = $("#estatus-familia-" + index).val();
        if (FamiliaAsignada == 1) {
            $("#td-ar-familia-" + index).css("background-color", "rgb(180, 213, 245)");
            $("#button-aprove-famiy-" + index).prop("disabled", true);
        } else if (FamiliaAsignada == 3) {
            $("#td-ar-familia-" + index).css("background-color", "#ed9e81");
            $("#button-reject-famiy-" + index).prop("disabled", true);
        }
    }
    /*********************************************/

    //Limpia la tabla de la lista de precios de bussines
    function clearTableModificados() {
        var table = $('#precios-modificados-all').DataTable();
        table.clear().draw();
    }

    //Formato de dinero
    var formatNumber = {
        separador: ",",
        sepDecimal: '.',
        formatear: function (num) {
            num += '';
            var splitStr = num.split('.');
            var splitLeft = splitStr[0];
            var splitRight = splitStr.length > 1 ? this.sepDecimal + splitStr[1] : '';
            var regx = /(\d+)(\d{3})/;
            while (regx.test(splitLeft)) {
                splitLeft = splitLeft.replace(regx, '$1' + this.separador + '$2');
            }
            return this.simbol + splitLeft + splitRight;
        },
        new: function (num, simbol) {
            this.simbol = simbol || '';
            return this.formatear(num);
        }
    }
    //Datatables del bussines
    $('#precios-modificados-all').DataTable({
        "dom": 'Bfrtip',
        "buttons": ['copy', 'excel', 'pdf', 'print'],
        "language": {
            "url": "//cdn.datatables.net/plug-ins/1.10.13/i18n/Spanish.json"
        },
        "order": false,
    });

</script>