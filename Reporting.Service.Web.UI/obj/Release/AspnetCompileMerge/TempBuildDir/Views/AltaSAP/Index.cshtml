
@{
    ViewBag.Title = "Alta Articulo";
}

<section class="content-header">
    <h1>
        <small>Panel de control</small>
    </h1>
    <ol class="breadcrumb">
        <li><a href="#"><i class="fa fa-dashboard"></i> Articulo</a></li>
        <li class="active">Alta</li>
    </ol>
</section>

<section class="content">
    <div class="row">
        <div class="col-md-10">
            <div class="box box-info">
                <div class="box-header with-border">
                    <h3 class="box-title">ARTICULOS</h3>
                </div>
                <div class="box-body">
                    <form method="post" id="frmArticulo" name="frmArticulo" enctype="multipart/form-data">

                        <h4 class="page-header">DATOS GENERALES</h4>
                        <div class="row">
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label>SKU</label>
                                    <div class="input-group">
                                        <input id="Sku" name="Sku" onkeyup="return ValidaMayusculas(this);" type="text" class="form-control">
                                        <span class="input-group-btn">
                                            <div id="btnFind" class="btn btn-info btn-flat"><i class="fa fa-search"></i></div>
                                        </span>
                                    </div>
                                </div>

                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label>IMAGEN PRINCIPAL</label>
                                    <input class="btn btn-default btn-block btn-evidencia" id="ProductoImg" name="ProductoImg" type="file" accept="image/jpg">
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label>TIPO DE PRODUCTO</label>
                                    <select name="TipoProducto" id="TipoProducto" class="form-control">
                                        <option value="0" selected>-- Seleccione una opción --</option>
                                        <option value="1">NUEVO</option>
                                        <option value="2">DESCONTINUADO</option>
                                        <option value="3">ACTIVO</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label>MARCA</label>
                                    <select name="Marca" id="Marca" class="form-control">
                                        <option value="0" selected>-- Seleccione una opción --</option>
                                        <option value="FUSSION ACUSTIC">FUSSION ACUSTIC</option>
                                        <option value="OKKU">OKKU</option>
                                        <option value="FUSSION PRO">FUSSION PRO</option>
                                        <option value="KONIG">KONIG</option>
                                    </select>

                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label>FAMILIA</label>
                                    <select id="Familia" name="Familia" class="form-control"></select>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label>CATEGORIA</label>
                                    <select id="Categoria" name="Categoria" class="form-control"></select>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label>CLASIFICACIÓN</label>
                                    <select id="Clasificacion" name="Clasificacion" class="form-control"></select>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label>TIPO</label>
                                    <select id="Tipo" name="Tipo" class="form-control"></select>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label>TIPO DE EMPAQUE</label>
                                    <select name="TipoEmpaque" id="TipoEmpaque" class="form-control">
                                        <option value="0" selected>-- Seleccione una opción --</option>
                                        <option value="BROWN BOX">BROWN BOX</option>
                                        <option value="BROWN BOX CON ETIQUETA">BROWN BOX CON ETIQUETA</option>
                                        <option value="POLY BAG">POLY BAG</option>
                                        <option value="OPP BAG">OPP BAG</option>
                                        <option value="OPP FULL COLOR BAG">OPP FULL COLOR BAG</option>
                                        <option value="ZIPPER BAG">ZIPPER BAG</option>
                                        <option value="HEAD CARTON + BAG">HEAD CARTON + BAG</option>
                                        <option value="GIFT BOX O COLOR BOX">GIFT BOX O COLOR BOX</option>
                                        <option value="CARTON BOX">CARTON BOX</option>
                                        <option value="WINDOW BOX">WINDOW BOX</option>
                                        <option value="CRYSTAL BOX">CRYSTAL BOX</option>
                                        <option value="ZIPPER BAG">PVC BOX</option>
                                        <option value="BLISTER CARD">BLISTER CARD</option>
                                        <option value="DOUBLE NLISTER">DOUBLE NLISTER</option>
                                        <option value="CLAM SHELL">CLAM SHELL</option>
                                        <option value="ENVIRO SHELL">ENVIRO SHELL</option>
                                        <option value="BELT">BELT</option>
                                        <option value="FAJILLA">FAJILLA</option>
                                        <option value="BULK">BULK</option>
                                        <option value="PDQ">PDQ</option>
                                        <option value="FULL COLOR METALIC BAG">FULL COLOR METALIC BAG</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label>INNER (PZA)</label>
                                    <input type="text" id="Inner" name="Inner" value="0" onkeypress="return validaNumericos(event);" class="form-control">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label>MASTER (PZA)</label>
                                    <input type="text" id="Master" name="Master" value="0" onkeypress="return validaNumericos(event);" class="form-control">
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label>DESCRIPCIÓN COMERCIAL</label>
                                    <textarea id="Descripcion" name="Descripcion" onkeyup="return ValidaMayusculas(this);" class="form-control" rows="3"></textarea>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label>DESCRIPCIÓN EN INGLÉS</label>
                                    <textarea id="DescripcionIngles" name="DescripcionIngles" onkeyup="return ValidaMayusculas(this);" class="form-control" rows="3"></textarea>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label>ACCESORIOS</label>
                                    <textarea id="Accesorios" name="Accesorios" onkeyup="return ValidaMayusculas(this);" class="form-control" rows="3"></textarea>
                                </div>
                            </div>
                        </div>
                        <h4 class="page-header">DATOS DE COMPRA</h4>
                        <div class="row">
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label>SKU DEL FABRICANTE</label>
                                    <input id="SkuFabricante" name="SkuFabricante" onkeyup="return ValidaMayusculas(this);" type="text" class="form-control">
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label>CÓDIGO DEL PROVEEDOR</label>
                                    <div class="input-group">
                                        <input readonly="readonly" type="text" id="CodigoProveedor" name="CodigoProveedor" class="form-control">
                                        <span class="input-group-btn">
                                            <button type="button" class="btn btn-info btn-flat" data-toggle="modal" data-target="#modalProveedor"><i class="fa fa-binoculars"></i></button>
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label>MÁXIMO COMPRA</label>
                                    <input id="MaximoCompra" name="MaximoCompra" onkeypress="return validaNumericos(event);" type="text" class="form-control">
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label>MÍNIMO COMPRA</label>
                                    <input type="text" id="MinimoCompra" name="MinimoCompra" onkeypress="return validaNumericos(event);" class="form-control">
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-2">
                                <div class="form-group">
                                    <label>LARGO (CM)</label>
                                    <input type="text" id="Largo" name="Largo" value="0" onkeypress="return ValidaDecimal(event,this);" class="form-control">
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="form-group">
                                    <label>ANCHO (CM)</label>
                                    <input type="text" id="Ancho" name="Ancho" value="0" onkeypress="return ValidaDecimal(event,this);" class="form-control">
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="form-group">
                                    <label>ALTO (CM)</label>
                                    <input type="text" id="Alto" name="Alto" value="0" onkeypress="return ValidaDecimal(event,this);" class="form-control">
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="form-group">
                                    <label>PESO (G)</label>
                                    <input type="text" id="Peso" name="Peso" value="0" onkeypress="return ValidaDecimal(event,this);" class="form-control">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label>ESPECIFICACIONES COMPLETAS (Imagen)</label>
                                    <input class="btn btn-default btn-block btn-evidencia" id="EspecificacionesImg" name="EspecificacionesImg" type="file" accept="image/jpg">
                                </div>
                            </div>
                        </div>
                        <h4 class="page-header">DATOS DE TRÁFICO</h4>
                        <div class="row">
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label>No. NOM</label>
                                    <select id="Nom" name="Nom" class="form-control"></select>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label>No. CÓDIGO SAT</label>
                                    <input id="CodigoSat" name="CodigoSat" value="0" type="text" onkeypress="return validaNumericos(event);" class="form-control">
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label>FRACCIÓN ARANCELARIA</label>
                                    <input id="Fraccion" name="Fraccion" value="0" type="text" class="form-control">
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label>GRUPO DE ADUANAS % IGI  (*)</label>
                                    <select id="Aduana" name="Aduana" class="form-control"></select>
                                </div>
                            </div>
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label>DESCRIPCIÓN DE ADUANA</label>
                                    <input id="DescripcionAduana" name="DescripcionAduana" type="text" class="form-control">
                                    <input id="Barcode" name="Barcode" type="hidden" class="form-control">
                                    <input id="BarcodeInner" name="BarcodeInner" type="hidden" class="form-control">
                                    <input id="BarcodeMaster" name="BarcodeMaster" type="hidden" class="form-control">
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="box-footer">
                    <div id="btnNuevo" class="btn btn-info pull-left"><i class="fa fa-clone"></i> NUEVO REGISTRO</div>
                    <div id="btnLimpiar" class="btn btn-danger pull-left"><i class="fa fa-eraser"></i> LIMPIAR</div>
                    <div id="btnSave" class="btn btn-success pull-right"><i class="fa fa-save"></i> GUARDAR</div>
                </div>
                <div id="overlay" style="display:none;" class="overlay">
                    <i class="fa fa-refresh fa-spin"></i>
                </div>
            </div>
            
        </div>
        <div class="col-md-2">
            <div class="box box-info">
                <div class="box-header with-border">
                    <h3 class="box-title">ADICIONAL</h3>
                </div>
                <div class="box-body">
                    <div class="row">
                        <div class="col-md-6">
                            <img id="GImgProducto" class="profile-user-img img-responsive img-circle" src="">
                        </div>
                        <div class="col-md-6">
                            <img id="GImgEspecificacion" class="profile-user-img img-responsive img-circle" src="">
                        </div>
                    </div>
                    <div class="row">
                        <br />
                        <br />
                        <hr />

                        <h4 class="profile-username text-center">Anexar Imagen/Documento</h4>
                        <br />
                        <form method="post" id="frmAnexo" name="frmAnexo" enctype="multipart/form-data">
                            <div class="col-md-12">
                                <div class="form-group">
                                    <input type="hidden" id="SkuAnexo" name="SkuAnexo" />
                                    <input class="btn btn-default btn-block" id="Anexo" name="Anexo" type="file" accept="application/pdf, image/jpeg">
                                </div>
                            </div>
                        </form>
                    </div>
                    <div id="GuardarAnexo" class="btn btn-block btn-info"><i class="fa fa-chain-broken"></i> Agregar</div>
                </div>
                <div class="box-footer">
                    <table class="table table-bordered table-striped">
                        <thead>
                            <tr>
                                <th class="col-md-5">Nombre</th>
                                <th class="col-md-7">Link</th>
                            </tr>
                        </thead>
                        <tbody id="table-anexos"></tbody>
                    </table>
                </div>
            </div>
        </div>
        
    </div>
    <div class="row">
        <div class="col-md-12">
            <div class="box box-info">
                <div class="box-header with-border">
                    <h3 class="box-title">Listado de articulos</h3>
                </div>
                <div class="box-body">
                    <div class="row">
                        <div class="col-lg-12">
                            <div class="table table-responsive">
                                <table id="Productos" class="table table-bordered">
                                    <thead>
                                        <tr>
                                            <th>Imagen</th>
                                            <th>Folio</th>
                                            <th>Sku</th>
                                            <th>Nombre</th>
                                            <th>Tipo</th>
                                            <th>Marca</th>
                                            <th>Sku Fabricante</th>
                                            <th></th>
                                        </tr>
                                    </thead>
                                    <tbody id="table-Productos"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="box-footer">
                    <div id="AprobacionRefresh" style="display:none;" class="overlay">
                        <i class="fa  fa-circle-o-notch fa-spin"></i>
                    </div>
                </div>

                <div id="overlay-table" style="display:none;" class="overlay">
                    <i class="fa fa-refresh fa-spin"></i>
                </div>
            </div>            
        </div>
    </div>
</section>
<div class="modal fade" id="modalProveedor">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title">Buscar Proveedor</h4>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-lg-12">
                        <div class="table table-responsive">
                            <table id="Proveedores" class="table table-bordered">
                                <thead>
                                    <tr>
                                        <td class="col-md-8">Código / Nombre</td>
                                        <td class="col-md-4"></td>
                                    </tr>
                                </thead>
                                <tbody id="table-proveedores">
                                    <tr>
                                        <td></td>
                                        <td></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default pull-left" data-dismiss="modal">Cerrar</button>
            </div>
        </div>
    </div>
</div>
<script>
    InitModule();

    $("#Sku").keyup(function () {
        $("#Marca").val("0");
        $("#Familia").val("0");
        $("#Categoria").val("0");
        $("#Clasificacion").val("0");
        $("#Tipo").val("0");
        $("#TipoProducto").val("1");
        $("#TipoEmpaque").val("0");
        $("#Inner").val("0");
        $("#Master").val("0");
        $("#Descripcion").val("");
        $("#DescripcionIngles").val("");
        $("#Accesorios").val("");
        $("#SkuFabricante").val("");
        $("#CodigoProveedor").val("");
        $("#Largo").val("0");
        $("#Ancho").val("0");
        $("#Alto").val("0");
        $("#Peso").val("0");
        $("#Nom").val("0");
        $("#CodigoSat").val("0");
        $("#Fraccion").val("0");
        $("#Aduana").val("-");
        $("#MaximoCompra").val("");
        $("#MinimoCompra").val("");
        $("#GImgProducto").removeAttr("src");
        $("#GImgEspecificacion").removeAttr("src");
        $("#DescripcionAduana").val("-");

        $("#Barcode").val("");
        $("#BarcodeInner").val("");
        $("#BarcodeMaster").val("");

        $("#SkuAnexo").val("");
        $("#Anexo").val("");
        $("#table-anexos").html('');
        $("#TipoProducto").change();
    });

    $("#btnNuevo").click(function () {
        Limpiar();
    });
    $("#btnLimpiar").click(function () {
        Limpiar();
    });

    $("#btnFind").click(function () {
        $.post('@Url.Action("FindProducto", "AltaSAP")', {
            Sku: $("#Sku").val()
        }, function (data) {
            JSON.stringify('context ' +data.Context);
                $("#Marca").val(data.Context.Marca);
                $("#Familia").val(data.Context.Familia);
                $("#Categoria").val(data.Context.Categoria);
                $("#Clasificacion").val(data.Context.Clasificacion);
                $("#Tipo").val(data.Context.Tipo);
                $("#TipoEmpaque").val(data.Context.TipoEmpaque);
                $("#Inner").val(data.Context.CantInner);
                $("#Master").val(data.Context.CantMaster);
                $("#Descripcion").val(data.Context.DescripcionComercial);
                $("#DescripcionIngles").val(data.Context.DescripcionIngles);
                $("#Accesorios").val(data.Context.Accesorios);
                $("#SkuFabricante").val(data.Context.SkuFabricante);
                $("#CodigoProveedor").val(data.Context.CodigoProveedor);
                $("#Largo").val(data.Context.Largo);
                $("#Ancho").val(data.Context.Ancho);
                $("#Alto").val(data.Context.Alto);
                $("#Peso").val(data.Context.Peso);
                $("#Nom").val(data.Context.Nom);
                $("#UrlrContentContentlodigoSat").val(data.Context.CodigoSAT);
                $("#Fraccion").val(data.Context.Franccion);
                $("#Aduana").val(data.Context.Aduanas);
                $("#MaximoCompra").val(data.Context.Maximo);
                $("#MinimoCompra").val(data.Context.Minimo);
                if (data.Context.Maximo == '88888' && data.Context.Minimo == '88888') {
                    $("#TipoProducto").val(1);
                } else if (data.Context.Maximo == '99999' && data.Context.Minimo == '99999') {
                    $("#TipoProducto").val(2);
                } else {
                    $("#TipoProducto").val(3);
                }

                $("#CodigoSat").val(data.Context.CodigoSAT);

                $("#Barcode").val(data.Context.Barcode);
                $("#BarcodeInner").val(data.Context.BarcodeInner);
                $("#BarcodeMaster").val(data.Context.BarcodeMaster);
                $("#GImgProducto").attr("src", "https://apps.fussionweb.com/sive/Products/1_SAP/" + $("#Sku").val() + ".jpg");
                $("#GImgEspecificacion").attr("src", "https://fussionweb.com/Productos/Especificaciones/" + $("#Sku").val() + ".jpg");

                GetAnexos();

        });
    });

    function Limpiar() {
        $("#Sku").val("");
        $("#Marca").val("0");
        $("#Familia").val("0");
        $("#Categoria").val("0");
        $("#Clasificacion").val("0");
        $("#Tipo").val("0");
        $("#TipoEmpaque").val("0");
        $("#Inner").val("0");
        $("#Master").val("0");
        $("#Descripcion").val("");
        $("#DescripcionIngles").val("");
        $("#Accesorios").val("");
        $("#SkuFabricante").val("");
        $("#CodigoProveedor").val("");
        $("#Largo").val("0");
        $("#Ancho").val("0");
        $("#Alto").val("0");
        $("#Peso").val("0");
        $("#Nom").val("0");
        $("#CodigoSat").val("0");
        $("#Fraccion").val("0");
        $("#Aduana").val("-");
        $("#MaximoCompra").val("");
        $("#MinimoCompra").val("");
        $("#GImgProducto").removeAttr("src");
        $("#GImgEspecificacion").removeAttr("src");
        $("#DescripcionAduana").val("-");

        $("#Barcode").val("");
        $("#BarcodeInner").val("");
        $("#BarcodeMaster").val("");

        $("#SkuAnexo").val("");
        $("#Anexo").val("");
        $("#table-anexos").html('');
        $("#TipoProducto").change();

    }

    $("#btnSave").click(function (e) {
        $("#overlay").show();

        if ($("#Sku").val() == '') {
            $("#Sku").focus();
            $.alert("Valor requerido [Sku]");
            return;
        }

        if ($("#Barcode").val() == "") {
            if ($("#ProductoImg").val() == '') {
                $("#ProductoImg").focus();
                $.alert("Valor requerido [Imagen Principal]");
                return;
            }
        }
        

        if ($("#TipoProducto").val() == '0' || $("#TipoProducto").val() == 0) {
            $("#TipoProducto").focus();
            $.alert("Valor requerido [Tipo Producto]");
            return;
        }

        if ($("#Marca").val() == '0' || $("#Marca").val() == 0) {
            $("#Marca").focus();
            $.alert("Valor requerido [Marca]");
            return;
        }

        if ($("#Familia").val() == '0' || $("#Familia").val() == 0) {
            $("#Familia").focus();
            $.alert("Valor requerido [Familia]");
            return;
        }

        if ($("#Categoria").val() == '0' || $("#Categoria").val() == 0) {
            $("#Categoria").focus();
            $.alert("Valor requerido [Categoria]");
            return;
        }

        if ($("#Clasificacion").val() == '0' || $("#Clasificacion").val() == 0) {
            $("#Clasificacion").focus();
            $.alert("Valor requerido [Clasificación]");
            return;
        }

        if ($("#Tipo").val() == '0' || $("#Tipo").val() == 0) {
            $("#Tipo").focus();
            $.alert("Valor requerido [Tipo]");
            return;
        }

        if ($("#TipoEmpaque").val() == '0' || $("#TipoEmpaque").val() == 0) {
            $("#TipoEmpaque").focus();
            $.alert("Valor requerido [TipoEmpaque]");
            return;
        }

        //if ($("#Inner").val() == '0' || $("#Inner").val() == 0) {
        //    $("#Inner").focus();
        //    $.alert("Valor requerido [Inner]");
        //    return;
        //}

        if ($("#Master").val() == '0' || $("#Master").val() == 0) {
            $("#Master").focus();
            $.alert("Valor requerido [Master]");
            return;
        }

        var dato_master = $("#Master").val();
        var valoresAceptados = /^[0-9]+$/;
        if (dato_master.match(valoresAceptados)) {

        } else {
            $.alert("el valor para [Master] debe ser numerico");
            return;
        }

        var dato_inner = $("#Inner").val();
        if (dato_inner.match(valoresAceptados)) {

        } else {
            $.alert("el valor para [Inner] debe ser numerico");
            return;
        }

        if ($("#Descripcion").val() == '') {
            $("#Descripcion").focus();
            $.alert("Valor requerido [Descripción]");
            return;
        }

        if ($("#DescripcionIngles").val() == '') {
            $("#DescripcionIngles").focus();
            $.alert("Valor requerido [Descripción en Ingles]");
            return;
        }

        if ($("#Accesorios").val() == '') {
            $("#Accesorios").focus();
            $.alert("Valor requerido [Accesorios]");
            return;
        }

        if ($("#SkuFabricante").val() == '') {
            $("#SkuFabricante").val('-')
        }
        if ($("#CodigoProveedor").val() == '') {
            $("#CodigoProveedor").val('-')
        }

        if ($("#Barcode").val() == "") {
            if ($("#EspecificacionesImg").val() == '') {
                $("#EspecificacionesImg").focus();
                $.alert("Valor requerido [Imagen de especificaciones]");
                return;
            }
        }
        

        if ($("#Nom").val() == '0' || $("#Nom").val() == 0) {
            $("#Nom").focus();
            $.alert("Valor requerido [No. NOM]");
            return;
        }

        if ($("#CodigoSat").val() == '0' || $("#CodigoSat").val() == 0) {
            $("#CodigoSat").focus();
            $.alert("Valor requerido [Codigo SAT]");
            return;
        }

        if ($("#Fraccion").val() == '0' || $("#Fraccion").val() == 0) {
            $("#Fraccion").focus();
            $.alert("Valor requerido [Fracción Arancelaría]");
            return;
        }

        if ($("#Aduana").val() == '-' ) {
            $("#Aduana").focus();
            $.alert("Valor requerido [Grupo de aduanas]");
            return;
        }

        if ($("#DescripcionAduana").val() == '') {
            $("#DescripcionAduana").focus();
            $.alert("Valor requerido [Descripción de Aduana]");
            return;
        }
        

        var formData = new FormData($("#frmArticulo")[0]);

        $("#btnSave").attr("disabled", true);

            $.ajax({
                url: "@Url.Action("GuardarArticulo", "AltaSAP")",
                type: "POST",
                data: formData,
                contentType: false,
                processData: false,
                success: function (data) {

                    console.log(data);

                    if (data.Code == 0) {
                        $("#GImgProducto").attr("src", "https://apps.fussionweb.com/sive/Products/1_SAP/" + $("#Sku").val() + ".jpg");
                        $("#GImgEspecificacion").attr("src", "https://fussionweb.com/Productos/Especificaciones/" + $("#Sku").val() + ".jpg");
                        $.alert("El articulo se registro con el folio: [" + data.Context + "]. El documento pasará por un flujo para su aprobación.");

                    } else {
                        $.alert(data.Message);
                    }

                    GetMisProductos();
                    $("#btnSave").removeAttr("disabled");
                }
            });
        $("#overlay").hide();
    });

    function validarImagen() {
        var fileSize = $('#Anexo')[0].files[0].size;
        var sizekiloByte = parseInt(fileSize / 1024);
        var sizeMegaByte = parseInt(sizekiloByte / 1024);

        console.log(sizeMegaByte);
        //valida a megas
        if (sizeMegaByte > 3) {
            return false;
        }
        return true;
    }

    $("#GuardarAnexo").click(function () {

        if (!validarImagen()) {
            $.alert("El archivo no debe exceder de 3mb.");
            return;
        }

        $("#SkuAnexo").val($("#Sku").val());

        var formData = new FormData($("#frmAnexo")[0]);

        $("#btnSave").attr("disabled", true);

            $.ajax({
                url: "@Url.Action("GuardarAnexo", "AltaSAP")",
                type: "POST",
                data: formData,
                contentType: false,
                processData: false,
                success: function (data) {

                    $.alert("El anexo se registro con el folio: [" + data.Context + "]. El documento pasará por un flujo para su aprobación.");
                    console.log(data);
                    $("#SkuAnexo").val("");
                    $("#Anexo").val("");
                    GetAnexos();
                }
            });

        });

    function FindProveedor() {
        $.post('@Url.Action("GetProveedor", "AltaSAP")', function (data) {
            if (data.Context != null && $.isArray(data.Context)) {

                var table = $('#Proveedores').DataTable();
                table.destroy();

                $("#table-proveedores").html('');
                $.each(data.Context, function (index, value) {
                    $("#table-proveedores").append('<tr>\
                                                        <td>' + value.Nombre + ' - ' + value.Descripcion +'</td>\
                                                        <td><button type="button" onclick="SeleccionarProveedor(\''+ value.Nombre +'\')" class="btn btn-block btn-default"><i class="fa fa-thumb-tack"><i> Seleccionar</button></td>\
                                                    </tr>');
                });
                $('#Proveedores').DataTable({
                        "paging": true,
                        "lengthChange": false,
                        "searching": true,
                        "ordering": true,
                        "info": true,
                        "autoWidth": false,
                        "language": {
                            "url": "//cdn.datatables.net/plug-ins/1.10.13/i18n/Spanish.json"
                        }
                });
            }
        });

    }

    function SeleccionarProveedor(Codigo) {

        $("#CodigoProveedor").val(Codigo);
        $('#modalProveedor').modal('hide');

    }

    function InitModule() {
        $("#overlay-table").show();
        $("#overlay").show();
        FindProveedor();
        GetFamilias();
        GetClasificaciones(28, 'Categoria');
        GetClasificaciones(30, 'Clasificacion');
        GetClasificaciones(29, 'Tipo');
        GetNOM();
        GetGrupoAduanas();
        $("#TipoProducto").val(1).change();
        ValidaMaximoMinimo();
        GetMisProductos();
        $("#overlay").hide();
    }

    function ValidaMaximoMinimo() {
        if ($("#TipoProducto").val() == '1') {
            $("#MaximoCompra").val(88888);
            $("#MinimoCompra").val(88888);

            $('#MaximoCompra').attr("readonly", true);
            $('#MinimoCompra').attr("readonly", true);
        } else if ($("#TipoProducto").val() == '2') {
            $("#MaximoCompra").val(99999);
            $("#MinimoCompra").val(99999);

            $('#MaximoCompra').attr("readonly", true);
            $('#MinimoCompra').attr("readonly", true);
        } else {
            $("#MaximoCompra").val('');
            $("#MinimoCompra").val('');
            $('#MaximoCompra').removeAttr('readonly');
            $('#MinimoCompra').removeAttr('readonly');
        }
    }

    $("#TipoProducto").change(function (e) {
        ValidaMaximoMinimo();
    });
    function GetFamilias() {
        $.post('@Url.Action("GetFamilias", "AltaSAP")', function (data) {
            if (data.Context != null && $.isArray(data.Context)) {
                $("#Familia").html('<option value="0" selected>-- Seleccione una opción --</option>');
                $.each(data.Context, function (index, value) {
                    $("#Familia").append('<option value="' + value.Codigo + '">' + value.Nombre + '</option>');
                });
            }
        });
    }

    function GetNOM() {
        $.post('@Url.Action("GetNOM", "AltaSAP")', function (data) {
            if (data.Context != null && $.isArray(data.Context)) {
                $("#Nom").html('<option value="0" selected>-- Seleccione una opción --</option>');
                $.each(data.Context, function (index, value) {
                    $("#Nom").append('<option value="' + value.Nombre + '">' + value.Descripcion + '</option>');
                });
            }
        });
    }
    function GetGrupoAduanas() {
        $.post('@Url.Action("GetAduanas", "AltaSAP")', function (data) {
            if (data.Context != null && $.isArray(data.Context)) {
                $("#Aduana").html('<option value="-" selected>-- Seleccione una opción --</option>');
                $.each(data.Context, function (index, value) {
                    $("#Aduana").append('<option value="' + value.Codigo + '">' + value.Nombre + '</option>');
                });
            }
        });
    }

    function GetClasificaciones(tipo, elemento) {
        $.post('@Url.Action("GetClasificaciones", "AltaSAP")', {
            Tipo: tipo
        }, function (data) {
                if (data.Context != null && $.isArray(data.Context)) {
                    $("#" + elemento).html('<option value="0" selected>-- Seleccione una opción --</option>');
                $.each(data.Context, function (index, value) {
                    $("#" + elemento).append("<option value='" + value.Nombre + "'>" + value.Nombre + "</option>");
                });
            }
        });
    }

    function GetAnexos() {
        $.post('@Url.Action("GETAnexos", "AltaSAP")', {
            Sku: $("#Sku").val()
        }, function (data) {
            console.log(data);
            if (data.Context != null && $.isArray(data.Context)) {

                $("#table-anexos").html('');
                $.each(data.Context, function (index, value) {

                    $("#table-anexos").append('<tr>\
                                                        <td>'+ value.Nombre + '</td>\
                                                        <td><a href="@Url.Content("~/Documentos/")'+value.Archivo +'" target="_blank"> Descargar </a></td>\
                                                    </tr>');
                });

            }
        });

    }

    function validaNumericos(event) {
        if (event.charCode >= 48 && event.charCode <= 57) {
            return true;
        }
        return false;
    }
    function ValidaMayusculas(e) {
        e.value = e.value.toUpperCase();
    }
    function ValidaDecimal(evt, input) {
        // Backspace = 8, Enter = 13, ‘0′ = 48, ‘9′ = 57, ‘.’ = 46, ‘-’ = 43
        var key = window.Event ? evt.which : evt.keyCode;
        var chark = String.fromCharCode(key);
        var tempValue = input.value + chark;
        if (key >= 48 && key <= 57) {
            if (filter(tempValue) === false) {
                return false;
            } else {
                return true;
            }
        } else {
            if (key == 8 || key == 13 || key == 0) {
                return true;
            } else if (key == 46) {
                if (filter(tempValue) === false) {
                    return false;
                } else {
                    return true;
                }
            } else {
                return false;
            }
        }
    }
    function filter(__val__) {
        var preg = /^([0-9]+\.?[0-9]{0,2})$/;
        if (preg.test(__val__) === true) {
            return true;
        } else {
            return false;
        }

    }


    function GetMisProductos() {
        $.post('@Url.Action("GetMisArticulosPendientes", "AltaSAP")', function (data) {
            console.log(data);
            if (data.Context != null && $.isArray(data.Context)) {


                $("#table-Productos").html('');
                $.each(data.Context, function (index, value) {

                    $("#table-Productos").append('<tr>\
                                                        <td>\
                                                            <div class="product-img">\
                                                                <img src="https://apps.fussionweb.com/sive/Products/1_SAP/' + value.Sku + '.jpg" alt="Imagen">\
                                                            </div>\
                                                        </td >\
                                                        <td>'+ value.Sequence+'</td>\
                                                        <td>'+ value.Sku +'</td>\
                                                        <td>'+ value.DescripcionComercial +'</td>\
                                                        <td>'+ value.Tipo +'</td>\
                                                        <td>'+ value.Marca +'</td>\
                                                        <td>'+ value.SkuFabricante +'</td>\
                                                        <td>\
                                                            <div onclick="Editar('+ value.Sequence +')" class="btn btn-block btn-default"><i class="fa fa-pencil"></i> Editar datos</div>\
                                                        </td>\
                                                    </tr>');
                });

            }
        });
        $("#overlay-table").hide();
    }

    function Editar(Sequence) {
        $.post('@Url.Action("FindMiProducto", "AltaSAP")', {
            Sequence: Sequence
        }, function (data) {
                $("#Sku").val(data.Context.Sku);
                $("#Marca").val(data.Context.Marca);
                $("#Familia").val(data.Context.Familia);
                $("#Categoria").val(data.Context.Categoria);
                $("#Clasificacion").val(data.Context.Clasificacion);
                $("#Tipo").val(data.Context.Tipo);
                $("#TipoEmpaque").val(data.Context.TipoEmpaque);
                $("#Inner").val(data.Context.CantInner);
                $("#Master").val(data.Context.CantMaster);
                $("#Descripcion").val(data.Context.DescripcionComercial);
                $("#DescripcionIngles").val(data.Context.DescripcionIngles);
                $("#Accesorios").val(data.Context.Accesorios);
                $("#SkuFabricante").val(data.Context.SkuFabricante);
                $("#CodigoProveedor").val(data.Context.CodigoProveedor);
                $("#Largo").val(data.Context.Largo);
                $("#Ancho").val(data.Context.Ancho);
                $("#Alto").val(data.Context.Alto);
                $("#Peso").val(data.Context.Peso);
                $("#Nom").val(data.Context.Nom);
                $("#UrlrContentContentlodigoSat").val(data.Context.CodigoSAT);
                $("#Fraccion").val(data.Context.Franccion);
                $("#Aduana").val(data.Context.Aduanas);
                $("#MaximoCompra").val(data.Context.Maximo);
                $("#MinimoCompra").val(data.Context.Minimo);
                $("#CodigoSat").val(data.Context.CodigoSAT);
                $("#DescripcionAduana").val(data.Context.DescripcionAduana);

                $("#Barcode").val(data.Context.Barcode);
                $("#BarcodeInner").val(data.Context.BarcodeInner);
                $("#BarcodeMaster").val(data.Context.BarcodeMaster);
                $("#GImgProducto").attr("src", "https://apps.fussionweb.com/sive/Products/1_SAP/" + data.Context.Sku + ".jpg");
                $("#GImgEspecificacion").attr("src", "https://fussionweb.com/Productos/Especificaciones/" + data.Context.Sku + ".jpg");

                GetAnexos();

        });
    }
</script>