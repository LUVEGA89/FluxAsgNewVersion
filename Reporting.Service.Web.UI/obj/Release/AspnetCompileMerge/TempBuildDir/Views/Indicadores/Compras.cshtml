@{
    ViewBag.Title = "Compras";
}

<section class="content-header">
    <h1>
        Compras
        <small>Panel de control</small>
    </h1>
    <ol class="breadcrumb">
        <li><a href="#"><i class="fa fa-dashboard"></i> Indicadores</a></li>
        <li class="active">Compras</li>
    </ol>
</section>
<section class="content">
    <div class="row">

        <div class="col-md-12">
            <div class="box box-danger">
                <div class="box-header with-border">
                    
                    <i class="fa fa-bar-chart-o"></i>
                    <h3 class="box-title">KPI´S Stock 8020</h3>
                    <input type="hidden" id="NombreArchivo82" />
                    <input type="hidden" id="GUIDArchivo82" />

                    <div style="right: 81px;" class="box-tools ">
                        <div class="form-inline">
                            <div class="form-group" style="display:none;">
                                <div class="input-group">
                                    <div class="input-group-addon">
                                        <i class="glyphicon glyphicon-calendar"></i>
                                    </div>
                                    <input type="text" class="form-control pull-right" id="RangoCompras">
                                </div>

                            </div>
                            <div class="form-group">
                                @*<div onclick="GetInformacion8020(1)" class="btn btn-default"><span class="fa fa-money"></span></div>
                                <div onclick="GetInformacion8020(2)" class="btn btn-default"><span class="fa fa-institution"></span></div>*@
                                <div onclick="GetInformacion8020(3)" class="btn btn-default"><span class="fa fa-exchange"></span></div>
                            </div>

                        </div>
                    </div>
                    <div class="box-tools pull-right">

                        <button id="Download8020Excel" type="button" class="btn btn-box-tool"><i class="fa fa-file-excel-o"></i></button>
                        <button type="button" class="btn btn-box-tool" data-widget="collapse">
                            <i class="fa fa-minus"></i>
                        </button>
                        
                        <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
                    </div>
                </div>
                <div id="ContentCompras" class="box-body">

                </div>
                <div id="Stock8020Refresh" style="display:none;" class="overlay">
                    <i class="fa  fa-circle-o-notch fa-spin"></i>
                </div>
            </div>
        </div>
        <div class="col-md-12">
            <div class="box box-danger">
                <div class="box-header with-border">
                    <i class="fa fa-bar-chart-o"></i>

                    <h3 class="box-title">Reducción de costos</h3>

                    <div class="box-tools pull-right">
                        <button type="button" class="btn btn-box-tool" data-widget="collapse">
                            <i class="fa fa-minus"></i>
                        </button>
                        <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
                    </div>
                </div>
                <div id="ReduccionCostos" class="box-body">

                </div>
                <div id="ReduccionCostosRefresh" style="display:none;" class="overlay">
                    <i class="fa  fa-circle-o-notch fa-spin"></i>
                </div>
                <!-- /.box-body-->
            </div>
        </div>
        <div class="col-md-12">
            <div class="box box-danger">
                <div class="box-header with-border">
                    <i class="fa fa-bar-chart-o"></i>

                    <h3 class="box-title">Cumplimiento vs forescast</h3>

                    <div class="box-tools pull-right">
                        <button type="button" class="btn btn-box-tool" data-widget="collapse">
                            <i class="fa fa-minus"></i>
                        </button>
                        <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
                    </div>
                </div>
                <div class="box-body">
                    <div class="col-md-6">
                        <div class="form-group">
                            <div class="form-group">
                                <label>Ingrese el rango de fechas a analizar:</label>
                                <div class="input-group">
                                    <div class="input-group-addon">
                                        <i class="glyphicon glyphicon-calendar"></i>
                                    </div>
                                    <input type="text" class="form-control pull-right" id="RangoForecast">
                                </div>
                            </div>
                            <div class="form-group">
                                <div id="btnForecast" class="btn btn-default btn-block">Generar forecast</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <div class="form-group">
                                <label>Folio forecast:</label>
                                <div class="input-group">
                                    <div class="input-group-addon">
                                        <i class="fa fa-database"></i>
                                    </div>
                                    <input type="text" id="FolioForecast" class="form-control pull-right">
                                </div>
                            </div>
                            <div class="form-group">
                                <div id="btnForecastDetalle" class="btn btn-default btn-block">Ver y editar forecast</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="ForecastRefresh" style="display:none;" class="overlay">
                    <i class="fa fa-refresh fa-spin"></i>
                </div>
                <!-- /.box-body-->
            </div>
        </div>
        <div class="col-md-12">
            <div class="box box-danger">
                <div class="box-header with-border">
                    <i class="fa fa-bar-chart-o"></i>

                    <h3 class="box-title">Dias de envios</h3>
                    <div style="right: 71px;"  class="box-tools ">
                        <div class="form-inline">
                            <div class="form-group">
                                <div class="input-group">
                                    <div class="input-group-addon">
                                        <i class="glyphicon glyphicon-calendar"></i>
                                    </div>
                                    <input type="text" class="form-control pull-right" id="DiasEnvio">
                                </div>

                            </div>
                            <div class="form-group">
                                <div id="btnDiasEnvio" class="btn btn-success btn-block">Obtener Información</div>
                            </div>

                        </div>
                    </div>
                    <div class="box-tools pull-right">
                        <button type="button" class="btn btn-box-tool" data-widget="collapse">
                            <i class="fa fa-minus"></i>
                        </button>
                        <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
                    </div>
                </div>
                <div id="ContentDiasEnvio" class="box-body">

                </div>
                <div id="DiasEnvioRefresh" style="display:none;" class="overlay">
                    <i class="fa fa-refresh fa-spin"></i>
                </div>
                <!-- /.box-body-->
            </div>
        </div>
        <div class="col-md-12">
            <div class="box box-danger">
                <div class="box-header with-border">
                    <i class="fa fa-bar-chart-o"></i>

                    <h3 class="box-title">Tiempo de compras nacionles</h3>
                    <div style="right: 71px;" class="box-tools ">
                        <div class="form-inline">
                            <div class="form-group">
                                <div class="input-group">
                                    <div class="input-group-addon">
                                        <i class="glyphicon glyphicon-calendar"></i>
                                    </div>
                                    <input type="text" class="form-control pull-right" id="ComprasNacionales">
                                </div>

                            </div>
                            <div class="form-group">
                                <div id="btnComprasNacionales" class="btn btn-success btn-block">Obtener Información</div>
                            </div>

                        </div>
                    </div>
                    <div class="box-tools pull-right">
                        <button type="button" class="btn btn-box-tool" data-widget="collapse">
                            <i class="fa fa-minus"></i>
                        </button>
                        <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
                    </div>
                </div>
                <div class="box-body">

                </div>
                <!-- /.box-body-->
            </div>
        </div>
    </div>


    <!-- Modal -->
    <div class="modal fade" id="DetalleVP" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div id="ModalDialog" class="modal-dialog modal-lg " role="document">
            <div class="modal-content">
                <div class="modal-header alert-danger">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title">Detalle Stock 80/20 Piezas-Ventas</h4>
                </div>
                <div class="modal-body">
                    <table id="Detalle8020VP" class="table table-striped table-bordered">
                        <thead>
                            <tr class="active danger">
                                <td>Sku</td>
                                <td>Stock</td>
                                <td>Total Piezas</td>
                                <td>Stock 3 meses</td>
                                <td>Valido</td>
                                <td>Piezas en Pedidos</td>
                                <td>Piezas en transito</td>
                            </tr>
                        </thead>
                        <tbody id="VPDetalle"></tbody>
                    </table>
                </div>
                <div class="modal-footer alert-danger">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary">Save changes</button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="DetalleV" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div id="ModalDialog" class="modal-dialog modal-lg " role="document">
            <div class="modal-content">
                <div class="modal-header alert-success">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title">Detalle Stock 80/20 Ventas</h4>
                </div>
                <div class="modal-body">
                    <table id="Detalle8020V" class="table table-striped table-bordered">
                        <thead>
                            <tr class="active success">
                                <td>Sku</td>
                                <td>Stock</td>
                                <td>Total Piezas</td>
                                <td>Stock 3 meses</td>
                                <td>Valido</td>
                                <td>Piezas en Pedidos</td>
                                <td>Piezas en transito</td>
                            </tr>
                        </thead>
                        <tbody id="VDetalle"></tbody>
                    </table>
                </div>
                <div class="modal-footer alert-success">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary">Save changes</button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="DetalleP" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div id="ModalDialog" class="modal-dialog modal-lg " role="document">
            <div class="modal-content">
                <div class="modal-header alert-info">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title">Detalle Stock 80/20 piezas</h4>
                </div>
                <div class="modal-body">
                    <table id="Detalle8020P" class="table table-striped table-bordered">
                        <thead>
                            <tr class="active info">
                                <td>Sku</td>
                                <td>Stock</td>
                                <td>Total Piezas</td>
                                <td>Stock 3 meses</td>
                                <td>Valido</td>
                                <td>Piezas en Pedidos</td>
                                <td>Piezas en transito</td>
                            </tr>
                        </thead>
                        <tbody id="PDetalle"></tbody>
                    </table>
                </div>
                <div class="modal-footer alert-info">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary">Save changes</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="DetalleForecast" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div id="ModalDialog" class="modal-dialog modal-lg " role="document">
            <div class="modal-content">
                <div class="modal-header alert-info">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title">Detalle Stock 80/20 piezas</h4>
                </div>
                <div class="modal-body">
                    <table id="Forecast" class="table table-striped table-bordered">
                        <thead>
                            <tr class="active info">
                                <td>Sku</td>
                                <td>Tipo</td>
                                <td>Mes</td>
                                <td>SIAT</td>
                                <td>SAP</td>
                                <td>Total</td>
                                <td>MediaReal</td>
                                <td>MediaMinima</td>
                                <td>RellenoMedia</td>
                                <td>Pronostico</td>
                            </tr>
                        </thead>
                        <tbody id="DetalleForecastTable"></tbody>
                    </table>
                </div>
                <div class="modal-footer alert-info">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary">Save changes</button>
                </div>
            </div>
        </div>
    </div>
</section>
<script>
    $("#btnForecast").click(function () {
        var drp = $('#RangoForecast').data('daterangepicker');
        var Del = drp.startDate.format('YYYY/MM/DD');
        var Al = drp.endDate.format('YYYY/MM/DD');
        $.confirm({
            title: '¡Confirmar!',
            content: 'Se procedera a generar el pronostico de ventas, esto podria tardar unos minutos',
            type: 'red',
            buttons: {
                confirm: {
                    text: 'Confirmar',
                    action: function () {
                        $('#ForecastRefresh').show();
                        $.post('@Url.Action("Forecast", "Indicadores")', {
                            Del: Del,
                            Al: Al
                        }, function (data) {
                            if (data != null) {
                                console.log(data);
                                $.alert("Hemos generado un folio con el cual podra ver y editar el forecast, recuerde que este folio debe guardarlo pasa su porterior uso. Folio: " + data.Context);
                                $('#ForecastRefresh').hide();
                            } else {
                                $.alert("No se encontro registros");
                            }

                        });
                    }
                }
            }
        })
    });

    $("#btnForecastDetalle").click(function () {
        $.post('@Url.Action("ForecastDetalle", "Indicadores")', {
            Folio: $('#FolioForecast').val(),
        }, function (data) {
            if (data != null && $.isArray(data.Context)) {
                console.log(data);
                var VP = $('#Forecast').DataTable();
                VP.destroy();
                $("#DetalleForecastTable").html('');
                $.each(data.Context, function (index, value) {
                    $("#DetalleForecastTable").append('<tr><td>' + value.Sku + '</td><td>' + value.Tipo + '</td><td>' + value.Mes + '</td><td>' + value.SIAT + '</td><td>' + value.SAP + '</td><td>' + value.Total + '</td><td>' + value.MediaReal + '</td><td>' + value.MediaMinima + '</td><td>' + value.RellenoMedia + '</td><td>' + value.Pronostico + '</td></tr>')
                });
                $('#Forecast').DataTable({
                    //order: [[4, "desc"]],
                    "lengthMenu": [[12, 24, 48, -1], [12, 24, 48, "All"]],
                    "paging": true,
                    "lengthChange": true,
                    "searching": true,
                    "ordering": true,
                    "info": true,
                    "autoWidth": true,
                    "language": {
                        "url": "//cdn.datatables.net/plug-ins/1.10.13/i18n/Spanish.json"
                    }
                });
                $('#DetalleForecast').modal('show')
            } else {
                $.alert("No se encontro registros");
            }

        });
    });



</script>
<script>
    $("#btnDiasEnvio").click(function () {
        var drp = $('#DiasEnvio').data('daterangepicker');
        var Del = drp.startDate.format('YYYY/MM/DD');
        var Al = drp.endDate.format('YYYY/MM/DD');
        //Obtiene informacion dias de envio
        $('#DiasEnvioRefresh').show();
        $.post('@Url.Action("DiasEnvio", "Indicadores")', {
            Del: Del,
            Al: Al
        }, function (data) {
            if (data != null) {
                /* Recorremos tu respuesta con each */
                $("#ContentDiasEnvio").html('');
                $('#ContentDiasEnvio').append('<div class="col-xs-12 col-md-4 text-center"><input type="text" readonly="readonly" class="knob" data-thickness="0.2" data-angleArc="250" data-angleOffset="-125" value="' + data.Context.NuevosPorcentaje + '" data-width="120" data-height="120" data-fgColor="#f56954"><div class="knob-label">Nuevos ' + data.Context.NuevosPorcentaje + '%</div><div Onclick="ShowNuevos()"   class="btn btn-danger">Ver detalle</div></div>');
                $('#ContentDiasEnvio').append('<div class="col-xs-12 col-md-4 text-center"><input type="text" readonly="readonly" class="knob" data-thickness="0.2" data-angleArc="250" data-angleOffset="-125" value="' + data.Context.ConsolidadoPorcentaje + '" data-width="120" data-height="120" data-fgColor="#00a65a"><div class="knob-label">Consolidado ' + data.Context.ConsolidadoPorcentaje + '%</div><div Onclick="ShowConsolidado()"  class="btn btn-success">Ver detalle</div></div>');
                $('#ContentDiasEnvio').append('<div class="col-xs-12 col-md-4 text-center"><input type="text" readonly="readonly" class="knob" data-thickness="0.2" data-angleArc="250" data-angleOffset="-125" value="' + data.Context.CompletosPorcentaje + '" data-width="120" data-height="120" data-fgColor="#00c0ef"><div class="knob-label">Completo ' + data.Context.CompletosPorcentaje + '%</div><div Onclick="ShowCompletado()"  class="btn btn-info">Ver detalle</div></div>');

                if ($.isArray(data.Context.DetalleCompleto)) {
                    var C1T = $('#Completado').DataTable();
                    C1T.destroy();
                    $("#CompletadoDetalle").html('');
                    $.each(data.Context.DetalleCompleto, function (index, value) {
                        var fecha1 = '';
                        var fecha2 = '';
                        fecha1 = moment(value.Fecha).format('DD/MM/YYYY');
                        fecha2 = moment(value.Fecha2).format('DD/MM/YYYY');
                        if (fecha1 == '01/01/0001')
                            fecha1 = '';
                        if (fecha2 == '01/01/0001')
                            fecha2 = '';
                        $("#CompletadoDetalle").append('<tr><td>' + value.Folio + '</td><td>' + fecha1 + '</td><td>' + value.Factura + '</td><td>' + fecha2 + '</td><td>' + value.Dias + '</td><td>' + value.Aplica + '</td></tr>')
                    });
                    $('#Completado').DataTable({
                        //order: [[4, "desc"]],
                        "paging": true,
                        "lengthChange": true,
                        "searching": true,
                        "ordering": true,
                        "info": true,
                        "autoWidth": true,
                        "language": {
                            "url": "//cdn.datatables.net/plug-ins/1.10.13/i18n/Spanish.json"
                        }
                    });
                }
                if ($.isArray(data.Context.DetalleConsolidado)) {

                    var C2D = $('#Consolidado').DataTable();
                    C2D.destroy();
                    $("#ConsolidadoDetalle").html('');
                    $.each(data.Context.DetalleConsolidado, function (index, value) {
                        var fecha1 = '';
                        var fecha2 = '';
                        fecha1 = moment(value.Fecha).format('DD/MM/YYYY');
                        fecha2 = moment(value.Fecha2).format('DD/MM/YYYY');
                        if (fecha1 == '01/01/0001')
                            fecha1 = '';
                        if (fecha2 == '01/01/0001')
                            fecha2 = '';
                        $("#ConsolidadoDetalle").append('<tr><td>' + value.Folio + '</td><td>' + fecha1 + '</td><td>' + value.Factura + '</td><td>' + fecha2 + '</td><td>' + value.Dias + '</td><td>' + value.Aplica + '</td></tr>')
                    });
                    $('#Consolidado').DataTable({
                        //order: [[4, "desc"]],
                        "paging": true,
                        "lengthChange": true,
                        "searching": true,
                        "ordering": true,
                        "info": true,
                        "autoWidth": true,
                        "language": {
                            "url": "//cdn.datatables.net/plug-ins/1.10.13/i18n/Spanish.json"
                        }
                    });
                }
                if ($.isArray(data.Context.DetalleNuevo)) {
                    var VPC = $('#Nuevos').DataTable();
                    VPC.destroy();
                    $("#NuevosDetalle").html('');
                    $.each(data.Context.DetalleNuevo, function (index, value) {
                        var fecha1 = '';
                        var fecha2 = '';
                        fecha1 = moment(value.Fecha).format('DD/MM/YYYY');
                        fecha2 = moment(value.Fecha2).format('DD/MM/YYYY');
                        if (fecha1 == '01/01/0001')
                            fecha1 = '';
                        if (fecha2 == '01/01/0001')
                            fecha2 = '';
                        $("#NuevosDetalle").append('<tr><td>' + value.Folio + '</td><td>' + fecha1 + '</td><td>' + value.Factura + '</td><td>' + fecha2 + '</td><td>' + value.Dias + '</td><td>' + value.Aplica + '</td></tr>')
                    });
                    $('#Nuevos').DataTable({
                        //order: [[4, "desc"]],
                        "paging": true,
                        "lengthChange": true,
                        "searching": true,
                        "ordering": true,
                        "info": true,
                        "autoWidth": true,
                        "language": {
                            "url": "//cdn.datatables.net/plug-ins/1.10.13/i18n/Spanish.json"
                        }
                    });
                }

                $('#DiasEnvioRefresh').hide();
                $(".knob").knob({

                    draw: function () {

                        // "tron" case
                        if (this.$.data('skin') == 'tron') {

                            var a = this.angle(this.cv)  // Angle
                                , sa = this.startAngle          // Previous start angle
                                , sat = this.startAngle         // Start angle
                                , ea                            // Previous end angle
                                , eat = sat + a                 // End angle
                                , r = true;

                            this.g.lineWidth = this.lineWidth;

                            this.o.cursor
                            && (sat = eat - 0.3)
                            && (eat = eat + 0.3);

                            if (this.o.displayPrevious) {
                                ea = this.startAngle + this.angle(this.value);
                                this.o.cursor
                                && (sa = ea - 0.3)
                                && (ea = ea + 0.3);
                                this.g.beginPath();
                                this.g.strokeStyle = this.previousColor;
                                this.g.arc(this.xy, this.xy, this.radius - this.lineWidth, sa, ea, false);
                                this.g.stroke();
                            }

                            this.g.beginPath();
                            this.g.strokeStyle = r ? this.o.fgColor : this.fgColor;
                            this.g.arc(this.xy, this.xy, this.radius - this.lineWidth, sat, eat, false);
                            this.g.stroke();

                            this.g.lineWidth = 2;
                            this.g.beginPath();
                            this.g.strokeStyle = this.o.fgColor;
                            this.g.arc(this.xy, this.xy, this.radius - this.lineWidth + 1 + this.lineWidth * 2 / 3, 0, 2 * Math.PI, false);
                            this.g.stroke();

                            return false;
                        }
                    }
                });

            } else {
                $.alert("No se encontro registros");
            }

        });
    });

    function GetInformacion8020(tipo) {
        //var drp = $('#RangoCompras').data('daterangepicker');
        //var Del = drp.startDate.format('YYYY/MM/DD');
        //var Al = drp.endDate.format('YYYY/MM/DD');
        $.confirm({
            title: '¡Confirmar!',
            content: 'Esto podria tomar unos segundos',
            type: 'blue',
            buttons: {
                confirm: {
                    text: 'Confirmar',
                    action: function () {
                        $('#Stock8020Refresh').show();
                        $('#ReduccionCostosRefresh').show();

                        //obtiene información 8020
                        $.post('@Url.Action("Get8020Compras", "Indicadores")', {
                            //Del: Del,
                            //Al: Al,
                            Tipo: tipo
                        }, function (data) {
                            console.log(data);
                            if (data.Context != null) {
                                $('#NombreArchivo82').val('');
                                $('#GUIDArchivo82').val('');

                                $('#NombreArchivo82').val(data.Context.Documento.FileName);
                                $('#GUIDArchivo82').val(data.Context.Documento.GuidString);

                                $("#ContentCompras").html('');
                                $('#ContentCompras').append('<div class="col-xs-12 col-md-4 text-center"><input type="text" readonly="readonly" class="knob" data-thickness="0.2" data-angleArc="250" data-angleOffset="-125" value="' + data.Context.VPPorcentaje + '" data-width="120" data-height="120" data-fgColor="#f56954"><div class="knob-label">8020 Venta y piezas ' + data.Context.VPPorcentaje + '%</div><div Onclick="ShowVPDetalle()"   class="btn btn-danger">Ver detalle</div></div>');
                                if ($.isArray(data.Context.VPDetalle)) {
                                    var VP = $('#Detalle8020VP').DataTable();
                                    VP.destroy();
                                    $("#VPDetalle").html('');
                                    $.each(data.Context.VPDetalle, function (index, value) {
                                        $("#VPDetalle").append('<tr><td>' + value.Sku + '</td><td>' + value.Stock + '</td><td>' + value.SumaPiezasTiendaSap + '</td><td>' + Math.round((value.SumaPiezasTiendaSap / value.NMeses) * 3) + '</td><td>' + value.StockValidoNMeses + '</td><td>' + value.PiezasEnPedidos + '</td><td>' + value.PiezasEnTransito + '</td></tr>')
                                    });
                                    $('#Detalle8020VP').DataTable({
                                        //order: [[4, "desc"]],
                                        "paging": true,
                                        "lengthChange": true,
                                        "searching": true,
                                        "ordering": true,
                                        "info": true,
                                        "autoWidth": true,
                                        "language": {
                                            "url": "//cdn.datatables.net/plug-ins/1.10.13/i18n/Spanish.json"
                                        }
                                    });
                                }
                                $('#ContentCompras').append('<div class="col-xs-12 col-md-4 text-center"><input type="text" readonly="readonly" class="knob" data-thickness="0.2" data-angleArc="250" data-angleOffset="-125" value="' + data.Context.VPorcentaje + '" data-width="120" data-height="120" data-fgColor="#00a65a"><div class="knob-label">8020 Venta ' + data.Context.VPorcentaje + '%</div><div Onclick="ShowVDetalle()"  class="btn btn-success">Ver detalle</div></div>');
                                if ($.isArray(data.Context.VDetalle)) {
                                    var V = $('#Detalle8020V').DataTable();
                                    V.destroy();
                                    $("#VDetalle").html('');
                                    $.each(data.Context.VDetalle, function (index, value) {
                                        $("#VDetalle").append('<tr><td>' + value.Sku + '</td><td>' + value.Stock + '</td><td>' + value.SumaPiezasTiendaSap + '</td><td>' + Math.round((value.SumaPiezasTiendaSap / value.NMeses) * 3) + '</td><td>' + value.StockValidoNMeses + '</td><td>' + value.PiezasEnPedidos + '</td><td>' + value.PiezasEnTransito + '</td></tr>')
                                    });
                                    $('#Detalle8020V').DataTable({
                                        //order: [[4, "desc"]],
                                        "paging": true,
                                        "lengthChange": true,
                                        "searching": true,
                                        "ordering": true,
                                        "info": true,
                                        "autoWidth": true,
                                        "language": {
                                            "url": "//cdn.datatables.net/plug-ins/1.10.13/i18n/Spanish.json"
                                        }
                                    });
                                }
                                $('#ContentCompras').append('<div class="col-xs-12 col-md-4 text-center"><input type="text" readonly="readonly" class="knob" data-thickness="0.2" data-angleArc="250" data-angleOffset="-125" value="' + data.Context.PPorcentaje + '" data-width="120" data-height="120" data-fgColor="#00c0ef"><div class="knob-label">8020 Piezas ' + data.Context.PPorcentaje + '%</div><div Onclick="ShowPDetalle()"  class="btn btn-info">Ver detalle</div></div>');
                                if ($.isArray(data.Context.PDetalle)) {
                                    var P = $('#Detalle8020P').DataTable();
                                    P.destroy();
                                    $("#PDetalle").html('');
                                    $.each(data.Context.PDetalle, function (index, value) {
                                        $("#PDetalle").append('<tr><td>' + value.Sku + '</td><td>' + value.Stock + '</td><td>' + value.SumaPiezasTiendaSap + '</td><td>' + Math.round((value.SumaPiezasTiendaSap / value.NMeses) * 3) + '</td><td>' + value.StockValidoNMeses + '</td><td>' + value.PiezasEnPedidos + '</td><td>' + value.PiezasEnTransito + '</td></tr>')
                                    });
                                    $('#Detalle8020P').DataTable({
                                        //order: [[4, "desc"]],
                                        "paging": true,
                                        "lengthChange": true,
                                        "searching": true,
                                        "ordering": true,
                                        "info": true,
                                        "autoWidth": true,
                                        "language": {
                                            "url": "//cdn.datatables.net/plug-ins/1.10.13/i18n/Spanish.json"
                                        }
                                    });
                                }
                                $('#Stock8020Refresh').hide();
                                //Reduccion de costos
                                $("#ReduccionCostos").html('');
                                //$("#ReduccionCostos").append('<div class="col-xs-12 col-md-4 text-center"><input type="text" readonly="readonly" class="knob" data-thickness="0.2" data-angleArc="250" data-angleOffset="-125" value="' + data.Context.VPPorcentajeCostos.toFixed(2) + '" data-width="120" data-height="120" data-fgColor="#f56954"><div class="knob-label">8020 Venta y piezas ' + data.Context.VPPorcentajeCostos.toFixed(2) + '%</div><div Onclick="ShowCVPDetalle()"   class="btn btn-danger">Ver detalle</div></div>');
                                $("#ReduccionCostos").append('<div class="col-xs-12 col-md-4 text-center"><input type="text" readonly="readonly" class="knob" value="' + data.Context.VPPorcentajeCostos.toFixed(2) + '" data-min="-100" data-max="100" data-width="120" data-height="120" data-fgColor="#f56954"><div class="knob-label">8020 Venta y piezas ' + data.Context.VPPorcentajeCostos.toFixed(2) + '%</div><div Onclick="ShowCVPDetalle()"  class="btn btn-info">Ver detalle</div></div>')
                                if ($.isArray(data.Context.VPCostosDetalle)) {
                                    var VPC = $('#VPReduccionDetalle2').DataTable();
                                    VPC.destroy();
                                    $("#VPReduccionDetalle3").html('');
                                    $.each(data.Context.VPCostosDetalle, function (index, value) {
                                        $("#VPReduccionDetalle3").append('<tr><td>' + value.Sku + '</td><td>' + value.PrecioActual + '</td><td>' + value.UltimoPrecio + '</td><td>' + value.Porcentaje.toFixed(2) + '</td></tr>')
                                    });
                                    $('#VPReduccionDetalle2').DataTable({
                                        //order: [[4, "desc"]],
                                        "paging": true,
                                        "lengthChange": true,
                                        "searching": true,
                                        "ordering": true,
                                        "info": true,
                                        "autoWidth": true,
                                        "language": {
                                            "url": "//cdn.datatables.net/plug-ins/1.10.13/i18n/Spanish.json"
                                        }
                                    });
                                }
                                //$("#ReduccionCostos").append('<div class="col-xs-12 col-md-4 text-center"><input type="text" readonly="readonly" class="knob" data-thickness="0.2" data-angleArc="250" data-angleOffset="-125" value="' + data.Context.VPorcentajeCostos.toFixed(2) + '" data-width="120" data-height="120" data-fgColor="#00a65a"><div class="knob-label">8020 Venta ' + data.Context.VPorcentajeCostos.toFixed(2) + '%</div><div Onclick="ShowCVDetalle()"  class="btn btn-success">Ver detalle</div></div>');
                                $("#ReduccionCostos").append('<div class="col-xs-12 col-md-4 text-center"><input type="text" readonly="readonly" class="knob" value="' + data.Context.VPorcentajeCostos.toFixed(2) + '" data-min="-100" data-max="100" data-width="120" data-height="120" data-fgColor="#00a65a"><div class="knob-label">8020 Venta ' + data.Context.VPorcentajeCostos.toFixed(2) + '%</div><div Onclick="ShowCVDetalle()"  class="btn btn-info">Ver detalle</div></div>')
                                if ($.isArray(data.Context.VCostosDetalle)) {
                                    var VC = $('#VReduccionDetalle2').DataTable();
                                    VC.destroy();
                                    $("#VReduccionDetalle3").html('');
                                    $.each(data.Context.VCostosDetalle, function (index, value) {
                                        $("#VReduccionDetalle3").append('<tr><td>' + value.Sku + '</td><td>' + value.PrecioActual + '</td><td>' + value.UltimoPrecio + '</td><td>' + value.Porcentaje.toFixed(2) + '</td></tr>')
                                    });
                                    $('#VReduccionDetalle2').DataTable({
                                        //order: [[4, "desc"]],
                                        "paging": true,
                                        "lengthChange": true,
                                        "searching": true,
                                        "ordering": true,
                                        "info": true,
                                        "autoWidth": true,
                                        "language": {
                                            "url": "//cdn.datatables.net/plug-ins/1.10.13/i18n/Spanish.json"
                                        }
                                    });
                                }
                                //$("#ReduccionCostos").append('<div class="col-xs-12 col-md-4 text-center"><input type="text" readonly="readonly" class="knob" data-thickness="0.2" data-angleArc="250" data-angleOffset="-125" value="' + data.Context.PPorcentajeCostos.toFixed(2) + '" data-width="120" data-height="120" data-fgColor="#00c0ef"><div class="knob-label">8020 Piezas ' + data.Context.PPorcentajeCostos.toFixed(2) + '%</div><div Onclick="ShowCPDetalle()"  class="btn btn-info">Ver detalle</div></div>');
                                $("#ReduccionCostos").append('<div class="col-xs-12 col-md-4 text-center"><input type="text" readonly="readonly" class="knob" value="' + data.Context.PPorcentajeCostos.toFixed(2) + '" data-min="-100" data-max="100" data-width="120" data-height="120" data-fgColor="#00c0ef"><div class="knob-label">8020 Piezas ' + data.Context.PPorcentajeCostos.toFixed(2) + '%</div><div Onclick="ShowCPDetalle()"  class="btn btn-info">Ver detalle</div></div>')
                                if ($.isArray(data.Context.PCostosDetalle)) {
                                    var PC = $('#PReduccionDetalle2').DataTable();
                                    PC.destroy();
                                    $("#PReduccionDetalle3").html('');
                                    $.each(data.Context.PCostosDetalle, function (index, value) {
                                        $("#PReduccionDetalle3").append('<tr><td>' + value.Sku + '</td><td>' + value.PrecioActual + '</td><td>' + value.UltimoPrecio + '</td><td>' + value.Porcentaje.toFixed(2) + '</td></tr>')
                                    });
                                    $('#PReduccionDetalle2').DataTable({
                                        //order: [[4, "desc"]],
                                        "paging": true,
                                        "lengthChange": true,
                                        "searching": true,
                                        "ordering": true,
                                        "info": true,
                                        "autoWidth": true,
                                        "language": {
                                            "url": "//cdn.datatables.net/plug-ins/1.10.13/i18n/Spanish.json"
                                        }
                                    });
                                }
                                $('#ReduccionCostosRefresh').hide();
                                $(".knob").knob({

                                    draw: function () {

                                        // "tron" case
                                        if (this.$.data('skin') == 'tron') {

                                            var a = this.angle(this.cv)  // Angle
                                                , sa = this.startAngle          // Previous start angle
                                                , sat = this.startAngle         // Start angle
                                                , ea                            // Previous end angle
                                                , eat = sat + a                 // End angle
                                                , r = true;

                                            this.g.lineWidth = this.lineWidth;

                                            this.o.cursor
                                            && (sat = eat - 0.3)
                                            && (eat = eat + 0.3);

                                            if (this.o.displayPrevious) {
                                                ea = this.startAngle + this.angle(this.value);
                                                this.o.cursor
                                                && (sa = ea - 0.3)
                                                && (ea = ea + 0.3);
                                                this.g.beginPath();
                                                this.g.strokeStyle = this.previousColor;
                                                this.g.arc(this.xy, this.xy, this.radius - this.lineWidth, sa, ea, false);
                                                this.g.stroke();
                                            }

                                            this.g.beginPath();
                                            this.g.strokeStyle = r ? this.o.fgColor : this.fgColor;
                                            this.g.arc(this.xy, this.xy, this.radius - this.lineWidth, sat, eat, false);
                                            this.g.stroke();

                                            this.g.lineWidth = 2;
                                            this.g.beginPath();
                                            this.g.strokeStyle = this.o.fgColor;
                                            this.g.arc(this.xy, this.xy, this.radius - this.lineWidth + 1 + this.lineWidth * 2 / 3, 0, 2 * Math.PI, false);
                                            this.g.stroke();

                                            return false;
                                        }
                                    }
                                });
                            } else {
                                $.alert("Ocurrio un error al procesar los datos");
                            }
                        });



                    }
                },
                cancel: {
                    text: 'Cancelar',
                    action: function () {
                        $.alert('El proceso ha sido cancelado')
                    }
                }
            }
        });
    }

    $("#btnInfo").click(function () {


    });
    $('#Download8020Excel').click(function () {
        window.location.href = '@Url.Action("Download", "Indicadores")' + '?fileGuid=' + $('#GUIDArchivo82').val() + '&fileName=' + $('#NombreArchivo82').val();
    });

    var formatNumber = {
        separador: ",", // separador para los miles
        sepDecimal: '.', // separador para los decimales
        formatear: function (num) {
            num += '';
            var splitStr = num.split('.');
            var splitLeft = splitStr[0];
            var splitRight = splitStr.length > 1 ? this.sepDecimal + splitStr[1] : '';
            var regx = /(\d+)(\d{3})/;
            while (regx.test(splitLeft)) {
                splitLeft = splitLeft.replace(regx, '$1' + this.separador + '$2');
            }
            return this.simbol + splitLeft + splitRight;
        },
        new: function (num, simbol) {
            this.simbol = simbol || '';
            return this.formatear(num);
        }
    }
</script>
<script>
    $('#ComprasNacionales').daterangepicker();
    $('#RangoCompras').daterangepicker();
    $('#RangoForecast').daterangepicker();
    $('#DiasEnvio').daterangepicker();
    $('#Reduccion').daterangepicker();

    $(window).load(function () {

        $('#Detalle8020').DataTable();
        $('#VPReduccionDetalle2').DataTable();
        $('#VReduccionDetalle2').DataTable();
        $('#PReduccionDetalle2').DataTable();
        $('#Nuevos').DataTable();
        $('#Consolidado').DataTable();
        $('#Completado').DataTable();
    });
    function ShowVPDetalle() {
        $('#DetalleVP').modal('show')
    }
    function ShowVDetalle() {
        $('#DetalleV').modal('show')
    }
    function ShowPDetalle() {
        $('#DetalleP').modal('show')
    }
    function ShowCVPDetalle() {
        $('#VPReduccionDetalle').modal('show');
    }
    function ShowCVDetalle() {
        $('#VReduccionDetalle').modal('show');
    }
    function ShowCPDetalle() {
        $('#PReduccionDetalle').modal('show');
    }

    function ShowNuevos() {
        $('#ModalNuevos').modal('show');
    }
    function ShowConsolidado() {
        $('#ModalConsolidado').modal('show');
    }
    function ShowCompletado() {
        $('#ModalCompletado').modal('show');
    }
</script>

<div class="modal fade" id="VPReduccionDetalle" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div id="ModalDialog" class="modal-dialog modal-lg " role="document">
        <div class="modal-content">
            <div class="modal-header alert-danger">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title">Detalle reducción de costos 80/20 Piezas-Ventas</h4>
            </div>
            <div class="modal-body">
                <table id="VPReduccionDetalle2" class="table table-striped table-bordered">
                    <thead>
                        <tr class="active danger">
                            <td>Sku</td>
                            <td>Precio actual</td>
                            <td>Precio anterior</td>
                            <td>Porcentaje (Incremento / Decremento)</td>
                        </tr>
                    </thead>
                    <tbody id="VPReduccionDetalle3"></tbody>
                </table>
            </div>
            <div class="modal-footer alert-danger">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary">Save changes</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="VReduccionDetalle" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div id="ModalDialog" class="modal-dialog modal-lg " role="document">
        <div class="modal-content">
            <div class="modal-header alert-success">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title">Detalle reducción de costos 80/20 Ventas</h4>
            </div>
            <div class="modal-body">
                <table id="VReduccionDetalle2" class="table table-striped table-bordered">
                    <thead>
                        <tr class="active success">
                            <td>Sku</td>
                            <td>Precio actual</td>
                            <td>Precio anterior</td>
                            <td>Porcentaje (Incremento / Decremento)</td>
                        </tr>
                    </thead>
                    <tbody id="VReduccionDetalle3"></tbody>
                </table>
            </div>
            <div class="modal-footer alert-success">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary">Save changes</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="PReduccionDetalle" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div id="ModalDialog" class="modal-dialog modal-lg " role="document">
        <div class="modal-content">
            <div class="modal-header alert-info">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title">Detalle reducción de costos 80/20 piezas</h4>
            </div>
            <div class="modal-body">
                <table id="PReduccionDetalle2" class="table table-striped table-bordered">
                    <thead>
                        <tr class="active info">
                            <td>Sku</td>
                            <td>Precio actual</td>
                            <td>Precio anterior</td>
                            <td>Porcentaje (Incremento / Decremento)</td>
                        </tr>
                    </thead>
                    <tbody id="PReduccionDetalle3"></tbody>
                </table>
            </div>
            <div class="modal-footer alert-info">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary">Save changes</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="ModalNuevos" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div id="ModalDialog" class="modal-dialog modal-lg " role="document">
        <div class="modal-content">
            <div class="modal-header alert-danger">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title">Nuevos</h4>
            </div>
            <div class="modal-body">
                <table id="Nuevos" class="table table-striped table-bordered">
                    <thead>
                        <tr class="active danger">
                            <td>Pedido</td>
                            <td>Fecha anticipo</td>
                            <td>Factura</td>
                            <td>Fecha factura</td>
                            <td>Dias(Diferencia)</td>
                            <td>Aplica</td>
                        </tr>
                    </thead>
                    <tbody id="NuevosDetalle"></tbody>
                </table>
            </div>
            <div class="modal-footer alert-danger">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary">Save changes</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="ModalConsolidado" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div id="ModalDialog" class="modal-dialog modal-lg " role="document">
        <div class="modal-content">
            <div class="modal-header alert-success">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title">Consolidado</h4>
            </div>
            <div class="modal-body">
                <table id="Consolidado" class="table table-striped table-bordered">
                    <thead>
                        <tr class="active success">
                            <td>Pedido</td>
                            <td>Fecha anticipo</td>
                            <td>Factura</td>
                            <td>Fecha factura</td>
                            <td>Dias(Diferencia)</td>
                            <td>Aplica</td>
                        </tr>
                    </thead>
                    <tbody id="ConsolidadoDetalle"></tbody>
                </table>
            </div>
            <div class="modal-footer alert-success">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary">Save changes</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="ModalCompletado" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div id="ModalDialog" class="modal-dialog modal-lg " role="document">
        <div class="modal-content">
            <div class="modal-header alert-info">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title">Completado</h4>
            </div>
            <div class="modal-body">
                <table id="Completado" class="table table-striped table-bordered">
                    <thead>
                        <tr class="active info">
                            <td>Pedido</td>
                            <td>Fecha anticipo</td>
                            <td>Factura</td>
                            <td>Fecha factura</td>
                            <td>Dias(Diferencia)</td>
                            <td>Aplica</td>
                        </tr>
                    </thead>
                    <tbody id="CompletadoDetalle"></tbody>
                </table>
            </div>
            <div class="modal-footer alert-info">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary">Save changes</button>
            </div>
        </div>
    </div>
</div>