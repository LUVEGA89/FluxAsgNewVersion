@model Reporting.Service.Web.UI.Models.UserModel
@using Microsoft.AspNet.Identity
@using Reporting.Service.Core.Common
@{
    ViewBag.Title = "Nota de Crédito Gestión";
}
<style>
    .carousel-caption {
        position: absolute;
        right: 0;
        bottom: 0;
        left: 0;
        z-index: 10;
        padding-top: 20px;
        padding-bottom: 20px;
        color: #fff;
        text-align: center;
        background: rgba(0,0,0,0.4);
    }

    .nombre-cliente-custom {
        text-transform: uppercase
    }

    .carousel-control {
        margin-top: 50px;
    }

    .chat-box {
        height: 150px !important
    }

    .hide-autocomplete {
        visibility: hidden
    }

    .color-sku {
        background-color: #e6ffe6
    }

    .main-timeline-section {
        position: relative;
        width: 100%;
        margin: auto;
        height: 30px
    }

        .main-timeline-section .timeline-end, .main-timeline-section .timeline-start {
            position: absolute;
            background: #FFF;
            border-radius: 100px;
            border: 3px solid #F2635F;
            top: 50%;
            transform: translateY(-50%);
            width: 30px;
            height: 30px;
            z-index: 1
        }

        .main-timeline-section .timeline-end {
            right: 0
        }

        .main-timeline-section .conference-center-line {
            position: absolute;
            width: 100%;
            height: 5px;
            top: 50%;
            transform: translateY(-50%);
            background: #F2635F
        }

    .timeline-article {
        width: 20%;
        position: relative;
        min-height: 30px;
        float: right
    }

        .timeline-article .content-date {
            position: absolute;
            top: 35%;
            left: -30px;
            font-size: 18px
        }

    #letter-small, #letter-small-gestion {
        font-size: 13px
    }

    .timeline-article .meta-date {
        position: absolute;
        top: 50%;
        left: 0;
        transform: translateY(-50%);
        width: 20px;
        height: 20px;
        border-radius: 100%;
        background: #fff;
        border: 1px solid #F2635F
    }

    .timeline-article .content-box {
        box-shadow: 2px 2px 4px 0 #c1c1c1;
        border: 1px solid #F2635F;
        border-radius: 5px;
        background-color: #fff;
        width: 180px;
        position: absolute;
        top: 60%;
        left: -80px;
        padding: 10px
    }

    .meta-date-almacen, .meta-date-almacen-gestion, .meta-date-autorizado, .meta-date-autorizado-gestion, .meta-date-direccion, .meta-date-direccion-gestion, .meta-date-pendiente, .meta-date-pendiente-gestion {
        background: #F2635F !important
    }

    .meta-date-credito, .meta-date-credito-gestion, .meta-date-autorizado {
        background: #F2635F !important
    }

    .meta-date-direccion {
        background: #F2635F !important
    }

    .timeline-article-bottom .content-date {
        top: 90%
    }

    .timeline-article-bottom .content-box {
        top: 0
    }

        .timeline-article-bottom .content-box:before {
            content: " ";
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            bottom: -20px;
            border: 10px solid transparent;
            border-top-color: #F2635F
        }

    #caption {
        margin: auto;
        display: block;
        width: 90%;
        max-width: 700px;
    }


    .modal-content1 {
        margin: auto;
        display: block;
        width: 100%;
        height: 100%;
        max-width: 700px;
    }

    #estatus-rechazado {
        text-align: center;
        color: red;
    }

    .disabledAClass {
        pointer-events: none;
        cursor: default;
        opacity: 0.6;
    }
</style>
<section class="content-header">
    <h1>
        Nota de Crédito Aprobación
        <small id="span-cliente"></small>
    </h1>
    <ol class="breadcrumb">
        <li><a href="#"><i class="fa fa-dashboard"></i> Nota de Crédito </a></li>
        <li class="active"> Aprobación </li>
    </ol>
</section>
<section class="content">
    <div class="row">
        <div class="col-md-12">
            <div class="box box-danger">
                <div class="box-header with-border">
                    <i class="fa fa-file-text"></i>
                    <h3 class="box-title">Historico Notas de Credito</h3>

                    <br />
                    <div id="cmbFiltros" class="row">
                        <!--<div class="col-lg-6 col-md-6">
                            <div class="form-group">
                                <div class="input-group">
                                    <span class="input-group-addon">Tipo:</span>
                                    <select name="cbxTipo" id="cbxTipo" class="form-control">
                                        <option value="S">Servicio</option>
                                        <option value="I">Inventario</option>
                                    </select>
                                </div>
                            </div>
                        </div>-->
                        <div class="col-lg-12 col-md-12">
                            <div class="form-group">
                                <div class="input-group">
                                    <span class="input-group-addon">Esatus:</span>
                                    <select name="cmbEstatus" id="cmbEstatus" class="form-control">
                                        <option value="0">Aprobación pendiente Gerencia</option>
                                        <option value="1">Aprobación pendiente Almacen o Dirección(Servicios)</option>
                                        <option value="2">Aprobación pendiente Dirección</option>
                                        <option value="3">Autorizadas</option>
                                        <!--<option value="5">Rechazadas</option>-->
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="box-body">
                    <div id="loading" style="display:none;" class="overlay">
                        <i class="fa  fa fa-refresh fa-spin"></i>
                    </div>
                    <div class="table table-responsive">
                        <table class="table table-bordered" id="factura-origen">
                            <thead>
                                <tr>
                                    <th class="th-stationery">Folio SIE</th>
                                    <th class="th-stationery">Cliente</th>
                                    <th class="th-stationery">Folio Origen</th>
                                    <th class="th-stationery">Folio Destino</th>
                                    <th class="th-stationery">Tipo Documento</th>
                                    <th class="th-stationery">Concepto Descuento</th>
                                    <th style="min-width: 150px !important;" class="th-stationery">Comentario</th>
                                    <th class="th-stationery">Usuario</th>
                                    <th class="th-stationery">Estatus</th>
                                    <th class="th-stationery">Fecha</th>
                                    <th class="th-stationery">Gestion</th>
                                    <th class="th-stationery" id="comentario">Comentarios</th>
                                    <th class="th-stationery">Evidencias</th>
                                </tr>
                            </thead>
                            <tbody id="table-invoice-history"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="gestionGerencia" class="modal fade" role="dialog">
        <div class="modal-dialog">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-body">
                        <div class="box-body">
                            <div class="row">
                                <div class="col-xs-12">
                                    <h2 class="page-header">
                                        <input type="hidden" id="sequence-gerencia" />
                                        <input type="hidden" id="usuario-email-gerencia" />
                                        <input type="hidden" id="inventario-gerencia" />
                                        <input type="hidden" id="secuence-concepto-gerencia" />
                                        <i class="fa fa-file-text"></i>&nbsp;&nbsp;&nbsp;Gestión Nota de crédito (Gerencia)
                                        <small class="pull-right" id="set-Fecha-gestion"></small>
                                    </h2>
                                </div>
                            </div>
                            <div class="col-sm-6 invoice-col">
                                <address>
                                    <small id="set-Sequence-gestion"></small><br>
                                    <small id="set-Cliente-gestion"></small><br>
                                </address>
                            </div>
                            <div class="col-sm-6 invoice-col">
                                <address>
                                    <small id="set-FolioOrigen-gestion"></small><br>
                                    <small id="set-FolioDestino-gestion"></small><br>
                                    <small id="set-TipoDocumento-gestion"></small><br>
                                    <small id="set-Comentario-gestion"></small><br>
                                </address>
                            </div>
                            <div class="row">
                                <div class="col-xs-12 table-responsive">
                                    <table class="table table-striped">
                                        <thead>
                                            <tr>
                                                <th class="th-stationery">Sku</th>
                                                <th class="th-stationery">Cantidad</th>
                                                <th class="th-stationery">Precio</th>
                                                <th class="th-stationery">Descuento</th>
                                                <th class="th-stationery">Descuento Total sin IVA</th>
                                            </tr>
                                        </thead>
                                        <tbody id="table-invoice-detail-gestion-gerencia"></tbody>
                                        <tfoot>
                                            <tr style="text-align:right">
                                                <td colspan="4">
                                                    <b>Total sin IVA:</b>
                                                </td>
                                                <td><span id="subtotal-detail-gestion-gerencia"></span></td>
                                            </tr>
                                        </tfoot>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <section class="main-timeline-section">
                            <div class="timeline-start"></div>
                            <div class="conference-center-line"></div>
                            <div class="conference-timeline-content">
                                <div class="timeline-article timeline-article-bottom">
                                    <div class="content-date">
                                        <small id="letter-small-gestion">Autorizado</small>
                                    </div>
                                    <div class="meta-date" id="estatus-autorizado-gestion"></div>
                                </div>
                                <div class="timeline-article timeline-article-bottom">
                                    <div class="content-date">
                                        <small id="letter-small-gestion">Aprobación</small><br>
                                        <small id="letter-small-gestion">dirección</small>
                                    </div>
                                    <div class="meta-date" id="estatus-direccion-gestion"></div>
                                </div>
                                <div class="timeline-article timeline-article-bottom gestor-timeline-change">
                                    <div class="content-date">
                                        <small id="letter-small-gestion" class="line-time-change-text">Aprobación</small><br>
                                        <small id="letter-small-gestion" class="line-time-change">almacén</small>
                                    </div>
                                    <div class="meta-date" id="estatus-almacen-gestion"></div>
                                </div>
                                <div class="timeline-article timeline-article-bottom">
                                    <div class="content-date">
                                        <small id="letter-small-gestion">Aprobación</small><br>
                                        <small id="letter-small-gestion">gerencia</small>
                                    </div>
                                    <div class="meta-date" id="estatus-pendiente-gestion"></div>
                                </div>
                            </div>
                            <div class="timeline-end"></div>
                        </section>
                        <br>
                        <br>
                        <br>
                        <hr>
                        <div class="form-group">
                            <textarea class="form-control" id="comentario-gerencia" rows="1" placeholder="Agregar comentario"></textarea>
                            <small class="text-danger"> Nota: Es opcional agregar evidencia. Formato admitido (Imagen y archivo PDF).</small>
                        </div>
                        <form id="frm-addImagenes-gerencia" method="post" class="form-horizontal" enctype="multipart/form-data">
                            <div class="col-xs-12">
                                <input type="hidden" id="NotaCreditoIdGerencia" name="NotaCreditoIdGerencia">
                                <div class="form-group">
                                    <div id="Content-1g" class="row">
                                        <div class="col-md-10">
                                            <input class="btn btn-default btn-block btn-evidencia-g" id="Evidencia-1g" name="Evidencia-1g" noEvidencia="1" type="file" accept="image/x-png,image/jpeg,application/pdf">
                                        </div>
                                        <div class="col-md-2">
                                            <div Noinput="1" class="btn btn-danger btn-block btn-evidencia-gx">X</div>
                                        </div>
                                    </div>
                                    <div id="Content-2g" class="row">
                                        <div class="col-md-10">
                                            <input class="btn btn-default btn-block btn-evidencia-g" id="Evidencia-2g" name="Evidencia-2g" noEvidencia="2" type="file" accept="image/x-png,image/jpeg,application/pdf">
                                        </div>
                                        <div class="col-md-2">
                                            <div Noinput="2" class="btn btn-danger btn-block btn-evidencia-gx">X</div>
                                        </div>
                                    </div>
                                    <div id="Content-3g" class="row"><div class="col-md-10"><input class="btn btn-default btn-block btn-evidencia-g" id="Evidencia-3g" name="Evidencia-3g" noEvidencia="3" type="file" accept="image/x-png,image/jpeg,application/pdf"></div><div class="col-md-2"><div Noinput="3" class="btn btn-danger btn-block btn-evidencia-gx">X</div></div></div>
                                    <div id="Content-4g" class="row"><div class="col-md-10"><input class="btn btn-default btn-block btn-evidencia-g" id="Evidencia-4g" name="Evidencia-4g" noEvidencia="4" type="file" accept="image/x-png,image/jpeg,application/pdf"></div><div class="col-md-2"><div Noinput="4" class="btn btn-danger btn-block btn-evidencia-gx">X</div></div></div>
                                    <div id="Content-5g" class="row"><div class="col-md-10"><input class="btn btn-default btn-block btn-evidencia-g" id="Evidencia-5g" name="Evidencia-5g" noEvidencia="5" type="file" accept="image/x-png,image/jpeg,application/pdf"></div><div class="col-md-2"><div Noinput="5" class="btn btn-danger btn-block btn-evidencia-gx">X</div></div></div>
                                    <div id="Content-6g" class="row"><div class="col-md-10"><input class="btn btn-default btn-block btn-evidencia-g" id="Evidencia-6g" name="Evidencia-6g" noEvidencia="6" type="file" accept="image/x-png,image/jpeg,application/pdf"></div><div class="col-md-2"><div Noinput="6" class="btn btn-danger btn-block btn-evidencia-gx">X</div></div></div>
                                    <div id="Content-7g" class="row"><div class="col-md-10"><input class="btn btn-default btn-block btn-evidencia-g" id="Evidencia-7g" name="Evidencia-7g" noEvidencia="7" type="file" accept="image/x-png,image/jpeg,application/pdf"></div><div class="col-md-2"><div Noinput="7" class="btn btn-danger btn-block btn-evidencia-gx">X</div></div></div>
                                    <div id="Content-8g" class="row"><div class="col-md-10"><input class="btn btn-default btn-block btn-evidencia-g" id="Evidencia-8g" name="Evidencia-8g" noEvidencia="8" type="file" accept="image/x-png,image/jpeg,application/pdf"></div><div class="col-md-2"><div Noinput="8" class="btn btn-danger btn-block btn-evidencia-gx">X</div></div></div>
                                    <div id="Content-9g" class="row"><div class="col-md-10"><input class="btn btn-default btn-block btn-evidencia-g" id="Evidencia-9g" name="Evidencia-9g" noEvidencia="9" type="file" accept="image/x-png,image/jpeg,application/pdf"></div><div class="col-md-2"><div Noinput="9" class="btn btn-danger btn-block btn-evidencia-gx">X</div></div></div>

                                </div>
                            </div>
                        </form>

                        <div class="row">
                            <div class="col-md-10">
                                <button id="gestion-gerencia-rechazar" type="button" class="btn btn-danger pull-left" data-dismiss="modal" onclick="rechazaNotaCreditoGerencia()">&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<i class="fa fa-thumbs-down"></i>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp</button>
                            </div>
                            <div class="col-md-2">
                                <button id="gestion-gerencia-aprobar" type="button" class="btn btn-success pull-right" data-dismiss="modal" onclick="aprobarNotaCreditoGerencia()">&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<i class="fa fa-thumbs-up">&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp</i></button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="gestionAlmacen" class="modal fade" role="dialog">
        <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-body">
                    <div class="box-body">
                        <div class="row">
                            <div class="col-xs-12">
                                <h2 class="page-header">
                                    <input type="hidden" id="sequence-almacen" />
                                    <input type="hidden" id="usuario-almacen" />
                                    <input type="hidden" id="usuario-almacen-tipodocumento" />
                                    <input type="hidden" id="usuario-almacen-estatus" />
                                    <i class="fa fa-file-text"></i>&nbsp;&nbsp;&nbsp;Gestión Nota de crédito (Almacén)
                                    <small class="pull-right" id="set-Fecha-gestion-almacen"></small>
                                </h2>
                            </div>
                        </div>
                        <div class="col-sm-6 invoice-col">
                            <address>
                                <small id="set-Sequence-gestion-almacen"></small><br>
                                <small id="set-Cliente-gestion-almacen"></small><br>
                            </address>
                        </div>
                        <div class="col-sm-6 invoice-col">
                            <address>
                                <small id="set-FolioOrigen-gestion-almacen"></small><br>
                                <small id="set-FolioDestino-gestion-almacen"></small><br>
                                <small id="set-TipoDocumento-gestion-almacen"></small><br>
                                <small id="set-Comentario-gestion-almacen"></small><br>
                            </address>
                        </div>
                        <div class="row">
                            <div class="col-xs-12 table-responsive tab-pane fade in active">
                                <table class="table table-bordered">
                                    <thead>
                                        <tr>
                                            <th class="th-stationery">Sku</th>
                                            <th align="center" class="th-stationery">Cantidad</th>
                                            <th class="th-stationery">Precio</th>
                                            <th class="th-stationery">Descuento</th>
                                            <th class="th-stationery">Descuento Total sin IVA</th>
                                            <th class="th-stationery almacentd">Almacen</th>
                                        </tr>
                                    </thead>
                                    <tbody id="table-invoice-detail-gestion-almacen"></tbody>
                                    <tfoot>
                                        <tr>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                            <th class="almacenth"></th>
                                            <th id="subtotal-detail-gestion-almacen" class="pull-right"></th>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="modal-footer">
                    <section class="main-timeline-section">
                        <div class="timeline-start"></div>
                        <div class="conference-center-line"></div>
                        <div class="conference-timeline-content">
                            <div class="timeline-article timeline-article-bottom">
                                <div class="content-date">
                                    <small id="letter-small-gestion">Autorizado</small>
                                </div>
                                <div class="meta-date" id="estatus-autorizado-gestion-almacen"></div>
                            </div>
                            <div class="timeline-article timeline-article-bottom">
                                <div class="content-date">
                                    <small id="letter-small-gestion">Aprobación</small><br>
                                    <small id="letter-small-gestion">dirección</small>
                                </div>
                                <div class="meta-date" id="estatus-direccion-gestion-almacen"></div>
                            </div>
                            <div class="timeline-article timeline-article-bottom">
                                <div class="content-date">
                                    <small id="letter-small-gestion">Aprobación</small><br>
                                    <small id="letter-small-gestion">almacén</small>
                                </div>
                                <div class="meta-date" id="estatus-almacen-gestion-almacen"></div>
                            </div>
                            <div class="timeline-article timeline-article-bottom">
                                <div class="content-date">
                                    <small id="letter-small-gestion">Aprobación</small><br>
                                    <small id="letter-small-gestion">gerencia</small>
                                </div>
                                <div class="meta-date" id="estatus-pendiente-gestion-almacen"></div>
                            </div>
                        </div>
                        <div class="timeline-end"></div>
                    </section>
                    <br>
                    <br>
                    <br>
                    <hr>
                    <div class="form-group">
                        <textarea class="form-control" id="comentario-almacen" rows="1" placeholder="Agregar comentario"></textarea>
                        <small class="text-danger"> Nota: Es requerido agregar una evidencia. Formato admitido (Imagen y archivo PDF).</small>
                    </div>
                    <div class="form-group">
                        <small id="almacen-mensaje-almacen-partida-desglosada" style="font-size:15px;" class="text-danger"></small>
                    </div>


                    <form id="frm-addImagenes-almacen" method="post" class="form-horizontal" enctype="multipart/form-data">
                        <div class="col-xs-12">
                            <input type="hidden" id="NotaCreditoIdInventario" name="NotaCreditoIdInventario">
                            <div class="form-group">
                                <div id="Content-1a" class="row"><div class="col-md-10"><input class="btn btn-default btn-block btn-evidencia-a" id="Evidencia-1a" name="Evidencia-1a" noEvidencia="1" type="file" accept="image/x-png,image/jpeg,application/pdf"></div><div class="col-md-2"><div Noinput="1" class="btn btn-danger btn-block btn-evidencia-ax">X</div></div></div>
                                <div id="Content-2a" class="row"><div class="col-md-10"><input class="btn btn-default btn-block btn-evidencia-a" id="Evidencia-2a" name="Evidencia-2a" noEvidencia="2" type="file" accept="image/x-png,image/jpeg,application/pdf"></div><div class="col-md-2"><div Noinput="2" class="btn btn-danger btn-block btn-evidencia-ax">X</div></div></div>
                                <div id="Content-3a" class="row"><div class="col-md-10"><input class="btn btn-default btn-block btn-evidencia-a" id="Evidencia-3a" name="Evidencia-3a" noEvidencia="3" type="file" accept="image/x-png,image/jpeg,application/pdf"></div><div class="col-md-2"><div Noinput="3" class="btn btn-danger btn-block btn-evidencia-ax">X</div></div></div>
                                <div id="Content-4a" class="row"><div class="col-md-10"><input class="btn btn-default btn-block btn-evidencia-a" id="Evidencia-4a" name="Evidencia-4a" noEvidencia="4" type="file" accept="image/x-png,image/jpeg,application/pdf"></div><div class="col-md-2"><div Noinput="4" class="btn btn-danger btn-block btn-evidencia-ax">X</div></div></div>
                                <div id="Content-5a" class="row"><div class="col-md-10"><input class="btn btn-default btn-block btn-evidencia-a" id="Evidencia-5a" name="Evidencia-5a" noEvidencia="5" type="file" accept="image/x-png,image/jpeg,application/pdf"></div><div class="col-md-2"><div Noinput="5" class="btn btn-danger btn-block btn-evidencia-ax">X</div></div></div>
                                <div id="Content-6a" class="row"><div class="col-md-10"><input class="btn btn-default btn-block btn-evidencia-a" id="Evidencia-6a" name="Evidencia-6a" noEvidencia="6" type="file" accept="image/x-png,image/jpeg,application/pdf"></div><div class="col-md-2"><div Noinput="6" class="btn btn-danger btn-block btn-evidencia-ax">X</div></div></div>
                                <div id="Content-7a" class="row"><div class="col-md-10"><input class="btn btn-default btn-block btn-evidencia-a" id="Evidencia-7a" name="Evidencia-7a" noEvidencia="7" type="file" accept="image/x-png,image/jpeg,application/pdf"></div><div class="col-md-2"><div Noinput="7" class="btn btn-danger btn-block btn-evidencia-ax">X</div></div></div>
                                <div id="Content-8a" class="row"><div class="col-md-10"><input class="btn btn-default btn-block btn-evidencia-a" id="Evidencia-8a" name="Evidencia-8a" noEvidencia="8" type="file" accept="image/x-png,image/jpeg,application/pdf"></div><div class="col-md-2"><div Noinput="8" class="btn btn-danger btn-block btn-evidencia-ax">X</div></div></div>
                                <div id="Content-9a" class="row"><div class="col-md-10"><input class="btn btn-default btn-block btn-evidencia-a" id="Evidencia-9a" name="Evidencia-9a" noEvidencia="9" type="file" accept="image/x-png,image/jpeg,application/pdf"></div><div class="col-md-2"><div Noinput="9" class="btn btn-danger btn-block btn-evidencia-ax">X</div></div></div>
                            </div>
                        </div>
                    </form>

                    <button id="gestion-almacen-rechazar" type="button" class="btn btn-danger pull-left" data-dismiss="modal" onclick="rechazaNotaCreditoAlmacen()">&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<i class="fa fa-thumbs-down"></i>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp</button>
                    <!--<button id="gestion-almacen-actualizarpartidas" type="button" class="btn btn-danger pull-left" onclick="actualizarNotaCreditoAlmacenAgregado()">Almacen<i class="fa fa-thumbs-down"></i>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp</button>-->
                    <button id="gestion-almacen-aprobar" type="button" class="btn btn-success pull-right" onclick="aprobarNotaCreditoAlmacen()">&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<i class="fa fa-thumbs-up"></i>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp</button>
                </div>
            </div>
        </div>
    </div>



    <div id="gestionDireccion" class="modal fade" role="dialog">
        <div class="modal-dialog">
            <div class="modal-dialog">
                <div class="modal-content">

                    <div class="modal-body">
                        <div class="box-body">
                            <div class="row">
                                <div class="col-xs-12">
                                    <h2 class="page-header">
                                        <input type="hidden" id="sequence-direccion" />
                                        <input type="hidden" id="usuario-direccion" />
                                        <input type="hidden" id="cliente-direccion" />
                                        <input type="hidden" id="monto-direccion" />
                                        <i class="fa fa-file-text"></i>&nbsp;&nbsp;&nbsp;Gestión Nota de crédito (Dirección)
                                        <small class="pull-right" id="set-Fecha-gestion-direccion"></small>
                                    </h2>
                                </div>
                            </div>
                            <div class="col-sm-6 invoice-col">
                                <address>
                                    <small id="set-Sequence-gestion-direccion"></small><br>
                                    <small id="set-Cliente-gestion-direccion"></small><br>
                                </address>
                            </div>
                            <div class="col-sm-6 invoice-col">
                                <address>
                                    <small id="set-FolioOrigen-gestion-direccion"></small><br>
                                    <small id="set-FolioDestino-gestion-direccion"></small><br>
                                    <small id="set-TipoDocumento-gestion-direccion"></small><br>
                                    <small id="set-Comentario-gestion-direccion"></small><br>
                                </address>
                            </div>
                            <div class="row">
                                <div class="col-xs-12 table-responsive">
                                    <table class="table table-striped">
                                        <thead>
                                            <tr>
                                                <th class="th-stationery">Sku</th>
                                                <th class="th-stationery">Cantidad</th>
                                                <th class="th-stationery">Precio</th>
                                                <th style="display:none;"></th>
                                                <th class="th-stationery">Descuento</th>
                                                <th class="th-stationery">Descuento Total sin IVA</th>
                                            </tr>
                                        </thead>
                                        <tbody id="table-invoice-detail-gestion-direccion"></tbody>
                                        <tfoot>
                                            <tr style="text-align:right">
                                                <td colspan="4">
                                                    <b>Total sin IVA:</b>
                                                </td>
                                                <td><span id="subtotal-detail-gestion-direccion"></span></td>
                                            </tr>

                                        </tfoot>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-body">

                        <section class="main-timeline-section">
                            <div class="timeline-start"></div>
                            <div class="conference-center-line"></div>
                            <div class="conference-timeline-content">

                                <div class="timeline-article timeline-article-bottom">
                                    <div class="content-date">
                                        <small id="letter-small-gestion">Autorizado</small>
                                    </div>
                                    <div class="meta-date" id="estatus-autorizado-direccion"></div>
                                </div>

                                <div class="timeline-article timeline-article-bottom">
                                    <div class="content-date">
                                        <small id="letter-small-gestion">Aprobación</small><br>
                                        <small id="letter-small-gestion">dirección</small>
                                    </div>
                                    <div class="meta-date" id="estatus-direccion-direccion"></div>
                                </div>

                                <div class="timeline-article timeline-article-bottom gestor-timeline-change">
                                    <div class="content-date">
                                        <small id="letter-small-gestion" class="line-time-change-text">Aprobación</small><br>
                                        <small id="letter-small-gestion" class="line-time-change">almacén</small>
                                    </div>
                                    <div class="meta-date" id="estatus-almacen-direccion"></div>
                                </div>

                                <div class="timeline-article timeline-article-bottom">
                                    <div class="content-date">
                                        <small id="letter-small-gestion">Aprobación</small><br>
                                        <small id="letter-small-gestion">gerencia</small>
                                    </div>
                                    <div class="meta-date" id="estatus-gerencia-direccion"></div>
                                </div>

                            </div>
                            <div class="timeline-end"></div>
                        </section>
                        <br>
                        <br>
                        <hr>
                        <div class="form-group">
                            <textarea class="form-control" id="comentario-direccion" rows="1" placeholder="Agregar comentario"></textarea>
                            <small class="text-danger"> Nota: Es opcional agregar una evidencia. Formatos admitido (Imagen y archivos PDF).</small>
                        </div>


                    </div>

                    <div class="modal-body">

                        <div class="col-md-12">

                            <form id="frm-addImagenes-direccion" method="post" class="form-horizontal" enctype="multipart/form-data">
                                <div class="col-xs-12">
                                    <input type="hidden" id="NotaCreditoIdDireccion" name="NotaCreditoIdDireccion">
                                    <div class="form-group">
                                        <div id="Content-1d" class="row"><div class="col-md-10"><input class="btn btn-default btn-block btn-evidencia-d" id="Evidencia-1d" name="Evidencia-1d" noEvidencia="1" type="file" accept="image/x-png,image/jpeg,application/pdf"></div><div class="col-md-2"><div Noinput="1" class="btn btn-danger btn-block btn-evidencia-dx">X</div></div></div>
                                        <div id="Content-2d" class="row"><div class="col-md-10"><input class="btn btn-default btn-block btn-evidencia-d" id="Evidencia-2d" name="Evidencia-2d" noEvidencia="2" type="file" accept="image/x-png,image/jpeg,application/pdf"></div><div class="col-md-2"><div Noinput="2" class="btn btn-danger btn-block btn-evidencia-dx">X</div></div></div>
                                        <div id="Content-3d" class="row"><div class="col-md-10"><input class="btn btn-default btn-block btn-evidencia-d" id="Evidencia-3d" name="Evidencia-3d" noEvidencia="3" type="file" accept="image/x-png,image/jpeg,application/pdf"></div><div class="col-md-2"><div Noinput="3" class="btn btn-danger btn-block btn-evidencia-dx">X</div></div></div>
                                        <div id="Content-4d" class="row"><div class="col-md-10"><input class="btn btn-default btn-block btn-evidencia-d" id="Evidencia-4d" name="Evidencia-4d" noEvidencia="4" type="file" accept="image/x-png,image/jpeg,application/pdf"></div><div class="col-md-2"><div Noinput="4" class="btn btn-danger btn-block btn-evidencia-dx">X</div></div></div>
                                        <div id="Content-5d" class="row"><div class="col-md-10"><input class="btn btn-default btn-block btn-evidencia-d" id="Evidencia-5d" name="Evidencia-5d" noEvidencia="5" type="file" accept="image/x-png,image/jpeg,application/pdf"></div><div class="col-md-2"><div Noinput="5" class="btn btn-danger btn-block btn-evidencia-dx">X</div></div></div>
                                        <div id="Content-6d" class="row"><div class="col-md-10"><input class="btn btn-default btn-block btn-evidencia-d" id="Evidencia-6d" name="Evidencia-6d" noEvidencia="6" type="file" accept="image/x-png,image/jpeg,application/pdf"></div><div class="col-md-2"><div Noinput="6" class="btn btn-danger btn-block btn-evidencia-dx">X</div></div></div>
                                        <div id="Content-7d" class="row"><div class="col-md-10"><input class="btn btn-default btn-block btn-evidencia-d" id="Evidencia-7d" name="Evidencia-7d" noEvidencia="7" type="file" accept="image/x-png,image/jpeg,application/pdf"></div><div class="col-md-2"><div Noinput="7" class="btn btn-danger btn-block btn-evidencia-dx">X</div></div></div>
                                        <div id="Content-8d" class="row"><div class="col-md-10"><input class="btn btn-default btn-block btn-evidencia-d" id="Evidencia-8d" name="Evidencia-8d" noEvidencia="8" type="file" accept="image/x-png,image/jpeg,application/pdf"></div><div class="col-md-2"><div Noinput="8" class="btn btn-danger btn-block btn-evidencia-dx">X</div></div></div>
                                        <div id="Content-9d" class="row"><div class="col-md-10"><input class="btn btn-default btn-block btn-evidencia-d" id="Evidencia-9d" name="Evidencia-9d" noEvidencia="9" type="file" accept="image/x-png,image/jpeg,application/pdf"></div><div class="col-md-2"><div Noinput="9" class="btn btn-danger btn-block btn-evidencia-dx">X</div></div></div>
                                    </div>
                                </div>
                            </form>
                        </div>

                    </div>
                    <div class="modal-footer">
                        <button id="gestion-direccion-rechazar" type="button" class="btn btn-danger pull-left" data-dismiss="modal" onclick="rechazaNotaCreditoDireccion()">&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<i class="fa fa-thumbs-down"></i>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp</button>
                        <button id="gestion-direccion-aprobar" type="button" class="btn btn-success pull-right" data-dismiss="modal" onclick="aprobarNotaCreditoDireccion()">&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<i class="fa fa-thumbs-up"></i>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp</button>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <div id="gestionCreditoCobranza" class="modal fade" role="dialog">
        <div class="modal-dialog">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-body">
                        <div class="box-body">
                            <div class="row">
                                <div class="col-xs-12">
                                    <h2 class="page-header">
                                        <input type="hidden" id="sequence-credito" />
                                        <input type="hidden" id="usuario-credito" />
                                        <i class="fa fa-file-text"></i>&nbsp;&nbsp;&nbsp;Gestión Nota de crédito (Crédito y Cobranza)
                                        <small class="pull-right" id="set-Fecha-gestion-credito"></small>
                                    </h2>
                                </div>
                            </div>
                            <div class="col-sm-6 invoice-col">
                                <address>
                                    <small id="set-Sequence-gestion-credito"></small><br>
                                    <small id="set-Cliente-gestion-credito"></small><br>
                                </address>
                            </div>
                            <div class="col-sm-6 invoice-col">
                                <address>
                                    <small id="set-FolioOrigen-gestion-credito"></small><br>
                                    <small id="set-FolioDestino-gestion-credito"></small><br>
                                    <small id="set-TipoDocumento-gestion-credito"></small><br>
                                    <small id="set-Comentario-gestion-credito"></small><br>
                                </address>
                            </div>
                            <div class="row">
                                <div class="col-xs-12 table-responsive">
                                    <table class="table table-striped">
                                        <thead>
                                            <tr>
                                                <th class="th-stationery">Sku</th>
                                                <th class="th-stationery">Cantidad</th>
                                                <th class="th-stationery">Precio</th>
                                                <th style="display:none;"></th>
                                                <th class="th-stationery">Descuento</th>
                                                <th class="th-stationery">Descuento Total sin IVA</th>
                                            </tr>
                                        </thead>
                                        <tbody id="table-invoice-detail-gestion-credito"></tbody>
                                        <tfoot>
                                            <tr style="text-align:right">
                                                <td colspan="4">
                                                    <b>Total sin IVA:</b>
                                                </td>
                                                <td><span id="subtotal-detail-gestion-credito"></span></td>
                                            </tr>
                                            @*<tr>
                                                    <th></th>
                                                    <th></th>
                                                    <th></th>
                                                    <th></th>
                                                    <th id="subtotal-detail-gestion-credito" class="pull-right"></th>
                                                </tr>*@
                                        </tfoot>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <section class="main-timeline-section">
                            <div class="timeline-start"></div>
                            <div class="conference-center-line"></div>
                            <div class="conference-timeline-content">

                                <div class="timeline-article timeline-article-bottom">
                                    <div class="content-date">
                                        <small id="letter-small-gestion">Autorizado</small>
                                    </div>
                                    <div class="meta-date" id="estatus-autorizado-gestion-credito"></div>
                                </div>

                                <div class="timeline-article timeline-article-bottom">
                                    <div class="content-date">
                                        <small id="letter-small-credito">Aprobación</small><br>
                                        <small id="letter-small-credito">dirección</small>
                                    </div>
                                    <div class="meta-date" id="estatus-direccion-gestion-credito"></div>
                                </div>

                                <div class="timeline-article timeline-article-bottom gestor-timeline-change">
                                    <div class="content-date">
                                        <small id="letter-small-gestion-credito" class="line-time-change-text">Aprobación</small><br>
                                        <small id="letter-small-gestion-credito" class="line-time-change">almacén</small>
                                    </div>
                                    <div class="meta-date" id="estatus-almacen-gestion-credito"></div>
                                </div>

                                <div class="timeline-article timeline-article-bottom">
                                    <div class="content-date">
                                        <small style="display:none;" id="letter-small-gestion-credito">Aprobación</small><br>
                                        <small style="display:none;" id="letter-small-gestion-credito">Crédito y cobranza</small>
                                    </div>
                                    <div class="meta-date" style="display:none;" id="estatus-pendiente-gestion-credito"></div>
                                </div>

                            </div>
                            <div class="timeline-end"></div>
                        </section>
                        <br>
                        <br>
                        <br>
                        <hr>
                        <div class="form-group">
                            <textarea class="form-control" id="comentario-credito" rows="1" placeholder="Agregar comentario"></textarea>
                            <small class="text-danger"> Nota: Es opcional agregar una evidencia. Formatos admitido (Imagen y archivo PDF).</small>
                        </div>
                        <form id="frm-addImagenes-cobranza" method="post" class="form-horizontal" enctype="multipart/form-data">
                            <div class="col-xs-12">
                                <input type="hidden" id="NotaCreditoIdCobranza" name="NotaCreditoIdCobranza">
                                <div class="form-group">
                                    <div id="Content-1c" class="row"><div class="col-md-10"><input class="btn btn-default btn-block btn-evidencia-c" id="Evidencia-1c" name="Evidencia-1c" noEvidencia="1" type="file" accept="image/x-png,image/jpeg,application/pdf"></div><div class="col-md-2"><div Noinput="1" class="btn btn-danger btn-block btn-evidencia-cx">X</div></div></div>
                                    <div id="Content-2c" class="row"><div class="col-md-10"><input class="btn btn-default btn-block btn-evidencia-c" id="Evidencia-2c" name="Evidencia-2c" noEvidencia="2" type="file" accept="image/x-png,image/jpeg,application/pdf"></div><div class="col-md-2"><div Noinput="2" class="btn btn-danger btn-block btn-evidencia-cx">X</div></div></div>
                                    <div id="Content-3c" class="row"><div class="col-md-10"><input class="btn btn-default btn-block btn-evidencia-c" id="Evidencia-3c" name="Evidencia-3c" noEvidencia="3" type="file" accept="image/x-png,image/jpeg,application/pdf"></div><div class="col-md-2"><div Noinput="3" class="btn btn-danger btn-block btn-evidencia-cx">X</div></div></div>
                                    <div id="Content-4c" class="row"><div class="col-md-10"><input class="btn btn-default btn-block btn-evidencia-c" id="Evidencia-4c" name="Evidencia-4c" noEvidencia="4" type="file" accept="image/x-png,image/jpeg,application/pdf"></div><div class="col-md-2"><div Noinput="4" class="btn btn-danger btn-block btn-evidencia-cx">X</div></div></div>
                                    <div id="Content-5c" class="row"><div class="col-md-10"><input class="btn btn-default btn-block btn-evidencia-c" id="Evidencia-5c" name="Evidencia-5c" noEvidencia="5" type="file" accept="image/x-png,image/jpeg,application/pdf"></div><div class="col-md-2"><div Noinput="5" class="btn btn-danger btn-block btn-evidencia-cx">X</div></div></div>
                                    <div id="Content-6c" class="row"><div class="col-md-10"><input class="btn btn-default btn-block btn-evidencia-c" id="Evidencia-6c" name="Evidencia-6c" noEvidencia="6" type="file" accept="image/x-png,image/jpeg,application/pdf"></div><div class="col-md-2"><div Noinput="6" class="btn btn-danger btn-block btn-evidencia-cx">X</div></div></div>
                                    <div id="Content-7c" class="row"><div class="col-md-10"><input class="btn btn-default btn-block btn-evidencia-c" id="Evidencia-7c" name="Evidencia-7c" noEvidencia="7" type="file" accept="image/x-png,image/jpeg,application/pdf"></div><div class="col-md-2"><div Noinput="7" class="btn btn-danger btn-block btn-evidencia-cx">X</div></div></div>
                                    <div id="Content-8c" class="row"><div class="col-md-10"><input class="btn btn-default btn-block btn-evidencia-c" id="Evidencia-8c" name="Evidencia-8c" noEvidencia="8" type="file" accept="image/x-png,image/jpeg,application/pdf"></div><div class="col-md-2"><div Noinput="8" class="btn btn-danger btn-block btn-evidencia-cx">X</div></div></div>
                                    <div id="Content-9c" class="row"><div class="col-md-10"><input class="btn btn-default btn-block btn-evidencia-c" id="Evidencia-9c" name="Evidencia-9c" noEvidencia="9" type="file" accept="image/x-png,image/jpeg,application/pdf"></div><div class="col-md-2"><div Noinput="9" class="btn btn-danger btn-block btn-evidencia-cx">X</div></div></div>
                                </div>
                            </div>
                        </form>

                        <button id="gestion-credito-rechazar" type="button" class="btn btn-danger pull-left" data-dismiss="modal" onclick="rechazaNotaCreditoCobranza()">&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<i class="fa fa-thumbs-down"></i>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp</button>
                        <button id="gestion-credito-aprobar" type="button" class="btn btn-success pull-right" data-dismiss="modal" onclick="aprobarNotaCreditoCobranza()">&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<i class="fa fa-thumbs-up"></i>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="verComentarios" class="modal fade" role="dialog">
        <div class="modal-dialog">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-body">
                        <div class="box-body">
                            <div class="row">
                                <div class="col-xs-12">
                                    <h2 class="page-header">
                                        <i class="fa fa-file-text"></i>&nbsp;&nbsp;&nbsp;Comentarios nota de crédito
                                    </h2>
                                </div>
                            </div>
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th class="th-stationery">Departamento</th>
                                        <th class="th-stationery">Usuario</th>
                                        <th class="th-stationery">Comentario</th>
                                    </tr>
                                </thead>
                                <tbody id="tbody-comentarios"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <div id="verImagenes" class="modal fade" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-body">
                    <div class="box-body">
                        <div class="row">
                            <div class="col-xs-12">
                                <h2 class="page-header">
                                    <i class="fa fa-file-text"></i>&nbsp;&nbsp;&nbsp;Evidencias de nota de crédito
                                </h2>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-sm-6 invoice-col">
                                <address>
                                    <small id="set-FolioNC"></small><br>
                                    <small id="set-ClienteNC"></small><br>
                                </address>
                            </div>
                            <div class="col-sm-6 invoice-col">
                                <address>
                                    <small id="set-FolioOrigenNC"></small><br>
                                    <small id="set-FolioDestinoNC"></small><br>
                                    <small id="set-TipoDocumentoNC"></small><br>
                                </address>
                            </div>
                        </div>
                        <div class="row">
                            <div class="box box-widget widget-user">
                                <div class="widget-user-image">
                                    <!--<img class="img-circle" src="../dist/img/boxed-bg.jpg" alt="User Avatar">-->
                                </div>
                                <div class="widget-user-header bg-blue">
                                    <div class="row" id="carrousel-dinamic">

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <form id="frm-addImagenes" method="post" class="form-horizontal" enctype="multipart/form-data">
                        <div class="box-body">
                            <div class="form-group">
                                <div class="row">
                                    <div class="box-body">
                                        <h2 class="page-header">
                                            <i class="fa fa-file-text"></i>&nbsp;&nbsp;&nbsp;Agregar evidencia
                                            <input type="hidden" id="NotaCreditoId" name="NotaCreditoId">
                                            <br />
                                            <small style="color:red !important">*Nota: Archivos admitido (Imagen y archivo PDF)</small>
                                        </h2>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-xs-12">
                            <div class="form-group">
                                <div id="Content-1" class="row"><div class="col-md-10"><input class="btn btn-default btn-block btn-evidencia" id="Evidencia-1" name="Evidencia-1" noEvidencia="1" type="file" accept="image/x-png,image/jpeg,application/pdf"></div><div class="col-md-2"><div Noinput="1" class="btn btn-danger btn-block btn-evidencia-x">X</div></div></div>
                                <div id="Content-2" class="row"><div class="col-md-10"><input class="btn btn-default btn-block btn-evidencia" id="Evidencia-2" name="Evidencia-2" noEvidencia="2" type="file" accept="image/x-png,image/jpeg,application/pdf"></div><div class="col-md-2"><div Noinput="2" class="btn btn-danger btn-block btn-evidencia-x">X</div></div></div>
                                <div id="Content-3" class="row"><div class="col-md-10"><input class="btn btn-default btn-block btn-evidencia" id="Evidencia-3" name="Evidencia-3" noEvidencia="3" type="file" accept="image/x-png,image/jpeg,application/pdf"></div><div class="col-md-2"><div Noinput="3" class="btn btn-danger btn-block btn-evidencia-x">X</div></div></div>
                                <div id="Content-4" class="row"><div class="col-md-10"><input class="btn btn-default btn-block btn-evidencia" id="Evidencia-4" name="Evidencia-4" noEvidencia="4" type="file" accept="image/x-png,image/jpeg,application/pdf"></div><div class="col-md-2"><div Noinput="4" class="btn btn-danger btn-block btn-evidencia-x">X</div></div></div>
                                <div id="Content-5" class="row"><div class="col-md-10"><input class="btn btn-default btn-block btn-evidencia" id="Evidencia-5" name="Evidencia-5" noEvidencia="5" type="file" accept="image/x-png,image/jpeg,application/pdf"></div><div class="col-md-2"><div Noinput="5" class="btn btn-danger btn-block btn-evidencia-x">X</div></div></div>
                                <div id="Content-6" class="row"><div class="col-md-10"><input class="btn btn-default btn-block btn-evidencia" id="Evidencia-6" name="Evidencia-6" noEvidencia="6" type="file" accept="image/x-png,image/jpeg,application/pdf"></div><div class="col-md-2"><div Noinput="6" class="btn btn-danger btn-block btn-evidencia-x">X</div></div></div>
                                <div id="Content-7" class="row"><div class="col-md-10"><input class="btn btn-default btn-block btn-evidencia" id="Evidencia-7" name="Evidencia-7" noEvidencia="7" type="file" accept="image/x-png,image/jpeg,application/pdf"></div><div class="col-md-2"><div Noinput="7" class="btn btn-danger btn-block btn-evidencia-x">X</div></div></div>
                                <div id="Content-8" class="row"><div class="col-md-10"><input class="btn btn-default btn-block btn-evidencia" id="Evidencia-8" name="Evidencia-8" noEvidencia="8" type="file" accept="image/x-png,image/jpeg,application/pdf"></div><div class="col-md-2"><div Noinput="8" class="btn btn-danger btn-block btn-evidencia-x">X</div></div></div>
                                <div id="Content-9" class="row"><div class="col-md-10"><input class="btn btn-default btn-block btn-evidencia" id="Evidencia-9" name="Evidencia-9" noEvidencia="9" type="file" accept="image/x-png,image/jpeg,application/pdf"></div><div class="col-md-2"><div Noinput="9" class="btn btn-danger btn-block btn-evidencia-x">X</div></div></div>
                            </div>
                        </div>
                        <div class="box-body">
                            <div class="col-md-12">
                                <div class="col-md-10">
                                </div>
                                <div class="col-md-2">
                                    <div class="row pull-right">
                                        <button id="btn-addevidencia" type="button" class="btn btn-primary btn-lg rigth-block">
                                            <i class="fa fa-plus"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>

                </div>

            </div>

        </div>
    </div>


    <div id="verImagenesMax" class="modal fade" role="dialog">
        <div class="modal-dialog modal-lg">
            <div id="modalMaxImg" class="modal-content modal">
                <div class="modal-body">
                    <div class="row">
                        <img id="imagen" class="img-responsive center-block" src="../dist/img/boxed-bg.jpg" style="max-height:70%; max-width:80%;" alt="User Avatar">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="detalleAlmacenPartida" class="modal fade" role="dialog">
        <div class="modal-dialog">

            <div class="modal-content">

                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Detalle para partidas para almacen de articulos</h4>
                    <input type="hidden" id="gestion-almacen-folioNC-partida" />
                    <input type="hidden" id="gestion-almacen-articulo-partida" />
                    <input type="hidden" id="gestion-almacen-articulo-partida-cantidadoriginal" />
                    <input type="hidden" id="gestion-almacen-articulo-partida-cantidadoriginalrestante" />
                    <input type="hidden" id="gestion-almacen-articulo-partida-cantidadactual" />
                </div>

                <div class="modal-body">
                    <div class="box-body">

                        <div class="row">
                            <div class="col-lg-12 col-md-12 col-sm-12" style="padding-bottom: 10px;">
                                <div class="input-group">
                                    <span class="input-group-addon">Articulo</span>
                                    <input id="gestion-almacen-articulo-partida-value" type="text" class="form-control">
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-12 col-md-12 col-sm-12" style="padding-bottom: 10px;">
                                <div class="input-group">
                                    <span class="input-group-addon">Cantidad disponible</span>
                                    <input id="gestion-almacen-articulo-partida-cantidad-value" type="text" class="form-control">
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-lg-12 col-md-12 col-sm-12" style="padding-bottom: 10px;">
                                <div class="input-group">
                                    <span id="gestion-almacen-articulo-partida-cantidad-utilizado" class="input-group-addon text-warning"></span>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-lg-12 col-md-12 col-sm-12" style="padding-bottom: 10px;">
                                <div class="input-group">
                                    <button id="gestion-almacen-generar-partida" type="button" class="btn btn-success pull-right" onclick="agregarpartidaItemAlmacen()">
                                        Agregar partidas &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp
                                        <i class="fa fa-plus" aria-hidden="true"></i>
                                        &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-lg-12 col-md-12 col-sm-12">
                                <div class="table table-responsive">
                                    <table class="table table-bordered" id="Conceptos">
                                        <thead>
                                            <tr>
                                                <td style="min-width: 150px;" class="th-stationery">Articulo</td>
                                                <td class="th-stationery">Cantidad</td>
                                                <td class="th-stationery">Almacen</td>
                                                <td class="th-stationery">Eliminar</td>
                                            </tr>
                                        </thead>
                                        <tbody id="tabla-invoice-detalle-almacen-partidas"></tbody>
                                        <tfoot>

                                        </tfoot>
                                    </table>
                                </div>
                            </div>
                        </div>



                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-default pull-left" data-dismiss="modal" onclick="recargarvaloresAlmacenPartida()">Cancelar</button>
                    <button id="gestion-almacen-generar-partida-continuar" type="button" class="btn btn-success" onclick="continuarAgregarPartidaAlmacen()">
                        Continuar
                        <i class="fa fa-arrow-right" aria-hidden="true"></i>
                    </button>
                </div>

            </div>

        </div>
    </div>


</section>

<script>

    console.log('V2022.01.04');

    $("#SAP").hide();
    $("#cmbFiltros").hide();

    function calculateValues() {
        var sum = 0;
        $(".subtotal-hidden").each(function () {
            let sumado = this.value;
            if (!isNaN(sumado) && sumado.length != 0) {
                sum += parseFloat(sumado);
            }
        });
        let total = sum * 1.16;
        let iva = sum * 0.16;
        let subtotal = sum;
        $('#iva').text("Iva: "+formatNumber.new(iva.toFixed(2), "$ "));
        $('#subtotal').text("Subtotal: " + formatNumber.new(subtotal.toFixed(2), "$ "));
        $('#factura-subtotal-hide').val(subtotal);
        $('#total').text("Total: " +formatNumber.new(total.toFixed(2), "$ "));
    };

    $(document).on('click', '.remove', function () {
        var delete_row = $(this).data("row");
        $('#' + delete_row).remove();
        calculateValues();
    });


    function limpiarTablaFacturaNC() {
        $('#table-invoice').empty();
    }

    $("#btn-addevidencia").prop("disabled", true);

    // load
    initModule();
    initModule1();
    initModule2();
    initModule3();

    // genrencia
    function initModule1() {
        $("#Evidencia-1g").val('');
        $("#Evidencia-2g").val('');
        $("#Evidencia-3g").val('');
        $("#Evidencia-4g").val('');
        $("#Evidencia-5g").val('');
        $("#Evidencia-6g").val('');
        $("#Evidencia-7g").val('');
        $("#Evidencia-8g").val('');
        $("#Evidencia-9g").val('');

        $("#Content-2g").hide();
        $("#Content-3g").hide();
        $("#Content-4g").hide();
        $("#Content-5g").hide();
        $("#Content-6g").hide();
        $("#Content-7g").hide();
        $("#Content-8g").hide();
        $("#Content-9g").hide();
    }

    $(".btn-evidencia-g").change(function () {
        HideInputFileGerencia();
        var current = $(this).attr("noEvidencia");
        var next = Number(current) + 1;
        console.log(next);
        $("#Content-" + next+"g").show();
    });

    $(".btn-evidencia-gx").click(function () {
        var current = $(this).attr("noinput");
        $("#Evidencia-" + current + "g").val('');
        HideInputFileGerencia();

    });

    function HideInputFileGerencia() {
        for (var i = 2; i < 10; i++) {
            var content = $("#Evidencia-" + i+"g").val();
            if (content == '') {
                $("#Content-" + i + "g").hide();
                $("#Evidencia-" + i+"g" ).val('');
            }
        }
    }

    // direccion
    function initModule2() {
        $("#Evidencia-1d").val('');
        $("#Evidencia-2d").val('');
        $("#Evidencia-3d").val('');
        $("#Evidencia-4d").val('');
        $("#Evidencia-5d").val('');
        $("#Evidencia-6d").val('');
        $("#Evidencia-7d").val('');
        $("#Evidencia-8d").val('');
        $("#Evidencia-9d").val('');

        $("#Content-2d").hide();
        $("#Content-3d").hide();
        $("#Content-4d").hide();
        $("#Content-5d").hide();
        $("#Content-6d").hide();
        $("#Content-7d").hide();
        $("#Content-8d").hide();
        $("#Content-9d").hide();
    }

    $(".btn-evidencia-d").change(function () {
        HideInputFileDireccion();
        var current = $(this).attr("noEvidencia");
        var next = Number(current) + 1;
        $("#Content-" + next+"d").show();
    });

    $(".btn-evidencia-dx").click(function () {
        var current = $(this).attr("noinput");
        $("#Evidencia-" + current + "d").val('');
        HideInputFileDireccion();

    });

    function HideInputFileDireccion() {
        for (var i = 2; i < 10; i++) {
            var content = $("#Evidencia-" + i + "d").val();
            if (content == '') {
                $("#Content-" + i + "d").hide();
                $("#Evidencia-" + i+"d").val('');
            }
        }
    }

    // inventario
    function initModule3() {
        $("#gestion-almacen-aprobar").prop("disabled", true);
        $("#Evidencia-1a").val('');
        $("#Evidencia-2a").val('');
        $("#Evidencia-3a").val('');
        $("#Evidencia-4a").val('');
        $("#Evidencia-5a").val('');
        $("#Evidencia-6a").val('');
        $("#Evidencia-7a").val('');
        $("#Evidencia-8a").val('');
        $("#Evidencia-9a").val('');

        $("#Content-2a").hide();
        $("#Content-3a").hide();
        $("#Content-4a").hide();
        $("#Content-5a").hide();
        $("#Content-6a").hide();
        $("#Content-7a").hide();
        $("#Content-8a").hide();
        $("#Content-9a").hide();
    }
    let aux = 1;
    $(".btn-evidencia-a").change(function () {
        HideInputFileAlmacen();
        var current = $(this).attr("noEvidencia");
        var next = Number(current) + 1;
        console.log(next);
        if (next > 1 && $("#Evidencia-" + current + "a").val() != '') {
            //btn-addevidencia
            $("#gestion-almacen-aprobar").prop("disabled", false);
            aux++;
        }
        else {
            $("#gestion-almacen-aprobar").prop("disabled", true);
        }
        $("#Content-" + next + "a").show();
    });
    $(".btn-evidencia-ax").click(function () {
        var current = $(this).attr("noinput");
        if (aux > 0) {
            aux--;
        }
        console.log("Elimado: " + aux);
        $("#Evidencia-" + current + "a").val('');
        if ($("#Evidencia-" + current + "a").val() == '' && (aux==0)) {
            $("#gestion-almacen-aprobar").prop("disabled", true);
        }
        HideInputFileAlmacen();

    });

    function HideInputFileAlmacen() {
        for (var i = 2; i < 10; i++) {
            var content = $("#Evidencia-" + i + "a").val();
            if (content == '') {
                $("#Content-" + i + "a").hide();
                $("#Evidencia-" + i + "a").val('');
            }
        }
    }


    // credito y cobranza
    function initModule3() {
        $("#Evidencia-1c").val('');
        $("#Evidencia-2c").val('');
        $("#Evidencia-3c").val('');
        $("#Evidencia-4c").val('');
        $("#Evidencia-5c").val('');
        $("#Evidencia-6c").val('');
        $("#Evidencia-7c").val('');
        $("#Evidencia-8c").val('');
        $("#Evidencia-9c").val('');

        $("#Content-2c").hide();
        $("#Content-3c").hide();
        $("#Content-4c").hide();
        $("#Content-5c").hide();
        $("#Content-6c").hide();
        $("#Content-7c").hide();
        $("#Content-8c").hide();
        $("#Content-9c").hide();
    }

    $(".btn-evidencia-c").change(function () {
        HideInputFileCobranza();
        var current = $(this).attr("noEvidencia");
        var next = Number(current) + 1;
        $("#Content-" + next + "c").show();
    });

    $(".btn-evidencia-cx").click(function () {
        var current = $(this).attr("noinput");
        $("#Evidencia-" + current + "c").val('');
        HideInputFileCobranza();
    });

    function HideInputFileCobranza() {
        for (var i = 2; i < 10; i++) {
            var content = $("#Evidencia-" + i + "c").val();
            if (content == '') {
                $("#Content-" + i + "c").hide();
                $("#Evidencia-" + i + "c").val('');
            }
        }
    }
    // ver Imagenes
    function initModule() {
        $("#Evidencia-1").val('');
        $("#Evidencia-2").val('');
        $("#Evidencia-3").val('');
        $("#Evidencia-4").val('');
        $("#Evidencia-5").val('');
        $("#Evidencia-6").val('');
        $("#Evidencia-7").val('');
        $("#Evidencia-8").val('');
        $("#Evidencia-9").val('');

        $("#Content-2").hide();
        $("#Content-3").hide();
        $("#Content-4").hide();
        $("#Content-5").hide();
        $("#Content-6").hide();
        $("#Content-7").hide();
        $("#Content-8").hide();
        $("#Content-9").hide();
    }

    $(".btn-evidencia").change(function () {
        HideInputFile();
        var current = $(this).attr("noEvidencia");
        var next = Number(current) + 1;
        if (next > 1) {
            //btn-addevidencia
            $("#btn-addevidencia").prop("disabled", false);
        }
        else {
            $("#btn-addevidencia").prop("disabled", true);
        }
        $("#Content-" + next).show();
    });

    $(".btn-evidencia-x").click(function () {
        var current = $(this).attr("noinput");
        $("#Evidencia-" + current).val('');
        HideInputFile();
    });

    function HideInputFile() {
        for (var i = 2; i < 10; i++) {
            var content = $("#Evidencia-" + i).val();
            if (content == '') {
                $("#Content-" + i).hide();
                $("#Evidencia-" + i).val('');
            }
        }
    }
    // ver


    function verImagenesNC(FolioNC) {
        initModule();
        initModule1();
        initModule2();
        initModule3();

        $("#NotaCreditoId").val('');
        $("#set-FolioNC").text('');
        $("#set-ClienteNC").text('');
        $("#set-FolioOrigenNC").text('');
        $("#set-FolioDestinoNC").text('');
        $("#set-TipoDocumentoNC").text('');

        // dibujar el carrucel
        $("#carrousel-dinamic").html('');
        $("#NotaCreditoId").val(FolioNC);

        $.ajax({
            contentType: "application/json; charset=utf-8",
            url: '@Url.Action("GetImagenenNotaCredito", "NotaCredito")',
            async: false,
            timeout: 3000,
            type: 'POST',
            data: '{"FolioNC":"' + FolioNC + '"}',
            dataType: "json",
        }).done(function (data) {
            if (data.Context != null) {
                //NotaCreditoId
                //$("#NotaCreditoId").val(data.Context.Identifier);
                $("#set-FolioNC").text("FOLIO SIE: " + data.Context.Identifier);
                $("#set-ClienteNC").text("CLIENTE: " + data.Context.CardName);
                $("#set-FolioOrigenNC").text("FOLIO ORIGEN: " + data.Context.FolioOrigen);
                $("#set-FolioDestinoNC").text("FOLIO DESTINO: " + data.Context.FolioDestino);
                $("#set-TipoDocumentoNC").text("TIPO DOCUMENTO: " + data.Context.TipoDocumento);

                // dibujar el carrucel
                $("#carrousel-dinamic").html('');
                var aux = 0;
                var cabeceras = '';
                var detalles = '';
                //llenamos las cabeceras y los detalles..
                if (data.Context.Imagenes.length <= 0) {
                    cabeceras = cabeceras + '<li data-target="#carousel-generic1" data-slide-to="0" class="active"></li>';
                    detalles = detalles + '<div class="item active"><img src="../dist/img/employee.jpg" /></div>';
                    aux++;
                }
                else {
                    $.each(data.Context.Imagenes, function (index, value) {
                        let tipo = value.Tipo;
                        if (aux == 0) {
                            cabeceras = cabeceras + '<li data-target="#carousel-generic1" data-slide-to="' + index + '" class="active"></li>';
                        } else {
                            cabeceras = cabeceras + '<li data-target="#carousel-generic1" data-slide-to="' + index + '"></li>';
                        }
                        if (aux == 0) {
                            if (tipo == 1) {
                                detalles = detalles + '<div class="item active"><img onclick="image(this)" class="img-responsive center-block" style="width:auto; max-height:800px; max-width: 400px;" src="data:image/png;base64,' + value.ImagenBase64 + '" /> <div class="carousel-caption"><p>Usuario: ' + value.UserName + ' </p>   </div> </div > ';
                            }
                            else if (tipo == 2) {
                                detalles = detalles + '<div class="item active"> <iframe align="center" style="width:600px; height:600px; max-height:800px; max-width: 400px;" src="data:application/pdf;base64,' + value.ImagenBase64 + '" /> <div class="carousel-caption"><p>Usuario: ' + value.UserName + ' </p>   </div> </div > ';
                            }
                        } else {
                            if (tipo == 1) {
                                detalles = detalles + '<div class="item"><img onclick="image(this)" class="img-responsive center-block" style="width:auto; max-height:800px; max-width: 400px;" src="data:image/png;base64,' + value.ImagenBase64 + '" /> <div class="carousel-caption"><p>Usuario: ' + value.UserName + ' </p>   </div> </div > ';
                            }
                            else if (tipo == 2) {
                                detalles = detalles + '<div class="item"><iframe align="center" style="width:600px; height:600px; max-height:800px; max-width: 400px;" src="data:application/pdf;base64,' + value.ImagenBase64 + '" /> <div class="carousel-caption"><p>Usuario: ' + value.UserName + ' </p>   </div> </div > ';
                            }
                        }
                        aux++;
                    });
                }
                //se dibuja el carrusel
                $("#carrousel-dinamic").append(
                    "<div class='col-md-12' >" +
                        "<div id='carousel-generic1' class='carousel slide' data-ride='carousel' style='width:80%;margin-left:10%;'>" +
                        "<ol id='contenedor-carousel-cabecera' class='carousel-indicators'>" +
                        cabeceras +
                    "<\/ol>" +
                    "<div id='carousel-detalles' class='carousel-inner' role='listbox'>" +
                    detalles +
                    "<\/div>" +
                        "<a class='left carousel-control' href='#carousel-generic1' role='button' data-slide='prev'>" +
                        "<span class='glyphicon glyphicon-chevron-left' aria-hidden='true'><\/span>" +
                        "<span class='sr-only'>Previous<\/span>" +
                    "<\/a>" +
                    "<a class='right carousel-control' href='#carousel-generic1' role='button' data-slide='next'>" +
                    "<span class='glyphicon glyphicon-chevron-right' aria-hidden='true'><\/span>" +
                    "<span class='sr-only'>Next<\/span>" +
                    "<\/a>" +
                    "<\/div>" +
                    "<\/div>");

            }
            else {
                console.log("Data Null");
            }
            }).always(function (data) {
                //Console.log(data);
            }).fail(function (data) {
                //Console.log(data);
            });
    }

    function image(img) {
        var src = img.src;
        //    window.open(src);
        $('#verImagenesMax').modal('show');
        $('#modalMaxImg').show();
        //console.log(src);
        $("#imagen").attr("src", src);
    }


    $("#btn-addevidencia").click(function () {

        if($("#NotaCreditoId").val() != ""){
            var formData = new FormData($("#frm-addImagenes")[0]);
            $("#btn-addevidencia").attr("disabled", true);
				$.ajax({
					url: '@Url.Action("AddNotaCreditoEvidencia", "NotaCredito")',
					type: "POST",
					data: formData,
					contentType: false,
					processData: false,
                    success: function (data) {
						if (data != null) {

                            if (data.Context != null) {
                                if (data.Context) {
                                    swal({
                                        title: 'OK',
                                        text: 'La evidencia se guardó correctamente.',
                                        icon: 'success'
                                    });
                                    initModule2();
                                    $('#verImagenes').modal('hide');
                                }
                                else {
                                    swal({
                                        title: 'Error',
                                        text: 'Ha fallado al guardar la evidencia.',
                                        icon: 'Error'
                                    });
                                }
							}
							else
							{
								swal({
                                    title: 'Error!',
                                    text: 'Ocurrio un error al intentar guardar la evidencia. ' + data.Message,
									icon: 'Error'
								});
							}
						}
					}
				});
			}
            else{
				alert("No se ha seleccionado la nota de crédito a evidenciar.");
			}
    });

    //CONSULTA LAS NOTAS DE CREDITO CON ESTATUS CERO CREADAS POR EL USUARIO
    // APROBACION DE GERENCIA
    function getNotaCreditoEstatusGerencia1() {
        $("#comentario").hide();
        var Email = localStorage.getItem("UserEmail");
        $.ajax({
            contentType: "application/json; charset=utf-8",
            url: '@Url.Action("GetNotaCreditoHistoryAllZero", "Venta")',
            async: false,
            timeout: 3000,
            type: 'POST',
            data: '{"Email":"' + Email + '"}',
            dataType: "json",
            success: function (data) {
                if (data != null && $.isArray(data.Context)) {
                    var VP = $('#factura-origen').DataTable();
                    VP.destroy();
                    $("#table-invoice-history").html('');
                    $.each(data.Context, function (index, value) {
                        //alert(value.Sequence);
                        if (value.TipoDocumento == 'S') {
                            value.TipoDocumento = 'Servicio'
                            if (value.Estatus == 1) {
                                value.Estatus = 'Aprobación pendiente por la dirección'
                            }
                        }
                        if (value.TipoDocumento == 'I') {
                            value.TipoDocumento = 'Inventario';
                            if (value.Estatus == 1) {
                                value.Estatus = 'Aprobación pendiente por el almacén'
                            }
                        }
                        if (value.Estatus == 0) {
                            value.Estatus = 'Aprobación pendiente por la gerencia'
                        }
                        if (value.Estatus == 2) {
                            value.Estatus = 'Aprobación pendiente por dirección'
                        }
                        if (value.Estatus == 3) {
                            value.Estatus = 'Autorizada'
                        }
                        if (value.Estatus == 5) {
                            value.Estatus = 'Rechazado'
                        }
                        $("#table-invoice-history").append(
                            "<tr>\
                                <td>" + value.Sequence + "</td>\
                                <td>" + value.CardCode + " - " + value.CardName + "</td>\
                                <td>" + value.FolioOrigen + "</td>\
                                <td>" + value.FolioDestino + "</td>\
                                <td>" + value.TipoDocumento + "</td>\
                                <td>" + value.Concepto + "</td>\
                                <td>" + value.Comentario + "</td>\
                                <td>" + value.Usuario + "</td>\
                                <td>" + value.Estatus + "</td>\
                                <td>" + moment(value.Fecha).format("YYYY-MM-DD HH:mm:ss") + "</td>\
                                <td align='center'>\
                                    <a class='btn btn-primary' data-target='#gestionGerencia' data-toggle='modal' onclick='getAprobacionGerencia("+ value.Sequence + ")' data-id='" + value.Sequence + "' href= '#'>\
                                        <i class='fa fa-cogs'></i>\
                                    </a>\
                                </td>\
                                <td align='center'>\
                                    <a class='btn btn-info' data-target='#verImagenes' data-toggle='modal' onclick='verImagenesNC("+ value.Sequence + ")' data-id='" + value.Sequence + "' href= '#'>\
                                        <i class='fa fa-eye'></i>\
                                    </a>\
                                </td>\
                                </tr>");
                    });

                    $('#factura-origen').DataTable({
                        "lengthMenu": [[10, 20, 30, -1], [10, 20, 30, "All"]],
                        dom: 'Bfrtip',
                        stateSave: true,
                        "paging": true,
                        "searching": true,
                        "language": {
                            "url": "//cdn.datatables.net/plug-ins/1.10.13/i18n/Spanish.json"
                        }
                    });
                }
            },
            error: function () {
                swal("Error en la api: GetNotaCreditoHistoryAllZero");
            }
        });
    }

    function getHistoricoNotaCreditoZero() {
        $("#comentario").hide();
        $("#table-invoice-history").empty();
        var Email = localStorage.getItem("UserEmail");
        $.ajax({
            contentType: "application/json; charset=utf-8",
            url: '@Url.Action("GetNotaCreditoHistoryAllZero", "Venta")',
            async: false,
            timeout: 3000,
            type: 'POST',
            data: '{"Email":"' + Email + '"}',
            dataType: "json",
            success: function (data) {
                if (data != null && $.isArray(data.Context)) {

                    var VP = $('#factura-origen').DataTable();
                    VP.destroy();
                    $("#table-invoice-history").html('');

                    $.each(data.Context, function (index, value) {
                        if (value.TipoDocumento == 'S') {
                            value.TipoDocumento = 'Servicio'
                            if (value.Estatus == 1) {
                                value.Estatus = 'Aprobación pendiente por la dirección'
                            }
                        }
                        if (value.TipoDocumento == 'I') {
                            value.TipoDocumento = 'Inventario';
                            if (value.Estatus == 1) {
                                value.Estatus = 'Aprobación pendiente por el almacén'
                            }
                        }
                        if (value.Estatus == 0) {
                            value.Estatus = 'Aprobación pendiente por la gerencia'
                        }
                        if (value.Estatus == 2) {
                            value.Estatus = 'Aprobación pendiente por dirección'
                        }
                        if (value.Estatus == 3) {
                            value.Estatus = 'Autorizada'
                        }
                        if (value.Estatus == 5) {
                            value.Estatus = 'Rechazado'
                        }
                        $("#table-invoice-history").append(
                            "<tr>\
                                <td>" + value.Sequence + "</td>\
                                <td>" + value.CardCode + " - " + value.CardName + "</td>\
                                <td>" + value.FolioOrigen + "</td>\
                                <td>" + value.FolioDestino + "</td>\
                                <td>" + value.TipoDocumento + "</td>\
                                <td>" + value.Concepto + "</td>\
                                <td>" + value.Comentario + "</td>\
                                <td>" + value.Usuario + "</td>\
                                <td>" + value.Estatus + "</td>\
                                <td>" + moment(value.Fecha).format("YYYY-MM-DD HH:mm:ss") + "</td>\
                                <td align='center'>\
                                    <a class='btn btn-primary' data-target='#gestionGerencia' data-toggle='modal' onclick='getAprobacionGerencia("+ value.Sequence + ")' data-id='" + value.Sequence + "' href= '#'>\
                                        <i class='fa fa-cogs'></i>\
                                    </a>\
                                </td>\
                                <td align='center'>\
                                    <a class='btn btn-info' data-target='#verImagenes' data-toggle='modal' onclick='verImagenesNC("+ value.Sequence + ")' data-id='" + value.Sequence + "' href= '#'>\
                                        <i class='fa fa-eye'></i>\
                                    </a>\
                                </td>\
                                </tr>");
                    });

                    $('#factura-origen').DataTable({
                        "lengthMenu": [[10, 20, 30, -1], [10, 20, 30, "All"]],
                        dom: 'Bfrtip',
                        stateSave: true,
                        "paging": true,
                        "searching": true,
                        "language": {
                            "url": "//cdn.datatables.net/plug-ins/1.10.13/i18n/Spanish.json"
                        }
                    });
                }
            },
            error: function () {
                swal("Error en la api: UsuarioFolio");
            }
        });
    }
    //CONSULTA LAS NOTAS DE CREDITO SERVICIOS CON ESTATUS UNO CREADAS POR EL USUARIO
    function getHistoricoNotaCreditoServicioOne() {
        $("#comentario").show();
        $("#table-invoice-history").empty();
        $.ajax({
            contentType: "application/json; charset=utf-8",
            url: '@Url.Action("GetNotaCreditoHistoryAllServicioOne", "Venta")',
            async: false,
            timeout: 3000,
            type: 'POST',
            data: '{}',
            dataType: "json",
            success: function (data) {
                if (data != null && $.isArray(data.Context)) {

                    var VP = $('#factura-origen').DataTable();
                    VP.destroy();
                    $("#table-invoice-history").html('');

                    $.each(data.Context, function (index, value) {
                        if (value.TipoDocumento == 'S') {
                            value.TipoDocumento = 'Servicio'
                            if (value.Estatus == 1) {
                                value.Estatus = 'Aprobación pendiente por la dirección'
                            }
                        }
                        if (value.TipoDocumento == 'I') {
                            value.TipoDocumento = 'Inventario';
                            if (value.Estatus == 1) {
                                value.Estatus = 'Aprobación pendiente por el almacén'
                            }
                        }
                        if (value.Estatus == 0) {
                            value.Estatus = 'Aprobación pendiente por la gerencia'
                        }
                        if (value.Estatus == 2) {
                            value.Estatus = 'Aprobación pendiente por dirección'
                        }
                        if (value.Estatus == 3) {
                            value.Estatus = 'Autorizada'
                        }
                        if (value.Estatus == 5) {
                            value.Estatus = 'Rechazado'
                        }
                        $("#table-invoice-history").append(
                            "<tr>\
                                <td>" + value.Sequence + "</td>\
                                <td>" + value.CardCode + " - " + value.CardName + "</td>\
                                <td>" + value.FolioOrigen + "</td>\
                                <td>" + value.FolioDestino + "</td>\
                                <td>" + value.TipoDocumento + "</td>\
                                <td>" + value.Concepto + "</td>\
                                <td>" + value.Comentario + "</td>\
                                <td>" + value.Usuario + "</td>\
                                <td>" + value.Estatus + "</td>\
                                <td>" + moment(value.Fecha).format("YYYY-MM-DD HH:mm:ss") + "</td>\
                                <td align='center'>\
                                    <a class='btn btn-primary' data-target='#gestionDireccion' data-toggle='modal' onclick='getAprobacionDireccion("+ value.Sequence + ")' data-id='" + value.Sequence + "' href= '#'>\
                                        <i class='fa fa-cogs'></i>\
                                    </a>\
                                </td>\
                                <td align='center'>\
                                    <a class='btn btn-info' data-target='#verComentarios' data-toggle='modal' onclick='verComentarios("+ value.Sequence + ")' data-id='" + value.Sequence + "' href= '#'>\
                                        <i class='fa fa-comment'></i>\
                                    </a>\
                                </td>\
                                <td align='center'>\
                                    <a class='btn btn-info' data-target='#verImagenes' data-toggle='modal' onclick='verImagenesNC("+ value.Sequence + ")' data-id='" + value.Sequence + "' href= '#'>\
                                        <i class='fa fa-eye'></i>\
                                    </a>\
                                </td>\
                            </tr>");

                    });

                    $('#factura-origen').DataTable({
                        "lengthMenu": [[10, 20, 30, -1], [10, 20, 30, "All"]],
                        dom: 'Bfrtip',
                        stateSave: true,
                        buttons: [
                            'excel', 'pdf'
                        ],
                        "paging": true,
                        "searching": true,
                        "language": {
                            "url": "//cdn.datatables.net/plug-ins/1.10.13/i18n/Spanish.json"
                        }
                    });

                }
            },
            error: function () {
                swal("Error en la api: UsuarioFolio");
            }
        });
    }
    //CONSULTA LAS NOTAS DE CREDITO CON ESTATUS UNO DE CREADAS POR EL USUARIO ALMACEN
    function getHistoricoNotaCreditoOne() {
        $("#comentario").show();
        $("#table-invoice-history").empty();
        $.ajax({
            contentType: "application/json; charset=utf-8",
            url: '@Url.Action("GetNotaCreditoHistoryAllOne", "Venta")',
            async: false,
            timeout: 3000,
            type: 'POST',
            data: '{}',
            dataType: "json",
            success: function (data) {
                if (data != null && $.isArray(data.Context)) {

                    var VP = $('#factura-origen').DataTable();
                    VP.destroy();
                    $("#table-invoice-history").html('');

                    $.each(data.Context, function (index, value) {
                        if (value.TipoDocumento == 'S') {
                            value.TipoDocumento = 'Servicio'
                            if (value.Estatus == 1) {
                                value.Estatus = 'Aprobación pendiente por la dirección'
                            }
                        }
                        if (value.TipoDocumento == 'I') {
                            value.TipoDocumento = 'Inventario';
                            if (value.Estatus == 1) {
                                value.Estatus = 'Aprobación pendiente por el almacén'
                            }
                        }
                        if (value.Estatus == 0) {
                            value.Estatus = 'Aprobación pendiente por la gerencia';
                        }
                        if (value.Estatus == 2) {
                            value.Estatus = 'Aprobación pendiente por dirección';
                        }
                        if (value.Estatus == 3) {
                            value.Estatus = 'Autorizada';
                        }
                        if (value.Estatus == 4) {
                            value.Estatus = 'SAP';
                        }
                        if (value.Estatus == 5) {
                            value.Estatus = 'Rechazado';
                        }
                        $("#table-invoice-history").append(
                            "<tr>\
                                <td>" + value.Sequence + "</td>\
                                <td>" + value.CardCode + " - " + value.CardName + "</td>\
                                <td>" + value.FolioOrigen + "</td>\
                                <td>" + value.FolioDestino + "</td>\
                                <td>" + value.TipoDocumento + "</td>\
                                <td>" + value.Concepto + "</td>\
                                <td>" + value.Comentario + "</td>\
                                <td>" + value.Usuario + "</td>\
                                <td>" + value.Estatus + "</td>\
                                <td>" + moment(value.Fecha).format("YYYY-MM-DD HH:mm:ss") + "</td>\
                                <td align='center'>\
                                    <a class='btn btn-primary' data-target='#gestionAlmacen' data-toggle='modal' onclick='getAprobacionAlmacen("+ value.Sequence + ")' data-id='" + value.Sequence + "' href= '#'>\
                                        <i class='fa fa-cogs'></i>\
                                    </a>\
                                </td>\
                                <td align='center'>\
                                    <a class='btn btn-info' data-target='#verComentarios' data-toggle='modal' onclick='verComentarios("+ value.Sequence + ")' data-id='" + value.Sequence + "' href= '#'>\
                                        <i class='fa fa-comment'></i>\
                                    </a>\
                                </td>\
                                <td align='center'>\
                                    <a class='btn btn-info' data-target='#verImagenes' data-toggle='modal' onclick='verImagenesNC("+ value.Sequence + ")' data-id='" + value.Sequence + "' href= '#'>\
                                        <i class='fa fa-eye'></i>\
                                    </a>\
                                </td>\
                            </tr>");

                    });

                    $('#factura-origen').DataTable({
                        "lengthMenu": [[10, 20, 30, -1], [10, 20, 30, "All"]],
                        dom: 'Bfrtip',
                        stateSave: true,
                        buttons: [
                            'excel', 'pdf'
                        ],
                        "paging": true,
                        "searching": true,
                        "language": {
                            "url": "//cdn.datatables.net/plug-ins/1.10.13/i18n/Spanish.json"
                        }
                    });

                }
            },
            error: function () {
                swal("Error en la api: UsuarioFolio");
            }
        });
    }
    //CONSULTA LAS NOTAS DE CREDITO CON ESTATUS UNO DE CREDITO Y COBRANZA CREADAS POR EL USUARIO
    function getHistoricoNotaCreditoCobranzaOne() {
        $("#comentario").show();
        $("#table-invoice-history").empty();
        $.ajax({
            contentType: "application/json; charset=utf-8",
            url: '@Url.Action("GetNotaCreditoHistoryAllCreditoOne", "Venta")',
            async: false,
            timeout: 3000,
            type: 'POST',
            data: '{}',
            dataType: "json",
            success: function (data) {
                if (data != null && $.isArray(data.Context)) {

                    var VP = $('#factura-origen').DataTable();
                    VP.destroy();
                    $("#table-invoice-history").html('');

                    $.each(data.Context, function (index, value) {
                        if (value.TipoDocumento == 'S') {
                            value.TipoDocumento = 'Servicio'
                            if (value.Estatus == 1) {
                                value.Estatus = 'Aprobación pendiente por la dirección'
                            }
                        }
                        if (value.TipoDocumento == 'I') {
                            value.TipoDocumento = 'Inventario';
                            if (value.Estatus == 1) {
                                value.Estatus = 'Aprobación pendiente por el almacén'
                            }
                        }
                        if (value.Estatus == 0) {
                            value.Estatus = 'Aprobación pendiente por la gerencia'
                        }
                        if (value.Estatus == 2) {
                            value.Estatus = 'Aprobación pendiente por dirección'
                        }
                        if (value.Estatus == 3) {
                            value.Estatus = 'Autorizada'
                        }
                        if (value.Estatus == 5) {
                            value.Estatus = 'Rechazado'
                        }
                        $("#table-invoice-history").append(
                            "<tr>\
                                <td>" + value.Sequence + "</td>\
                                <td>" + value.CardCode + " - " + value.CardName + "</td>\
                                <td>" + value.FolioOrigen + "</td>\
                                <td>" + value.FolioDestino + "</td>\
                                <td>" + value.TipoDocumento + "</td>\
                                <td>" + value.Concepto + "</td>\
                                <td>" + value.Comentario + "</td>\
                                <td>" + value.Usuario + "</td>\
                                <td>" + value.Estatus + "</td>\
                                <td>" + moment(value.Fecha).format("YYYY-MM-DD HH:mm:ss") + "</td>\
                                <td align='center'>\
                                    <a class='btn btn-primary' data-target='#gestionAlmacen' data-toggle='modal' onclick='getAprobacionAlmacen("+ value.Sequence + ")' data-id='" + value.Sequence + "' href= '#'>\
                                        <i class='fa fa-cogs'></i>\
                                    </a>\
                                </td>\
                                <td align='center'>\
                                    <a class='btn btn-info' data-target='#verComentarios' data-toggle='modal' onclick='verComentarios("+ value.Sequence + ")' data-id='" + value.Sequence + "' href= '#'>\
                                        <i class='fa fa-comment'></i>\
                                    </a>\
                                </td>\
                                <td align='center'>\
                                    <a class='btn btn-info' data-target='#verImagenes' data-toggle='modal' onclick='verImagenesNC("+ value.Sequence + ")' data-id='" + value.Sequence + "' href= '#'>\
                                        <i class='fa fa-eye'></i>\
                                    </a>\
                                </td>\
                            </tr>");

                    });

                    $('#factura-origen').DataTable({
                        "lengthMenu": [[10, 20, 30, -1], [10, 20, 30, "All"]],
                        dom: 'Bfrtip',
                        stateSave: true,
                        buttons: [
                            'excel', 'pdf'
                        ],
                        "paging": true,
                        "searching": true,
                        "language": {
                            "url": "//cdn.datatables.net/plug-ins/1.10.13/i18n/Spanish.json"
                        }
                    });


                }
            },
            error: function () {
                swal("Error en la api: UsuarioFolio");
            }
        });
    }
    //CONSULTA LAS NOTAS DE CREDITO CON ESTATUS DOS CREADAS POR EL USUARIO
    function getHistoricoNotaCreditoTwo() {
        $("#comentario").show();
        $("#table-invoice-history").empty();
        $.ajax({
            contentType: "application/json; charset=utf-8",
            url: '@Url.Action("GetNotaCreditoHistoryAllTwo", "Venta")',
            async: false,
            timeout: 3000,
            type: 'POST',
            data: '{}',
            dataType: "json",
            success: function (data) {
                if (data != null && $.isArray(data.Context)) {

                    var VP = $('#factura-origen').DataTable();
                    VP.destroy();
                    $("#table-invoice-history").html('');


                    $.each(data.Context, function (index, value) {
                        if (value.TipoDocumento == 'S') {
                            value.TipoDocumento = 'Servicio'
                            if (value.Estatus == 1) {
                                value.Estatus = 'Aprobación pendiente por la dirección'
                            }
                        }

                        if (value.TipoDocumento == 'I') {
                            value.TipoDocumento = 'Inventario';
                            if (value.Estatus == 1) {
                                value.Estatus = 'Aprobación pendiente por el almacén'
                            }
                        }
                        if (value.Estatus == 0) {
                            value.Estatus = 'Aprobación pendiente por la gerencia'
                        }
                        if (value.Estatus == 2) {
                            value.Estatus = 'Aprobación pendiente por dirección'
                        }
                        if (value.Estatus == 3) {
                            value.Estatus = 'Autorizada'
                        }
                        if (value.Estatus == 5) {
                            value.Estatus = 'Rechazado'
                        }
                        $("#table-invoice-history").append(
                            "<tr>\
                                <td>" + value.Sequence + "</td>\
                                <td>" + value.CardCode + " - " + value.CardName + "</td>\
                                <td>" + value.FolioOrigen + "</td>\
                                <td>" + value.FolioDestino + "</td>\
                                <td>" + value.TipoDocumento + "</td>\
                                <td>" + value.Concepto + "</td>\
                                <td>" + value.Comentario + "</td>\
                                <td>" + value.Usuario + "</td>\
                                <td>" + value.Estatus + "</td>\
                                <td>" + moment(value.Fecha).format("YYYY-MM-DD HH:mm:ss") + "</td>\
                                <td align='center'>\
                                    <a class='btn btn-primary' data-target='#gestionDireccion' data-toggle='modal' onclick='getAprobacionDireccion("+ value.Sequence + ")' data-id='" + value.Sequence + "' href= '#'>\
                                        <i class='fa fa-cogs'></i>\
                                    </a>\
                                </td>\
                                <td align='center'>\
                                    <a class='btn btn-info' data-target='#verComentarios' data-toggle='modal' onclick='verComentarios("+ value.Sequence + ")' data-id='" + value.Sequence + "' href= '#'>\
                                        <i class='fa fa-comment'></i>\
                                    </a>\
                                </td>\
                                <td align='center'>\
                                    <a class='btn btn-info' data-target='#verImagenes' data-toggle='modal' onclick='verImagenesNC("+ value.Sequence + ")' data-id='" + value.Sequence + "' href= '#'>\
                                        <i class='fa fa-eye'></i>\
                                    </a>\
                                </td>\
                            </tr>");

                    });

                    $('#factura-origen').DataTable({
                        "lengthMenu": [[10, 20, 30, -1], [10, 20, 30, "All"]],
                        dom: 'Bfrtip',
                        stateSave: true,
                        buttons: [
                            'excel', 'pdf'
                        ],
                        "paging": true,
                        "searching": true,
                        "language": {
                            "url": "//cdn.datatables.net/plug-ins/1.10.13/i18n/Spanish.json"
                        }
                    });

                }
            },
            error: function () {
                swal("Error en la api: UsuarioFolio");
            }
        });
    };

    $("#cmbEstatus").change(function () {
        console.log($("#cmbEstatus").val());
        getHistoricoNotaCreditoAllStatusDireccion();
    });


    //CONSULTA LAS NOTAS DE CREDITO CON ESTATUS DOS CREADAS POR TODOS LOS USUARIOS
    // solo aplica para usuario de Direccion
    function getHistoricoNotaCreditoAllStatusDireccion() {

        let estatus = $("#cmbEstatus").val();
        //alert(estatus);
        $("#comentario").show();
        $("#table-invoice-history").empty();
        $.ajax({
            contentType: "application/json; charset=utf-8",
            url: '@Url.Action("GetNotaCreditoDireccion", "NotaCredito")',
            async: false,
            timeout: 3000,
            type: 'POST',
            data: '{"Estatus":"' + estatus + '"}',
            dataType: "json",
            success: function (data) {
                if (data != null && $.isArray(data.Context)) {
                    var VP = $('#factura-origen').DataTable();
                    VP.destroy();
                    $("#table-invoice-history").html('');
                    $.each(data.Context, function (index, value) {


                        let EstatusAprobacion = '';
                        if (value.TipoDocumento == 'S') {
                            if (value.Valor == 1 && value.Canal == 'RETAIL') {
                                EstatusAprobacion = 'Aprobación pendiente por crédito y cobranza';
                            }
                            else {
                                EstatusAprobacion = 'Aprobación pendiente por dirección';
                            }
                            value.TipoDocumento = 'Servicio'
                        }
                        if (value.TipoDocumento == 'I') {
                            if (value.Valor == 1) {
                                EstatusAprobacion = 'Aprobación pendiente por el almacén';
                            }
                            value.TipoDocumento = 'Inventario';
                        }
                        if (value.Valor == 0) {
                            if (value.ConceptoDescuento == 39) {
                                value.Estatus = 'Aprobación pendiente por credito y cobranza';
                            }
                            else {
                                EstatusAprobacion = 'Aprobación pendiente por gerencia'
                            }
                        }

                        if (value.Estatus == 2) {
                            value.Estatus = 'Aprobación pendiente por dirección'
                        }
                        if (value.Estatus == 3) {
                            value.Estatus = 'Autorizada'
                        }
                        if (value.Estatus == 4) {
                            value.Estatus = 'SAP'
                        }
                        if (value.Estatus == 5) {
                            value.Estatus = 'Rechazado'
                        }
                        $("#table-invoice-history").append(
                            "<tr>\
                                <td>" + value.Identifier + "</td>\
                                <td>" + value.ClienteName + "</td>\
                                <td>" + value.FolioOrigen + "</td>\
                                <td>" + value.FolioDestino + "</td>\
                                <td>" + value.TipoDocumento + "</td>\
                                <td>" + value.ConceptoDescuentoDetalle + "</td>\
                                <td>" + value.Comentario + "</td>\
                                <td>" + value.Usuario + "</td>\
                                <td>" + value.EstatusValor + "</td>\
                                <td>" + moment(value.Fecha).format("YYYY-MM-DD HH:mm:ss") + "</td>\
                                <td style='text-align:center;'>\
                                    <a class='btn btn-primary' data-target='#gestionDireccion' data-toggle='modal' onclick='getAprobacionDireccion("+ value.Identifier + ")' data-id='" + value.Identifier + "' href= '#'>\
                                        <i class='fa fa-cogs'></i>\
                                    </a>\
                                </td>\
                                <td style='text-align:center;'>\
                                    <a class='btn btn-info' data-target='#verComentarios' data-toggle='modal' onclick='verComentarios("+ value.Identifier + ")' data-id='" + value.Identifier + "' href= '#'>\
                                        <i class='fa fa-comment'></i>\
                                    </a>\
                                </td>\
                                <td style='text-align:center;'>\
                                    <a class='btn btn-info' data-target='#verImagenes' data-toggle='modal' onclick='verImagenesNC("+ value.Identifier + ")' data-id='" + value.Identifier + "' href= '#'>\
                                        <i class='fa fa-eye'></i>\
                                    </a>\
                                </td>\
                            </tr>");

                    });

                    $('#factura-origen').DataTable({
                        "lengthMenu": [[10, 20, 30, -1], [10, 20, 30, "All"]],
                        dom: 'Bfrtip',
                        stateSave: true,
                        buttons: [
                            'excel', 'pdf'
                        ],
                        order: [[1, 'desc']],
                        "paging": true,
                        "searching": true,
                        "language": {
                            "url": "//cdn.datatables.net/plug-ins/1.10.13/i18n/Spanish.json"
                        }
                    });

                }

                //if (data != null && $.isArray(data.Context)) {

                //    var VP = $('#factura-origen').DataTable();
                //    VP.destroy();
                //    $("#table-invoice-history").html('');

                //    $.each(data.Context, function (index, value) {


                //        if (value.TipoDocumento == 'S') {
                //            value.TipoDocumento = 'Servicio'
                //            if (value.Estatus == 1) {
                //                value.Estatus = 'Aprobación pendiente por la dirección'
                //            }
                //        }
                //        if (value.TipoDocumento == 'I') {
                //            value.TipoDocumento = 'Inventario';
                //            if (value.Estatus == 1) {
                //                value.Estatus = 'Aprobación pendiente por el almacén'
                //            }
                //        }
                //        if (value.Estatus == 0) {
                //            value.Estatus = 'Aprobación pendiente por la gerencia'
                //        }
                //        if (value.Estatus == 2) {
                //            value.Estatus = 'Aprobación pendiente por dirección'
                //        }
                //        if (value.Estatus == 3) {
                //            value.Estatus = 'Autorizada'
                //        }
                //        if (value.Estatus == 4) {
                //            value.Estatus = 'SAP'
                //        }
                //        if (value.Estatus == 5) {
                //            value.Estatus = 'Rechazado'
                //        }
                //        $("#table-invoice-history").append(
                //            "<tr>\
                //                <td>" + value.Identifier + "</td>\
                //                <td>" + value.ClienteName+ "</td>\
                //                <td>" + value.FolioOrigen + "</td>\
                //                <td>" + value.FolioDestino + "</td>\
                //                <td>" + value.TipoDocumento + "</td>\
                //                <td>" + value.Concepto + "</td>\
                //                <td>" + value.Comentario + "</td>\
                //                <td>" + value.Usuario + "</td>\
                //                <td>" + value.Estatus + "</td>\
                //                <td>" + moment(value.Fecha).format("YYYY-MM-DD HH:mm:ss") + "</td>\
                //                <td align='center'>\
                //                    <a class='btn btn-primary' data-target='#gestionDireccion' data-toggle='modal' onclick='getAprobacionDireccion("+ value.Sequence + ")' data-id='" + value.Sequence + "' href= '#'>\
                //                        <i class='fa fa-cogs'></i>\
                //                    </a>\
                //                </td>\
                //                <td align='center'>\
                //                    <a class='btn btn-info' data-target='#verComentarios' data-toggle='modal' onclick='verComentarios("+ value.Sequence + ")' data-id='" + value.Sequence + "' href= '#'>\
                //                        <i class='fa fa-comment'></i>\
                //                    </a>\
                //                </td>\
                //                <td align='center'>\
                //                    <a class='btn btn-info' data-target='#verImagenes' data-toggle='modal' onclick='verImagenesNC("+ value.Sequence + ")' data-id='" + value.Sequence + "' href= '#'>\
                //                        <i class='fa fa-eye'></i>\
                //                    </a>\
                //                </td>\
                //            </tr>");

                //    });

                //    $('#factura-origen').DataTable({
                //        "lengthMenu": [[10, 20, 30, -1], [10, 20, 30, "All"]],
                //        dom: 'Bfrtip',
                //        stateSave: true,
                //        buttons: [
                //            'excel', 'pdf'
                //        ],
                //        order: [[1, 'desc']],
                //        "paging": true,
                //        "searching": true,
                //        "language": {
                //            "url": "//cdn.datatables.net/plug-ins/1.10.13/i18n/Spanish.json"
                //        }
                //    });
                //}
            },
            error: function () {
                swal("Error en la api: UsuarioFolio");
            }
        });
    }


    function getHistoricoNotaCreditoAllStatus() {
        $("#comentario").show();
        $("#table-invoice-history").empty();
        $.ajax({
            contentType: "application/json; charset=utf-8",
            url: '@Url.Action("GetNotaCreditoHistoryAll", "Venta")',
            async: false,
            timeout: 3000,
            type: 'POST',
            data: '{}',
            dataType: "json",
            success: function (data) {
                if (data != null && $.isArray(data.Context)) {

                    var VP = $('#factura-origen').DataTable();
                    VP.destroy();
                    $("#table-invoice-history").html('');

                    $.each(data.Context, function (index, value) {

                        if (value.TipoDocumento == 'S') {
                            value.TipoDocumento = 'Servicio'
                            if (value.Estatus == 1) {
                                value.Estatus = 'Aprobación pendiente por la dirección'
                            }
                        }
                        if (value.TipoDocumento == 'I') {
                            value.TipoDocumento = 'Inventario';
                            if (value.Estatus == 1) {
                                value.Estatus = 'Aprobación pendiente por el almacén'
                            }
                        }
                        if (value.Estatus == 0) {
                            value.Estatus = 'Aprobación pendiente por la gerencia'
                        }
                        if (value.Estatus == 2) {
                            value.Estatus = 'Aprobación pendiente por dirección'
                        }
                        if (value.Estatus == 3) {
                            value.Estatus = 'Autorizada'
                        }
                        if (value.Estatus == 4) {
                            value.Estatus = 'SAP'
                        }
                        if (value.Estatus == 5) {
                            value.Estatus = 'Rechazado'
                        }
                        $("#table-invoice-history").append(
                            "<tr>\
                                <td>" + value.Sequence + "</td>\
                                <td>" + value.CardCode + " - " + value.CardName + "</td>\
                                <td>" + value.FolioOrigen + "</td>\
                                <td>" + value.FolioDestino + "</td>\
                                <td>" + value.TipoDocumento + "</td>\
                                <td>" + value.Concepto + "</td>\
                                <td>" + value.Comentario + "</td>\
                                <td>" + value.Usuario + "</td>\
                                <td>" + value.Estatus + "</td>\
                                <td>" + moment(value.Fecha).format("YYYY-MM-DD HH:mm:ss") + "</td>\
                                <td align='center'>\
                                    <a class='btn btn-primary' data-target='#gestionDireccion' data-toggle='modal' onclick='getAprobacionDireccion("+ value.Sequence + ")' data-id='" + value.Sequence + "' href= '#'>\
                                        <i class='fa fa-cogs'></i>\
                                    </a>\
                                </td>\
                                <td align='center'>\
                                    <a class='btn btn-info' data-target='#verComentarios' data-toggle='modal' onclick='verComentarios("+ value.Sequence + ")' data-id='" + value.Sequence + "' href= '#'>\
                                        <i class='fa fa-comment'></i>\
                                    </a>\
                                </td>\
                                <td align='center'>\
                                    <a class='btn btn-info' data-target='#verImagenes' data-toggle='modal' onclick='verImagenesNC("+ value.Sequence + ")' data-id='" + value.Sequence + "' href= '#'>\
                                        <i class='fa fa-eye'></i>\
                                    </a>\
                                </td>\
                            </tr>");

                    });

                    $('#factura-origen').DataTable({
                        "lengthMenu": [[10, 20, 30, -1], [10, 20, 30, "All"]],
                        dom: 'Bfrtip',
                        stateSave: true,
                        buttons: [
                            'excel', 'pdf'
                        ],
                        "paging": true,
                        "searching": true,
                        "language": {
                            "url": "//cdn.datatables.net/plug-ins/1.10.13/i18n/Spanish.json"
                        }
                    });

                }
            },
            error: function () {
                swal("Error en la api: UsuarioFolio");
            }
        });
    };

    //APROBACIONES aplica para gerencia
    function getAprobacionGerencia(FolioNotaCredito) {
        initModule();
        initModule1();
        initModule2();
        initModule3();

        $("#comentario-gerencia").val('');
        $("#sequence-gerencia").val(FolioNotaCredito);
        $("#NotaCreditoIdGerencia").val(FolioNotaCredito);

        $.ajax({
            contentType: "application/json; charset=utf-8",
            url: '@Url.Action("GetNotaCreditoItem", "NotaCredito")',
            async: false,
            timeout: 3000,
            type: 'POST',
            data: '{"NotaCredito":"' + FolioNotaCredito + '"}',
            dataType: "json",
            success: function (data) {
                if (data != null) {
                    let FechaFormato = moment(data.Context.Fecha).format("YYYY-MM-DD HH:mm:ss");

                    $("#usuario-email-gerencia").val(data.Context.Usuario);
                    $("#inventario-gerencia").val(data.Context.TipoDocumento);

                    let ConceptoDescuento = data.Context.ConceptoDescuento;
                    let TypeDoc = data.Context.TipoDocumento;

                    if (TypeDoc == 'S') {
                        TypeDoc = 'Servicio';
                    }
                    if (TypeDoc == 'I') {
                        TypeDoc = 'Inventario';
                    }

                    let canal = data.Context.Canal;

                    if (ConceptoDescuento == 39) {
                        $("#secuence-concepto-gerencia").val(ConceptoDescuento);
                        $(".line-time-change-text").text("Aprobación");
                        $(".line-time-change").text("credito");
                        $(".gestor-timeline-change").css("visibility", "visible");
                    }

                    if (ConceptoDescuento == 38) {
                        $("#secuence-concepto-gerencia").val(ConceptoDescuento);
                        $(".line-time-change-text").text("Aprobación");
                        $(".line-time-change").text("almacén");
                        $(".gestor-timeline-change").css("visibility", "visible");
                    }
                    if (ConceptoDescuento != 38 && ConceptoDescuento != '39') {
                        $("#secuence-concepto-gerencia").val(ConceptoDescuento);
                        $(".line-time-change-text").text("");
                        $(".line-time-change").text("");
                        $(".gestor-timeline-change").css("visibility", "hidden");
                    }

                    $("#table-invoice-detail-gestion-gerencia").empty();

                    let Total = 0;
                    $.each(data.Context.Items, function (index, value) {
                        let SubTotalDetail = 0;

                        switch (data.Context.TipoDocumento) {
                            case 'I':
                                SubTotalDetail = value.Cantidad * value.Precio;
                                value.Descuento = SubTotalDetail;
                                break;
                            case 'S':
                                SubTotalDetail = value.Cantidad * value.Descuento;
                                break;
                            default:
                        }
                        Total = Total + SubTotalDetail;

                        //<(SubDetail);
                        $("#table-invoice-detail-gestion-gerencia").append(
                            "<tr>\
                                <td>" + value.ItemCode + "</td>\
                                <td style='text-align:center;'>" + value.Cantidad + "</td >\
                                <td style='text-align:center;'>" + formatNumber.new(value.Precio.toFixed(2), "$ ") + "</td>\
                                <td style='display:none'><input type='text' class='' value='" + SubTotalDetail + "'/></td>\
                                <td style='text-align:center;'>" + formatNumber.new(value.Descuento.toFixed(2), "$ ") + "</td>\
                                <td style='text-align:center;'>" + formatNumber.new(SubTotalDetail.toFixed(2), "$ ") + "</td>\
                                <td style='display:none'><input type='text' style='text-align:center;' class='sub-total-detail-gestion-gerencia' value='" + SubTotalDetail + "'/></td>\
                            </tr>");
                    });
                    calculateValuesDetailGestion();

                    let Estatus = data.Context.Valor;
                    // alert(Estatus);

                    switch (Estatus) {
                        case 0:
                            //alert(Estatus);
                            $("#estatus-pendiente-gestion").removeClass("meta-date-pendiente-gestion");
                            $("#estatus-almacen-gestion").removeClass("meta-date-almacen-gestion");
                            $("#estatus-direccion-gestion").removeClass("meta-date-direccion-gestion");
                            $("#estatus-autorizado-gestion").removeClass("meta-date-autorizado-gestion");

                            $("#gestion-gerencia-rechazar").attr("disabled", false);
                            $("#gestion-gerencia-aprobar").attr("disabled", false);
                            break;
                        case 1:
                            $("#estatus-autorizado-gestion").removeClass("meta-date-autorizado-gestion");
                            $("#estatus-direccion-gestion").removeClass("meta-date-direccion-gestion");
                            $("#estatus-almacen-gestion").removeClass("meta-date-almacen-gestion");
                            $("#estatus-pendiente-gestion").addClass("meta-date-pendiente-gestion");

                            $("#gestion-gerencia-rechazar").attr("disabled", true);
                            $("#gestion-gerencia-aprobar").attr("disabled", true);
                            break;
                        case 2:
                            $("#estatus-autorizado-gestion").removeClass("meta-date-autorizado-gestion");
                            $("#estatus-direccion-gestion").removeClass("meta-date-direccion-gestion");
                            $("#estatus-pendiente-gestion").addClass("meta-date-pendiente-gestion");
                            $("#estatus-almacen-gestion").addClass("meta-date-almacen-gestion");

                            $("#gestion-gerencia-rechazar").attr("disabled", true);
                            $("#gestion-gerencia-aprobar").attr("disabled", true);
                            break;
                        case 3:
                            $("#estatus-pendiente-gestion").addClass("meta-date-pendiente-gestion");
                            $("#estatus-almacen-gestion").addClass("meta-date-almacen-gestion");
                            $("#estatus-direccion-gestion").addClass("meta-date-direccion-gestion");
                            $("#estatus-autorizado-gestion").addClass("meta-date-autorizado-gestion");

                            $("#gestion-gerencia-rechazar").attr("disabled", true);
                            $("#gestion-direccion-aprobar").attr("disabled", true);
                            break;
                        case 4:
                            $("#gestion-gerencia-rechazar").attr("disabled", true);
                            $("#gestion-gerencia-aprobar").attr("disabled", true);
                            break;
                        case 5:
                            $("#gestion-gerencia-rechazar").attr("disabled", true);
                            $("#gestion-gerencia-aprobar").attr("disabled", true);
                            break;
                    }

                    $("#set-Sequence-gestion").text("FOLIO SIE: " + data.Context.Identifier);
                    $("#set-Cliente-gestion").text("CLIENTE: " + data.Context.ClienteName);
                    $("#set-FolioOrigen-gestion").text("FOLIO ORIGEN: " + data.Context.FolioOrigen);
                    $("#set-FolioDestino-gestion").text("FOLIO DESTINO: " + data.Context.FolioDestino);
                    $("#set-Comentario-gestion").text("COMENTARIO: " + data.Context.Comentario);
                    $('#set-TipoDocumento-gestion').text('TIPO DOCUMENTO: ' + TypeDoc);
                    $("#set-Usuario-gestion").text("USUARIO: " + data.Context.Usuario);
                    $("#set-Fecha-gestion").text("FECHA: " + FechaFormato);
                    console.log(FechaFormato);
                }
            }
        });


    }




    //APROBACION ALMACEN
    function getAprobacionAlmacen(FolioNotaCredito) {
        initModule();
        initModule1();
        initModule2();
        initModule3();

        HideInputFileAlmacen();

        nc_row_inventarioarticuloalmacen_actualizar = [];
        //#gestion-almacen-aprobar").prop("disabled", true);

        $("#sequence-almacen").val(FolioNotaCredito);
        $("#NotaCreditoIdInventario").val(FolioNotaCredito);

        $.ajax({
            contentType: "application/json; charset=utf-8",
            url: '@Url.Action("GetNotaCreditoHeaderByFolio", "Venta")',
            async: false,
            timeout: 3000,
            type: 'POST',
            data: '{"Folio":"' + FolioNotaCredito + '"}',
            dataType: "json",
            success: function (data) {
                if (data != null && $.isArray(data.Context)) {

                    let Cliente = data.Context[0].CardCode + " - " + data.Context[0].CardName;
                    let FolioOrigen = data.Context[0].FolioOrigen;
                    let FolioDestino = data.Context[0].FolioDestino;
                    let TipoDocumento = data.Context[0].TipoDocumento;
                    let Comentario = data.Context[0].Comentario;
                    let Usuario = data.Context[0].Usuario;
                    let Estatus = data.Context[0].Estatus;
                    let Fecha = data.Context[0].Fecha;
                    let FechaFormato = moment(Fecha).format("YYYY-MM-DD HH:mm:ss");

                    // asiga usuario que genero la nota de credito
                    $("#usuario-almacen").val(Usuario);
                    $("#usuario-almacen-tipodocumento").val(TipoDocumento);
                    $("#usuario-almacen-estatus").val(Estatus);

                    if (data.Context[0].ConceptoDescuento == '39') {
                        $(".line-time-change-text").text("Aprobación");
                        $(".line-time-change").text("credito");
                        $(".gestor-timeline-change").css("visibility", "visible");
                    }
                    if (data.Context[0].ConceptoDescuento == '38') {
                        $(".line-time-change-text").text("Aprobación");
                        $(".line-time-change").text("almacén");
                        $(".gestor-timeline-change").css("visibility", "visible");
                    }
                    if (data.Context[0].ConceptoDescuento != '38' && data.Context[0].ConceptoDescuento != '39') {
                        $(".line-time-change-text").text("");
                        $(".line-time-change").text("");
                        $(".gestor-timeline-change").css("visibility", "hidden");
                    }

                    if (TipoDocumento == "S") {
                        TipoDocumento = "Servicio";

                        $(".almacentd").toggle();
                        $(".almacenth").toggle();

                        $("#set-TipoDocumento-gestion-almacen").text("TIPO DOCUMENTO: " + TipoDocumento);
                                $.ajax({
                                    contentType: "application/json; charset=utf-8",
                                    url: '@Url.Action("GetNotaCreditoDetailBySequence", "Venta")',
                                    async: false,
                                    timeout: 3000,
                                    type: 'POST',
                                    data: '{"FolioNotaCredito":"' + FolioNotaCredito + '"}',
                                    dataType: "json",
                                    success: function (data) {
                                        $("#table-invoice-detail-gestion-almacen").empty();
                                        if (data != null && $.isArray(data.Context)) {
                                            $.each(data.Context, function (index, value) {
                                                let CantidadDetail = value.Cantidad;
                                                let CantDetail = parseInt(CantidadDetail);
                                                let PrecioDetail = value.Precio;
                                                let PreDetail = parseFloat(PrecioDetail);
                                                let SubTotalDetail = CantDetail * PreDetail;
                                                let SubDetail = parseFloat(SubTotalDetail);
                                                let descuento = value.Descuento;
                                                let TotalDescuento = parseFloat(value.Cantidad) * parseFloat(value.Descuento);

                                                $("#table-invoice-detail-gestion-almacen").append(
                                                    "<tr>\
                                                        <td>" + value.ItemCode + "</td>\
                                                        <td>" + value.Cantidad + "</td >\
                                                        <td>" + formatNumber.new(value.Precio.toFixed(2), "$ ") + "</td>\
                                                        <td style='display:none'><input type='text' class='' value='" + SubDetail + "' style='width:80px'/></td>\
                                                        <td>" + formatNumber.new(descuento.toFixed(2), "$ ") + "</td>\
                                                        <td align='center'>" + formatNumber.new(TotalDescuento.toFixed(2), "$ ") + "</td>\
                                                    <td style='display:none'><input type='text' class='sub-total-detail-gestion-almacen' value='" + TotalDescuento + "'/></td>\
                                                    </tr>");
                                            });
                                            calculateValuesDetailGestionAlmacen();
                                        }
                                    },
                                    error: function () {
                                        swal("Error en la api: GetNotaCreditoDetailBySequence");
                                    }
                                });
                    }
                    if (TipoDocumento == "I") {
                        TipoDocumento = "Inventario";

                        let html = ''

                        if (Number(Estatus) != 1) {
                            html = 'disabled';
                        }

                        $("#set-TipoDocumento-gestion-almacen").text("TIPO DOCUMENTO: " + TipoDocumento);
                                $.ajax({
                                    contentType: "application/json; charset=utf-8",
                                    url: '@Url.Action("GetNotaCreditoDetailBySequence", "Venta")',
                                    async: false,
                                    timeout: 3000,
                                    type: 'POST',
                                    data: '{"FolioNotaCredito":"' + FolioNotaCredito + '"}',
                                    dataType: "json",
                                    success: function (data) {
                                        $("#table-invoice-detail-gestion-almacen").empty();
                                        if (data != null && $.isArray(data.Context)) {
                                            $.each(data.Context, function (index, value) {
                                                let CantidadDetail = value.Cantidad;
                                                let CantDetail = parseInt(CantidadDetail);
                                                let PrecioDetail = value.Precio;
                                                let PreDetail = parseFloat(PrecioDetail);
                                                let SubTotalDetail = CantDetail * PreDetail;
                                                let SubDetail = parseFloat(SubTotalDetail);
                                                let TotalDescuento = parseFloat(value.Cantidad) * parseFloat(value.Descuento);
                                                let descuento = value.Descuento;

                                                $("#table-invoice-detail-gestion-almacen").append(
                                                    "<tr>\
                                                        <td>" + value.ItemCode + "</td>\
                                                        <td>" + value.Cantidad + "</td >\
                                                        <td>" + formatNumber.new(value.Precio.toFixed(2), "$ ") + "</td>\
                                                        <td style='display:none'><input type='text' class='sub-total-detail-gestion-almacen' value='" + SubDetail + "' style='width:80px'/></td>\
                                                        <td>" + formatNumber.new(descuento.toFixed(2), "$ ") + "</td>\
                                                        <td align='center'>" + formatNumber.new(SubDetail.toFixed(2), "$ ") + "</td>\
                                                        <td align='center'>\
                                                            <div class='form-group'>\
                                                                <div class='input-group'>\
                                                                    <a class='btn btn-primary "+ html+"' data-target='#detalleAlmacenPartida' data-toggle='modal' onclick=getDegloseAlmacenPardida("+ FolioNotaCredito + ",'" + value.ItemCode + "'," + value.Cantidad + ",0) data-id='" + FolioNotaCredito + "' href= '#'>\
                                                                        <i class='fa fa-cogs'></i>\
                                                                    </a>\
                                                                    &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp\
                                                                    <a class='btn btn-primary' data-target='#detalleAlmacenPartida' data-toggle='modal' onclick=getDegloseAlmacenPardida("+ FolioNotaCredito + ",'" + value.ItemCode + "'," + value.Cantidad + ",1) data-id='" + FolioNotaCredito + "' href= '#'>\
                                                                        <i class='fa  fa-eye'></i>\
                                                                    </a>\
                                                                </div>\
                                                            </div>\
                                                        </td>\
                                                        <td style='display:none'><input type='text' class='' value='" + TotalDescuento + "'/></td>\
                                                    </tr>");
                                                agregarNotaCreditoInventarioAlmacen_actualizar(null, value.ItemCode, CantidadDetail);
                                            });
                                            calculateValuesDetailGestionAlmacen();
                                        }
                                    },
                                    error: function () {
                                        swal("Error en la api: GetNotaCreditoDetailBySequence");
                                    }
                                });
                    }

                    switch (Estatus) {
                        case 0:
                            $("#estatus-pendiente-gestion-almacen").removeClass("meta-date-pendiente-gestion");
                            $("#estatus-almacen-gestion-almacen").removeClass("meta-date-almacen-gestion");
                            $("#estatus-direccion-gestion-almacen").removeClass("meta-date-direccion-gestion");
                            $("#estatus-autorizado-gestion-almacen").removeClass("meta-date-autorizado-gestion");

                            $("#gestion-almacen-rechazar").attr("disabled", true);
                            $("#gestion-almacen-aprobar").attr("disabled", true);

                            break;
                        case 1:
                            $("#estatus-autorizado-gestion-almacen").removeClass("meta-date-autorizado-gestion");
                            $("#estatus-direccion-gestion-almacen").removeClass("meta-date-direccion-gestion");
                            $("#estatus-almacen-gestion-almacen").removeClass("meta-date-almacen-gestion");
                            $("#estatus-pendiente-gestion-almacen").addClass("meta-date-pendiente-gestion");

                            $("#gestion-direccion-rechazar").attr("disabled", true);
                            $("#gestion-direccion-aprobar").attr("disabled", true);

                            break;
                        case 2:
                            $("#estatus-autorizado-gestion-almacen").removeClass("meta-date-autorizado-gestion");
                            $("#estatus-direccion-gestion-almacen").removeClass("meta-date-direccion-gestion");
                            $("#estatus-pendiente-gestion-almacen").addClass("meta-date-pendiente-gestion");
                            $("#estatus-almacen-gestion-almacen").addClass("meta-date-almacen-gestion");

                            $("#gestion-almacen-rechazar").attr("disabled", false);
                            $("#gestion-almacen-aprobar").attr("disabled", false);
                            break;
                        case 3:
                            $("#estatus-pendiente-gestion-almacen").addClass("meta-date-pendiente-gestion");
                            $("#estatus-almacen-gestion-almacen").addClass("meta-date-almacen-gestion");
                            $("#estatus-direccion-gestion-almacen").addClass("meta-date-direccion-gestion");
                            $("#estatus-autorizado-gestion-almacen").addClass("meta-date-autorizado-gestion");

                            $("#gestion-almacen-rechazar").attr("disabled", false);
                            $("#gestion-almacen-aprobar").attr("disabled", false);
                            break;
                        case 4:
                            $("#gestion-almacen-rechazar").attr("disabled", false);
                            $("#gestion-almacen-aprobar").attr("disabled", false);
                            break;
                        case 5:
                            $("#gestion-almacen-rechazar").attr("disabled", false);
                            $("#gestion-almacen-aprobar").attr("disabled", false);
                            break;
                        //getAprobacionAlmacen
                    }

                    $("#set-Sequence-gestion-almacen").text("FOLIO SIE: " + FolioNotaCredito);
                    $("#set-Cliente-gestion-almacen").text("CLIENTE: " + Cliente);
                    $("#set-FolioOrigen-gestion-almacen").text("FOLIO ORIGEN: " + FolioOrigen);
                    $("#set-FolioDestino-gestion-almacen").text("FOLIO DESTINO: " + FolioDestino);
                    $("#set-Comentario-gestion-almacen").text("COMENTARIO: " + Comentario);
                    $("#set-Usuario-gestion-almacen").text("USUARIO: " + Usuario);
                    $("#set-Fecha-gestion-almacen").text("FECHA: " + FechaFormato);
                    console.log(FechaFormato);

                }
            },
            error: function () {
                swal("Error en la api: GetNotaCreditoDetailBySequence");
            }
        });

    }

    //APROBACION DIRECCION

    function getAprobacionDireccion(FolioNotaCredito) {

        initModule();
        initModule1();
        initModule2();
        initModule3();

        resetFormsDireccion();

        $("#comentario-direccion").val('');
        $("#sequence-direccion").val(FolioNotaCredito);
        $("#NotaCreditoIdDireccion").val(FolioNotaCredito);

        //alert($("#NotaCreditoIdDireccion").val());

        $.ajax({
            contentType: "application/json; charset=utf-8",
            url: '@Url.Action("GetNotaCreditoItem", "NotaCredito")',
            async: false,
            timeout: 3000,
            type: 'POST',
            data: '{"NotaCredito":"' + FolioNotaCredito + '"}',
            dataType: "json",
            success: function (data) {
                if (data != null) {

                    let FechaFormato = moment(data.Context.Fecha).format("YYYY-MM-DD HH:mm:ss");

                    $("#usuario-direccion").val(data.Context.Usuario);
                    $("#usuario-cliente").val(data.Context.ClienteName);
                    $("#usuario-monto").val(data.Context.Importe);

                    let ConceptoDescuento = data.Context.ConceptoDescuento;

                    //alert(ConceptoDescuento);

                    let TypeDoc = data.Context.TipoDocumento;

                    if (TypeDoc == 'S') {
                        TypeDoc = 'Servicio';
                    }
                    if (TypeDoc == 'I') {
                        TypeDoc = 'Inventario';
                    }

                    let canal = data.Context.Canal;

                    if (ConceptoDescuento == 39) {
                        $("#secuence-concepto-gerencia").val(ConceptoDescuento);
                        $(".line-time-change-text").text("Aprobación");
                        $(".line-time-change").text("credito");
                        $(".gestor-timeline-change").css("visibility", "visible");
                    }
                    if (ConceptoDescuento == 38) {
                        $("#secuence-concepto-gerencia").val(ConceptoDescuento);
                        $(".line-time-change-text").text("Aprobación");
                        $(".line-time-change").text("almacén");
                        $(".gestor-timeline-change").css("visibility", "visible");
                    }
                    if (ConceptoDescuento != 38 && ConceptoDescuento != 39) {
                        $("#secuence-concepto-gerencia").val(ConceptoDescuento);
                        $(".line-time-change-text").text("");
                        $(".line-time-change").text("");
                        $(".gestor-timeline-change").css("visibility", "hidden");
                    }

                    if (canal == 'RETAIL' && data.Context.TipoDocumento !='I' ) {
                        $("#secuence-concepto-gerencia").val(ConceptoDescuento);
                        $(".line-time-change-text").text("Aprobación");
                        $(".line-time-change").text("credito");
                        $(".gestor-timeline-change").css("visibility", "visible");
                    }

                    $("#table-invoice-detail-gestion-direccion").empty();

                    let Total = 0;
                    $.each(data.Context.Items, function (index, value) {
                        let SubTotalDetail = 0;
                        switch (data.Context.TipoDocumento) {
                            case 'I':
                                SubTotalDetail = value.Cantidad * value.Precio;
                                value.Descuento = SubTotalDetail;
                                break;
                            case 'S':
                                SubTotalDetail = value.Cantidad * value.Descuento;
                                break;
                            default:
                        }
                        Total = Total + SubTotalDetail;

                        $("#table-invoice-detail-gestion-direccion").append(
                            "<tr>\
                                <td>" + value.ItemCode + "</td>\
                                <td style='text-align:center;'>" + value.Cantidad + "</td >\
                                <td style='text-align:center;'>" + formatNumber.new(value.Precio.toFixed(2), "$ ") + "</td>\
                                <td style='display:none'><input type='text' value='" + SubTotalDetail + "'/></td>\
                                <td style='text-align:center;'>" + formatNumber.new(value.Descuento.toFixed(2), "$ ") + "</td>\
                                <td style='text-align:center;'>" + formatNumber.new(SubTotalDetail.toFixed(2), "$ ") + "</td>\
                                <td style='display:none'><input type='text' class='sub-total-detail-gestion-direccion' value='" + SubTotalDetail + "'/></td>\
                            </tr>");

                    });
                    calculateValuesDetailGestionDireccion();


                    let Estatus = data.Context.Valor;
                    //alert(Estatus);
                    switch (Estatus) {
                        case 0:
                            $("#estatus-gerencia-direccion").addClass("meta-date");
                            $("#estatus-almacen-direccion").addClass("meta-date");
                            $("#estatus-direccion-direccion").addClass("meta-date");
                            $("#estatus-autorizado-direccion").addClass("meta-date");

                            // validar de acuerdo al estus para deshbilitar los botones
                            $("#gestion-direccion-rechazar").attr("disabled", false);
                            $("#gestion-direccion-aprobar").attr("disabled", false);
                            break;
                        case 1:
                            //alert("1_ s");
                            $("#estatus-gerencia-direccion").addClass("meta-date-direccion");
                            $("#estatus-almacen-direccion").removeClass("meta-date-direccion").addClass("meta-date");
                            $("#estatus-direccion-direccion").removeClass("meta-date-direccion").addClass("meta-date");
                            $("#estatus-autorizado-direccion").removeClass("meta-date-direccion").addClass("meta-date");

                            $("#gestion-direccion-rechazar").attr("disabled", false);
                            $("#gestion-direccion-aprobar").attr("disabled", false);
                            break;
                        case 2:
                            //alert("2_ s");

                            $("#estatus-gerencia-direccion").addClass("meta-date-direccion");
                            $("#estatus-almacen-direccion").addClass("meta-date-direccion");
                            $("#estatus-direccion-direccion").removeClass("meta-date-direccion").addClass("meta-date");
                            $("#estatus-autorizado-direccion").removeClass("meta-date-direccion").addClass("meta-date");

                            $("#gestion-direccion-rechazar").attr("disabled", false);
                            $("#gestion-direccion-aprobar").attr("disabled", false);
                            break;
                        case 3:
                            $("#estatus-gerencia-direccion").addClass("meta-date-direccion");
                            $("#estatus-almacen-direccion").addClass("meta-date-direccion");
                            $("#estatus-direccion-direccion").addClass("meta-date-direccion");
                            $("#estatus-autorizado-direccion").removeClass("meta-date-direccion").addClass("meta-date");
                            // solo aplica para direccion
                            $("#gestion-direccion-rechazar").attr("disabled", true);
                            $("#gestion-direccion-aprobar").attr("disabled", true);
                            break;
                        case 4:
                            //alert("4_ s");
                            $("#estatus-gerencia-direccion").addClass("meta-date-direccion");
                            $("#estatus-almacen-direccion").addClass("meta-date-direccion");
                            $("#estatus-direccion-direccion").addClass("meta-date-direccion");
                            $("#estatus-autorizado-direccion").addClass("meta-date-direccion");

                            // solo aplica para direccion
                            //alert(Estatus);
                            $("#gestion-direccion-rechazar").attr("disabled", true);
                            $("#gestion-direccion-aprobar").attr("disabled", true);
                            break;
                    }

                    $("#set-Sequence-gestion-direccion").text("FOLIO SIE: " + data.Context.Identifier);
                    $("#set-Cliente-gestion-direccion").text("CLIENTE: " + data.Context.ClienteName);
                    $("#set-FolioOrigen-gestion-direccion").text("FOLIO ORIGEN: " + data.Context.FolioOrigen);
                    $("#set-FolioDestino-gestion-direccion").text("FOLIO DESTINO: " + data.Context.FolioDestino);
                    $("#set-Comentario-gestion-direccion").text("COMENTARIO: " + data.Context.Comentario);
                    $("#set-Usuario-gestion-direccion").text("USUARIO: " + data.Context.Usuario);
                    $("#set-Fecha-gestion-direccion").text("FECHA: " + FechaFormato);
                    $("#set-TipoDocumento-gestion-direccion").text("TIPO DOCUMENTO: " + TypeDoc);
                }
            },
            error: function (data) {
                swal("Error en la api: GetNotaCreditoItem: " + data);
            }
        });
    }
    function resetFormsDireccion() {
        $("#estatus-gerencia-direccion").removeClass("meta-date-direccion").addClass("meta-date");
        $("#estatus-almacen-direccion").removeClass("meta-date-direccion").addClass("meta-date");
        $("#estatus-direccion-direccion").removeClass("meta-date-direccion").addClass("meta-date");
        $("#estatus-autorizado-direccion").removeClass("meta-date-direccion").addClass("meta-date");
    }

    function calculateValuesDetail() {
        var sum = 0;
        $(".sub-total-detail").each(function () {
            let sumado = this.value;
            if (!isNaN(sumado) && sumado.length != 0) {
                sum += parseFloat(sumado);
            }
        });
        let iva = 0.16;
        let iva_detail = sum * iva;
        let subtotal_detail = sum - iva_detail;
        let total_detail = sum;
        $('#subtotal-detail').text("Subtotal: " + formatNumber.new(subtotal_detail.toFixed(2), "$ "));
        $('#iva-detail').text("Iva: " + formatNumber.new(iva_detail.toFixed(2), "$ "));
        $('#total-detail').text("Total: " + formatNumber.new(total_detail.toFixed(2), "$ "));

    };

    function calculateValuesDetailGestion() {
        var sum = 0;
        $(".sub-total-detail-gestion-gerencia").each(function () {
            let sumado = this.value;
            if (!isNaN(sumado) && sumado.length != 0) {
                sum += parseFloat(sumado);
            }
        });
        //let iva = 0.16;
        let total_detail = sum;
        //subtotal-detail-gestion-gerencia
        $('#subtotal-detail-gestion-gerencia').text(formatNumber.new(total_detail.toFixed(2), "$ "));
    };

    function calculateValuesDetailGestionAlmacen() {
        var sum = 0;
        $(".sub-total-detail-gestion-almacen").each(function () {
            let sumado = this.value;
            if (!isNaN(sumado) && sumado.length != 0) {
                sum += parseFloat(sumado);
            }
        });

        let total_detail = sum;
        $('#subtotal-detail-gestion-almacen').text("Total sin IVA: " + formatNumber.new(total_detail.toFixed(2), "$ "));

    };

    function calculateValuesDetailGestionDireccion() {
        var sum = 0;
        $(".sub-total-detail-gestion-direccion").each(function () {
            let sumado = this.value;
            if (!isNaN(sumado) && sumado.length != 0) {
                sum += parseFloat(sumado);
            }
        });
        let total_detail = sum;
        $('#subtotal-detail-gestion-direccion').text(formatNumber.new(total_detail.toFixed(2), "$ "));
    };
    // sumatoria de total de gestion credito

    function calculateValuesDetailGestionCredito() {
        var sum = 0;
        $(".sub-total-detail-gestion-credito").each(function () {
            let sumado = this.value;
            if (!isNaN(sumado) && sumado.length != 0) {
                sum += parseFloat(sumado);
            }
        });
        let total_detail = sum;
        $('#subtotal-detail-gestion-credito').text(formatNumber.new(total_detail.toFixed(2), "$ "));
    };

    var formatNumber = {
        separador: ",",
        sepDecimal: '.',
        formatear: function (num) {
            num += '';
            var splitStr = num.split('.');
            var splitLeft = splitStr[0];
            var splitRight = splitStr.length > 1 ? this.sepDecimal + splitStr[1] : '';
            var regx = /(\d+)(\d{3})/;
            while (regx.test(splitLeft)) {
                splitLeft = splitLeft.replace(regx, '$1' + this.separador + '$2');
            }
            return this.simbol + splitLeft + splitRight;
        },
        new: function (num, simbol) {
            this.simbol = simbol || '';
            return this.formatear(num);
        }
    }

    function aprobarNotaCreditoGerencia() {
        debugger;
        swal({
            title: "¿Autorizar por parte de la gerencia?",
            text: "Esta nota de credito será aprobada por parte de la gerencia",
            icon: "warning",
            buttons: true,
            dangerMode: true,
        })
        .then((willDelete) => {
            if (willDelete) {

                let SequenceForeignKey = $("#sequence-gerencia").val();
                // usuario que genero la nota de credito
                let UsuarioEmail = $("#usuario-email-gerencia").val();

                let TipoDocumentoEmail = $("#inventario-gerencia").val();
                let SequenceConceptoDescuento = $("#secuence-concepto-gerencia").val();

                let Valor = 1;
                // usuario logeado en el sistema
                let Usuario = localStorage.getItem("UserEmail");
                let Accion = "Se cambio a estatus gerencia.";

                //switch (TipoDocumentoEmail) {
                //    case 'S':
                //        Valor = 2;
                //        console.log('Servicio');
                //        break;
                //    case 'I':
                //        Valor = 1;
                //        console.log('Servicio');
                //        break;
                //    default:
                //        console.log('Indefinido');
                //}

                $.ajax({
                    contentType: "application/json; charset=utf-8",
                    url: '@Url.Action("UpdateGestionNotaCreditoGerencia", "Venta")',
                    async: false,
                    timeout: 3000,
                    type: 'POST',
                    data: '{"SequenceForeignKey":"' + SequenceForeignKey + '","Valor":"' + Valor + '","Usuario":"' + Usuario + '","Accion":"' + Accion + '"}',
                    dataType: "json",
                    success: function (data) {
                    },
                    error: function () {
                        swal("Error en la api: UpdateGestionNotaCreditoGerencia");
                    }
                });

                let ComentarioGerencia = $("#comentario-gerencia").val();

                $.ajax({
                    contentType: "application/json; charset=utf-8",
                    url: '@Url.Action("InsertComentarioNotaCredito", "Venta")',
                    async: false,
                    timeout: 3000,
                    type: 'POST',
                    data: '{"Usuario":"' + Usuario + '","Comentario":"' + ComentarioGerencia + '","SequenceForeignKey":"' + SequenceForeignKey + '","Departamento":"' + 1 + '"}',
                    dataType: "json",
                    success: function (data) {
                    },
                    error: function () {
                        swal("Error en la api: InsertComentarioNotaCredito");
                    }
                });

                let Asunto = '';
                let Encabezado = '';
                if (TipoDocumentoEmail == 'I') {
                    Asunto = 'GESTIÓN NOTA DE CREDITO INVENTARIO (APROBADA POR LA GERENCIA)';
                }
                if (TipoDocumentoEmail == 'S' && SequenceConceptoDescuento == '37') {
                    Asunto = 'GESTIÓN NOTA DE CRÉDITO DIFERENCIA EN PRECIO (APROBADA POR LA GERENCIA)';
                }
                if (TipoDocumentoEmail == 'S' && SequenceConceptoDescuento == '39') {
                    Asunto = 'GESTIÓN NOTA DE CREDITO PRONTO PAGO (APROBADA POR LA GERENCIA)';
                }
                if (TipoDocumentoEmail == 'S' && SequenceConceptoDescuento != '37' && SequenceConceptoDescuento != '39') {
                    Asunto = 'GESTIÓN NOTA DE CREDITO OTRO DESCUENTO (APROBADA POR LA GERENCIA)';
                }

                //let ToEmail = '@System.Configuration.ConfigurationManager.AppSettings["EmailSistemas"]';
                //let ToEmail2 = '@System.Configuration.ConfigurationManager.AppSettings["EmailSistemas"]';
                let ToEmail = UsuarioEmail; //usuario que genero la nota de credito
                let ToEmail2 = Usuario; // usuario que aprobo la nota de credito
                let ToEmail3 = '@System.Configuration.ConfigurationManager.AppSettings["EmailSistemas"]';
                let ToEmail4 = '@System.Configuration.ConfigurationManager.AppSettings["EmailSistemas"]';

                let FromEmail = '@System.Configuration.ConfigurationManager.AppSettings["EmailSistemasFussion"]';

                var html_code = "<div>";
                html_code += "<h3 style='font-family: arial, sans-serif;'>" + Asunto + "</h3>";
                html_code += "</br>";
                html_code += "<h3 style='font-family: arial, sans-serif;'>Aprobado por: " + Usuario + "</h3>";
                html_code += "</br>";
                html_code += "<h3 style='font-family: arial, sans-serif;'>Folio SIE nota de credito: " + SequenceForeignKey + "</h3>";
                html_code += "</br>";
                html_code += "<h5 style='font-family: arial, sans-serif;'>Comentario: " + ComentarioGerencia + "</h5>";
                html_code += "</div>";

                $.ajax({
                    contentType: "application/json; charset=utf-8",
                    url: '@Url.Action("EmailSendNotaCredito", "Venta")',
                    async: false,
                    timeout: 3000,
                    type: 'POST',
                    data: '{"ToEmail":"' + ToEmail + '","ToEmail2":"' + ToEmail2 + '","ToEmail3":"' + ToEmail3 + '","ToEmail4":"' + ToEmail4 + '","FromEmail":"' + FromEmail + '","SubjectEmail":"' + Asunto + '","BodyEmail":"' + html_code + '"}',
                    dataType: "json",
                }).done(function (data) {

                }).always(function (data) {
                        console.log("always executed in api EmailSendNotaCredito " + JSON.stringify(data));
                }).fail(function (data) {
                    swal("Error en la api: EmailSendNotaCredito");
                });

                $("#comentario-gerencia").val('')

            } else {
                swal("Operación cancelada");
            }
            if (willDelete) {
                 if ($("#NotaCreditoIdGerencia").val() != "") {
                    var formData = new FormData($("#frm-addImagenes-gerencia")[0]);

                    $("#btn-addevidencia").attr("disabled", true);

				    $.ajax({
					    url: '@Url.Action("AddNotaCreditoEvidenciaGerencia", "NotaCredito")',
					    type: "POST",
					    data: formData,
					    contentType: false,
					    processData: false,
                        success: function (data) {
						    if (data != null) {
                                if (data.Context != null) {
                                    if (data.Context) {
                                        initModule2();
                                        $('#verImagenes').modal('hide');
                                    }
                                    $('#verImagenes').modal('hide');
                                    console.log('Success: ' + data.Context);
                                    document.location.reload(true);
							    }
							    else
							    {
								    swal({
                                        title: 'Error!',
                                        text: 'Ocurrio un error al intentar guardar la evidencia, Error: ' + data.Message,
									    icon: 'Error'
                                    });
                                    document.location.reload(true);
							    }
						    }
					    }
				    })
			    }
                else {
                    alert("No se ha seleccionado la nota de crédito a evidenciar.");
                }
            }
        });
    }

    // APRUEBA ALMACEN ENVIA CORREO A DIRECTOR GENERAL
    function aprobarNotaCreditoAlmacen() {

        let TDocument = $("#usuario-almacen-tipodocumento").val();

        let msg = '';
        if (TDocument == 'I') {
            console.log('entrando al metodo' + JSON.stringify(nc_row_inventarioarticuloalmacen_actualizar.length));
            $.each(nc_row_inventarioarticuloalmacen_actualizar, function (index, value) {
                console.log('value ' + JSON.stringify(value.ItemNcAlmacen));
                console.log(jQuery.isEmptyObject(value.ItemNcAlmacen));
                if (jQuery.isEmptyObject(value.ItemNcAlmacen) == true) {
                    msg = msg + 'No se ha definido las el desglose de cantidades par articulo ' + value.Articulo +' ';
                    alert(msg);
                }
            });
        }

        if (msg != '') {
            //alert(msg);
            swal('Advertencia', msg, 'warning');
            return;
        }

        swal({
                title: "¿Autorizar por parte del almacén?",
                text: "Esta nota de credito será aprobada por parte del almacén",
                icon: "warning",
                buttons: true,
                dangerMode: true,
        })
        .then((willDelete) => {
            if (willDelete) {
                let SequenceForeignKey = $("#sequence-almacen").val();

                let UsuarioEmail = $("#usuario-almacen").val();
                let Valor = 2;
                let Usuario = localStorage.getItem("UserEmail");
                let Accion = "Se cambio a estatus almacen.";
                    $.ajax({
                        contentType: "application/json; charset=utf-8",
                        url: '@Url.Action("UpdateGestionNotaCreditoAlmacen", "Venta")',
                        async: false,
                        timeout: 3000,
                        type: 'POST',
                        data: '{"SequenceForeignKey":"' + SequenceForeignKey + '","Valor":"' + Valor + '","Usuario":"' + Usuario + '","Accion":"' + Accion + '"}',
                        dataType: "json",
                        success: function (data) {
                            console.log('data ' + data.Context);
                            if (data.Context != '') {
                                actualizarNotaCreditoAlmacenAgregado();
                            }
                            swal(data.Context);
                            getHistoricoNotaCreditoOne();
                            $('#gestionAlmacen').modal('toggle');
                        },
                        error: function () {
                            swal("Error en la api: UpdateGestionNotaCreditoAlmacen");
                        }
                    });
                    let ComentarioAlmacen = $("#comentario-almacen").val();
                    $.ajax({
                        contentType: "application/json; charset=utf-8",
                        url: '@Url.Action("InsertComentarioNotaCredito", "Venta")',
                        async: false,
                        timeout: 3000,
                        type: 'POST',
                        data: '{"Usuario":"' + Usuario + '","Comentario":"' + ComentarioAlmacen + '","SequenceForeignKey":"' + SequenceForeignKey + '","Departamento":"' + 2 + '"}',
                        dataType: "json",
                        success: function (data) {
                        },
                        error: function () {
                            swal("Error en la api: InsertComentarioNotaCredito");
                        }
                });

                    //let ToEmail = localStorage.getItem('UserEmail');
                    //let ToEmail = '@System.Configuration.ConfigurationManager.AppSettings["EmailSistemas"]';
                    //let ToEmail2 = '@System.Configuration.ConfigurationManager.AppSettings["EmailSistemas"]';
                    let ToEmail1 = UsuarioEmail;
                    let ToEmail2 = Usuario;
                    let ToEmail3 = '@System.Configuration.ConfigurationManager.AppSettings["EmailSistemas"]';
                    let ToEmail4 = '@System.Configuration.ConfigurationManager.AppSettings["EmailSistemas"]';

                    let FromEmail = '@System.Configuration.ConfigurationManager.AppSettings["EmailSistemasFussion"]';

                    let SubjectEmail = 'GESTIÓN NOTA DE CRÉDITO INVENTARIO (APROBADA POR ALMACÉN)';
                    var html_code = "<div>";
                        html_code += "<h3 style='font-family: arial, sans-serif;'>GESTIÓN NOTA DE CREDITO INVENTARIO (APROBADA POR ALMACÉN)</h3>";
                        html_code += "</br>";
                        html_code += "<h3 style='font-family: arial, sans-serif;'>Aprobado por: " + Usuario+" </h3>";
                        html_code += "</br>";
                        html_code += "<h3 style='font-family: arial, sans-serif;'>Folio SIE nota de crédito: " + SequenceForeignKey + "</h3>";
                        html_code += "</br>";
                        html_code += "<h5 style='font-family: arial, sans-serif;'>Comentario: " + ComentarioAlmacen + "</h5>";
                        html_code += "</div>";
                    $.ajax({
                        contentType: "application/json; charset=utf-8",
                        url: '@Url.Action("EmailSendNotaCredito", "Venta")',
                        async: false,
                        timeout: 3000,
                        type: 'POST',
                        data: '{"ToEmail":"' + ToEmail + '","ToEmail2":"' + ToEmail2 + '","ToEmail3":"' + ToEmail3 + '","ToEmail4":"' + ToEmail4 + '","FromEmail":"' + FromEmail + '","SubjectEmail":"' + SubjectEmail + '","BodyEmail":"' + html_code + '"}',
                        dataType: "json",
                    }).done(function (data) {

                    }).always(function (data) {
                        console.log("always executed in api AffectCreditNoteSap");
                    }).fail(function (data) {
                        swal("Error en la api: EmailSendNotaCredito");
                    });
                $("#comentario-almacen").val('');
                // almacen

                if ($("#NotaCreditoIdInventario").val() != "") {

                    var formData = new FormData($("#frm-addImagenes-almacen")[0]);
				    $.ajax({
					    url: '@Url.Action("AddNotaCreditoEvidenciaInventario", "NotaCredito")',
					    type: "POST",
					    data: formData,
					    contentType: false,
					    processData: false,
                        success: function (data) {
						    if (data != null) {
                                if (data.Context != null) {
                                    if (data.Context) {
                                        initModule();
                                        initModule1();
                                        initModule2();
                                        initModule3();
                                        $("#NotaCreditoIdInventario").val("");
                                    }
                                    else {
                                        console.log("Ocurrio un error al guardar la evidencia." + data.Context);
                                        initModule2();
                                    }

							    }
							    else
							    {
								    swal({
                                        title: 'Error!',
                                        text: 'Ocurrio un error al intentar guardar la evidencia. Error:' + data.Message,
									    icon: 'Error'
								    });
							    }
						    }
					    }
				    });
			    }
                else{
				        alert("No se ha seleccionado la nota de crédito a evidenciar.");
                }

                getHistoricoNotaCreditoOne();
            } else {
                swal("Operacion cancelada");
            }
        });
    }

    function aprobarNotaCreditoDireccion() {
        swal({
            title: "¿Autorizar por parte de la dirección?",
            text: "Esta nota de crédito será aprobada por parte de la dirección",
            icon: "warning",
            buttons: true,
            dangerMode: true,
        })
        .then((willDelete) => {
            if (willDelete) {
                let SequenceForeignKey = $("#sequence-direccion").val();
                // genero nc user
                let UsuarioEmail = $("#usuario-direccion").val();
                let cliente = $("#usuario-cliente").val();
                let monto = $("#usuario-monto").val();

                let Valor = 3;
                // user mail aprobo nc
                let Usuario = localStorage.getItem("UserEmail");
                let Accion = "Se cambio a estatus dirección.";
                $.ajax({
                    contentType: "application/json; charset=utf-8",
                    url: '@Url.Action("UpdateGestionNotaCreditoDireccion", "Venta")',
                    async: false,
                    timeout: 3000,
                    type: 'POST',
                    data: '{"SequenceForeignKey":"' + SequenceForeignKey + '","Valor":"' + Valor + '","Usuario":"' + Usuario + '","Accion":"' + Accion + '"}',
                    dataType: "json",
                    success: function (data) {
                        swal(data.Context);
                        getHistoricoNotaCreditoAllStatus();
                    },
                    error: function () {
                        swal("Error en la api: UpdateGestionNotaCreditoDireccion");
                    }
                });
                let ComentarioDireccion = $("#comentario-direccion").val();
                $.ajax({
                    contentType: "application/json; charset=utf-8",
                    url: '@Url.Action("InsertComentarioNotaCredito", "Venta")',
                    async: false,
                    timeout: 3000,
                    type: 'POST',
                    data: '{"Usuario":"' + Usuario + '","Comentario":"' + ComentarioDireccion + '","SequenceForeignKey":"' + SequenceForeignKey + '","Departamento":"' + 3 + '"}',
                    dataType: "json",
                    success: function (data) {
                    },
                    error: function () {
                        swal("Error en la api: InsertComentarioNotaCredito");
                    }
                });
                let ToEmail = UsuarioEmail;
                let ToEmail2 = Usuario;

                //let ToEmail = '@System.Configuration.ConfigurationManager.AppSettings["EmailSistemas"]';
                //let ToEmail2 = '@System.Configuration.ConfigurationManager.AppSettings["EmailSistemas"]';

                let ToEmail3 = '@System.Configuration.ConfigurationManager.AppSettings["EmailAlmacen"]';

                let FromEmail = '@System.Configuration.ConfigurationManager.AppSettings["EmailSistemasFussion"]';

                let SubjectEmail = 'GESTIÓN NOTA DE CRÉDITO (APROBADA POR LA DIRECCIÓN)';
                var html_code = "<div>";
                        html_code += "<h3 style='font-family: arial, sans-serif;'>GESTIÓN NOTA DE CRÉDITO (APROBADA POR LA DIRECCIÓN)</h3>";
                        html_code += "</br>";
                        html_code += "<h3 style='font-family: arial, sans-serif;'>Aprobado por: " + Usuario + "</h3>";
                        html_code += "</br>";
                        html_code += "<h3 style='font-family: arial, sans-serif;'>Folio SIE nota de crédito: " + SequenceForeignKey + "</h3>";
                        html_code += "</br>";
                        html_code += "<h3 style='font-family: arial, sans-serif;'>Cliente: " + cliente + "</h3>";
                        html_code += "</br>";
                        html_code += "<h3 style='font-family: arial, sans-serif;'>Monto: " + monto + "</h3>";
                        html_code += "</br>";
                        html_code += "<h5 style='font-family: arial, sans-serif;'>Comentario: " + ComentarioDireccion + "</h5>";
                    html_code += "</div>";

                $.ajax({
                    contentType: "application/json; charset=utf-8",
                    url: '@Url.Action("EmailSendNotaCredito", "Venta")',
                    async: false,
                    timeout: 3000,
                    type: 'POST',
                    data: '{"ToEmail":"' + ToEmail + '","ToEmail2":"' + ToEmail2 + '","ToEmail3":"' + ToEmail3 + '","ToEmail4":"' + ToEmail3 + '","FromEmail":"' + FromEmail + '","SubjectEmail":"' + SubjectEmail + '","BodyEmail":"' + html_code + '"}',
                    dataType: "json",
                }).done(function (data) {

                }).always(function (data) {
                    console.log("always executed in api AffectCreditNoteSap");
                }).fail(function (data) {
                    swal("Error en la api: EmailSendNotaCredito");
                    });

                $("#comentario-direccion").val('');


                if ($("#NotaCreditoIdDireccion").val() != "") {

                    var formData = new FormData($("#frm-addImagenes-direccion")[0]);
				    $.ajax({
					    url: '@Url.Action("AddNotaCreditoEvidenciaDireccion", "NotaCredito")',
					    type: "POST",
					    data: formData,
					    contentType: false,
					    processData: false,
                        success: function (data) {
						    if (data != null) {
                                if (data.Context != null) {
                                    if (data.Context) {
                                        initModule();
                                        initModule1();
                                        initModule2();
                                        initModule3();
                                        $("#NotaCreditoIdDireccion").val("");
                                    }
                                    else {
                                        console.log("No se envió evidencia correctamente.");
                                        initModule2();
                                        $("#NotaCreditoIdDireccion").val("");
                                    }
							    }
							    else
							    {
								    swal({
                                        title: 'Error!',
                                        text: 'Ocurrio un error al intentar guardar la evidencia. Error:' + data.Message,
									    icon: 'Error'
								    });
							    }
						    }
					    }
				    });
			    }
                else {
                    alert("No se ha seleccionado la nota de crédito a evidenciar.");
			    }
                // load nota credito direccion
                getHistoricoNotaCreditoAllStatusDireccion();
            } else {
                swal("Operacion cancelada");
            }
        });
    }

    //RECHAZAR NOTA DE CREDITO GERENCIA
    function rechazaNotaCreditoGerencia() {
        swal({
            title: "¿Esta seguro de rechazar la nota de crédito?",
            text: "Esta operación rechazara la nota de crédito",
            icon: "warning",
            buttons: true,
            dangerMode: true,
        })
        .then((willDelete) => {
            if (willDelete) {
                let SequenceForeignKey = $("#sequence-gerencia").val();
                let Valor = 5;

                let UsuarioEmail = $("#usuario-email-gerencia").val();

                let Usuario = localStorage.getItem("UserEmail");
                let Accion = "Rechazo el departamento gerencia";

                $.ajax({
                    contentType: "application/json; charset=utf-8",
                    url: '@Url.Action("UpdateRejectGestionNotaCredito", "Venta")',
                    async: false,
                    timeout: 3000,
                    type: 'POST',
                    data: '{"SequenceForeignKey":"' + SequenceForeignKey + '","Valor":"' + Valor + '","Usuario":"' + Usuario + '","Accion":"' + Accion + '"}',
                    dataType: "json",
                }).done(function (data) {
                    getHistoricoNotaCreditoZero();
                }).always(function (data) {
                    console.log("always executed in api UpdateRejectGestionNotaCredito");
                }).fail(function (data) {
                    swal("Error en la api: UpdateRejectGestionNotaCredito");
                });

                let ComentarioGerencia = $("#comentario-gerencia").val();
                $.ajax({
                    contentType: "application/json; charset=utf-8",
                    url: '@Url.Action("InsertComentarioNotaCredito", "Venta")',
                    async: false,
                    timeout: 3000,
                    type: 'POST',
                    data: '{"Usuario":"' + Usuario + '","Comentario":"' + ComentarioGerencia + '","SequenceForeignKey":"' + SequenceForeignKey + '","Departamento":"' + 1 + '"}',
                    dataType: "json",
                    success: function (data) {
                    },
                    error: function () {
                        swal("Error en la api: InsertComentarioNotaCredito");
                    }
                });
                debugger;
                //let ToEmail = '@System.Configuration.ConfigurationManager.AppSettings["EmailSistemas"]';
                //let ToEmail2 = '@System.Configuration.ConfigurationManager.AppSettings["EmailSistemas"]';
                let ToEmail = UsuarioEmail;
                let ToEmail2 = Usuario;
                let ToEmail3 = '@System.Configuration.ConfigurationManager.AppSettings["EmailSistemas"]';

                let FromEmail = '@System.Configuration.ConfigurationManager.AppSettings["EmailSistemasFussion"]';

                let SubjectEmail = 'GESTIÓN NOTA DE CRÉDITO (RECHAZADA POR GERENCIA)';
                var html_code = "<div>";
                        html_code += "<h3 style='font-family: arial, sans-serif;'>Comunicado.</h3>";
                        html_code += "</br>";
                        html_code += "<h3 style='font-family: arial, sans-serif;'>GESTIÓN NOTA DE CRÉDITO (RECHAZADA POR LA GERENCIA).</h3>";
                        html_code += "</br>";
                        html_code += "<h3 style='font-family: arial, sans-serif;'>Rechazado por: " + Usuario + "</h3>";
                        html_code += "</br>";
                        html_code += "<h3 style='font-family: arial, sans-serif;'>Folio SIE nota de crédito: " + SequenceForeignKey + "</h3>";
                        html_code += "</br>";
                        html_code += "<h5 style='font-family: arial, sans-serif;'>Comentario: " + ComentarioGerencia + "</h5>";
                    html_code += "</div>";

                $.ajax({
                    contentType: "application/json; charset=utf-8",
                    url: '@Url.Action("EmailSendNotaCredito", "Venta")',
                    async: false,
                    timeout: 3000,
                    type: 'POST',
                    data: '{"ToEmail":"' + ToEmail + '","ToEmail2":"' + ToEmail2 + '","ToEmail3":"' + ToEmail3 + '","ToEmail4":"' + ToEmail3 + '","FromEmail":"' + FromEmail + '","SubjectEmail":"' + SubjectEmail + '","BodyEmail":"' + html_code + '"}',
                    dataType: "json",
                }).done(function (data) {

                }).always(function (data) {
                    console.log("always executed in api AffectCreditNoteSap");
                }).fail(function (data) {
                    swal("Error en la api: EmailSendNotaCredito");
                });
                $("#comentario-gerencia").val('');

                // recarga las notas de credito rechazadas
                //getHistoricoNotaCreditoZero();
                getHistoricoNotaCreditoZero();
            } else {
                swal("Operación cancelada");
            }

        });
    };

    function rechazaNotaCreditoAlmacen() {
        swal({
            title: "¿Esta seguro de rechazar la nota de crédito?",
            text: "Esta operación rechazara la nota de crédito",
            icon: "warning",
            buttons: true,
            dangerMode: true,
        })
        .then((willDelete) => {
            if (willDelete) {
                let SequenceForeignKey = $("#sequence-almacen").val();
                let UsuarioEmail = $("#usuario-almacen").val();
                //alert(SequenceForeignKey);
                let Valor = 5;
                let Usuario = localStorage.getItem("UserEmail");
                let Accion = "Rechazo del departamento de almacén";
                $.ajax({
                    contentType: "application/json; charset=utf-8",
                    url: '@Url.Action("UpdateRejectGestionNotaCredito", "Venta")',
                    async: false,
                    timeout: 3000,
                    type: 'POST',
                    data: '{"SequenceForeignKey":"' + SequenceForeignKey + '","Valor":"' + Valor + '","Usuario":"' + Usuario + '","Accion":"' + Accion + '"}',
                    dataType: "json",
                }).done(function (data) {
                    getHistoricoNotaCreditoOne();
                }).always(function (data) {
                    console.log("always executed in api UpdateRejectGestionNotaCredito");
                }).fail(function (data) {
                    swal("Error en la api: UpdateRejectGestionNotaCredito");
                    });
                let ComentarioAlmacen = $("#comentario-almacen").val();
                $.ajax({
                    contentType: "application/json; charset=utf-8",
                    url: '@Url.Action("InsertComentarioNotaCredito", "Venta")',
                    async: false,
                    timeout: 3000,
                    type: 'POST',
                    data: '{"Usuario":"' + Usuario + '","Comentario":"' + ComentarioAlmacen + '","SequenceForeignKey":"' + SequenceForeignKey + '","Departamento":"' + 2 + '"}',
                    dataType: "json",
                    success: function (data) {
                    },
                    error: function () {
                        swal("Error en la api: InsertComentarioNotaCredito");
                    }
                });
                let ToEmail = UsuarioEmail;
                let ToEmail2 = Usuario;
                //let ToEmail = '@System.Configuration.ConfigurationManager.AppSettings["EmailSistemas"]';
                //let ToEmail2 = '@System.Configuration.ConfigurationManager.AppSettings["EmailSistemas"]';
                let ToEmail3 = '@System.Configuration.ConfigurationManager.AppSettings["EmailSistemas"]';

                let FromEmail = '@System.Configuration.ConfigurationManager.AppSettings["EmailSistemasFussion"]';


                let SubjectEmail = 'GESTIÓN NOTA DE CRÉDITO (RECHAZADA POR EL ALMACÉN)';

                var html_code = "<div>";
                        html_code += "<h3 style='font-family: arial, sans-serif;'>Comunicado.</h3>";
                        html_code += "</br>";
                        html_code += "<h3 style='font-family: arial, sans-serif;'>GESTIÓN NOTA DE CRÉDITO (RECHAZADA POR EL ALMACÉN)</h3>";
                        html_code += "</br>";
                        html_code += "<h3 style='font-family: arial, sans-serif;'>Rechazado por: " + Usuario + "</h3>";
                        html_code += "</br>";
                        html_code += "<h3 style='font-family: arial, sans-serif;'>Folio SIE nota de crédito: " + SequenceForeignKey + "</h3>";
                        html_code += "</br>";
                        html_code += "<h5 style='font-family: arial, sans-serif;'>Comentario: " + ComentarioAlmacen + "</h5>";
                    html_code += "</div>";
                $.ajax({
                    contentType: "application/json; charset=utf-8",
                    url: '@Url.Action("EmailSendNotaCredito", "Venta")',
                    async: false,
                    timeout: 3000,
                    type: 'POST',
                    data: '{"ToEmail":"' + ToEmail + '","ToEmail2":"' + ToEmail2 + '","ToEmail3":"' + ToEmail3 + '","ToEmail4":"' + ToEmail3 + '","FromEmail":"' + FromEmail + '","SubjectEmail":"' + SubjectEmail + '","BodyEmail":"' + html_code + '"}',
                    dataType: "json",
                }).done(function (data) {

                }).always(function (data) {
                    console.log("always executed in api AffectCreditNoteSap");
                }).fail(function (data) {
                    swal("Error en la api: EmailSendNotaCredito");
                    });
                $("#comentario-almacen").val();

                // recarga datos del almacen
                getHistoricoNotaCreditoOne();
            } else {
                swal("Operación cancelada");
            }
        });
    };
    // rechaza nota de credito direccion
    function rechazaNotaCreditoDireccion() {
        swal({
            title: "¿Esta seguro de rechazar la nota de credito?",
            text: "Esta operación rechazara la nota de credito",
            icon: "warning",
            buttons: true,
            dangerMode: true,
        })
        .then((willDelete) => {
            if (willDelete) {
                let SequenceForeignKey = $("#sequence-direccion").val();
                let UsuarioEmail = $("#usuario-direccion").val();
                let cliente = $("#usuario-cliente").val();
                let monto = $("#usuario-monto").val();

                let Valor = 5;
                let Usuario = localStorage.getItem("UserEmail");
                let Accion = "Rechazo del departamento de dirección";
                $.ajax({
                    contentType: "application/json; charset=utf-8",
                    url: '@Url.Action("UpdateRejectGestionNotaCredito", "Venta")',
                    async: false,
                    timeout: 3000,
                    type: 'POST',
                    data: '{"SequenceForeignKey":"' + SequenceForeignKey + '","Valor":"' + Valor + '","Usuario":"' + Usuario + '","Accion":"' + Accion + '"}',
                    dataType: "json",
                }).done(function (data) {
                    getHistoricoNotaCreditoTwo();
                }).always(function (data) {
                    console.log("always executed in api UpdateRejectGestionNotaCredito");
                }).fail(function (data) {
                    swal("Error en la api: UpdateRejectGestionNotaCredito");
                });
                let ComentarioDireccion = $("#comentario-direccion").val();
                $.ajax({
                    contentType: "application/json; charset=utf-8",
                    url: '@Url.Action("InsertComentarioNotaCredito", "Venta")',
                    async: false,
                    timeout: 3000,
                    type: 'POST',
                    data: '{"Usuario":"' + Usuario + '","Comentario":"' + ComentarioDireccion + '","SequenceForeignKey":"' + SequenceForeignKey + '","Departamento":"' + 3 + '"}',
                    dataType: "json",
                    success: function (data) {

                    },
                    error: function () {
                        swal("Error en la api: InsertComentarioNotaCredito");
                    }
                });
                let ToEmail = UsuarioEmail;
                let ToEmail2 = Usuario;
                //let ToEmail = '@System.Configuration.ConfigurationManager.AppSettings["EmailSistemas"]';
                //let ToEmail2 = '@System.Configuration.ConfigurationManager.AppSettings["EmailSistemas"]';
                let ToEmail3 = '@System.Configuration.ConfigurationManager.AppSettings["EmailAlmacen"]';

                let FromEmail = '@System.Configuration.ConfigurationManager.AppSettings["EmailSistemasFussion"]';

                let SubjectEmail = 'GESTIÓN NOTA DE CRÉDITO (RECHAZADA POR LA DIRECCIÓN)';
                var html_code = "<div>";
                        html_code += "<h3 style='font-family: arial, sans-serif;'>Comunicado.</h3>";
                        html_code += "</br>";
                        html_code += "<h3 style='font-family: arial, sans-serif;'>GESTIÓN NOTA DE CRÉDITO (RECHAZADA POR LA DIRECCIÓN)</h3>";
                        html_code += "</br>";
                        html_code += "<h3 style='font-family: arial, sans-serif;'>Rechazado por: " + Usuario + "</h3>";
                        html_code += "</br>";
                        html_code += "<h3 style='font-family: arial, sans-serif;'>Folio SIE nota de crédito: " + SequenceForeignKey + "</h3>";
                        html_code += "</br>";
                        html_code += "<h3 style='font-family: arial, sans-serif;'>Cliente: " + cliente + "</h3>";
                        html_code += "</br>";
                        html_code += "<h3 style='font-family: arial, sans-serif;'>Monto: " + monto + "</h3>";
                        html_code += "</br>";
                        html_code += "<h5 style='font-family: arial, sans-serif;'>Comentario: " + ComentarioDireccion + "</h5>";
                    html_code += "</div>";
                $.ajax({
                    contentType: "application/json; charset=utf-8",
                    url: '@Url.Action("EmailSendNotaCredito", "Venta")',
                    async: false,
                    timeout: 3000,
                    type: 'POST',
                    data: '{"ToEmail":"' + ToEmail + '","ToEmail2":"' + ToEmail2 + '","ToEmail3":"' + ToEmail3 + '","ToEmail4":"' + ToEmail3 + '","FromEmail":"' + FromEmail + '","SubjectEmail":"' + SubjectEmail + '","BodyEmail":"' + html_code + '"}',
                    dataType: "json",
                }).done(function (data) {

                }).always(function (data) {
                    console.log("always executed in api AffectCreditNoteSap");
                }).fail(function (data) {
                    swal("Error en la api: EmailSendNotaCredito");
                    });
                $("#comentario-direccion").val('');

                // historioc de notas de credito aprobado por direccion
                getHistoricoNotaCreditoAllStatusDireccion();
            } else {
                swal("Operación cancelada");
            }
        });
    };

    function verComentarios(SequenceForeignKey) {
        $.ajax({
            contentType: "application/json; charset=utf-8",
            url: '@Url.Action("GetComentarioNotaCredito", "Venta")',
            async: false,
            timeout: 3000,
            type: 'POST',
            data: '{"SequenceForeignKey":"' + SequenceForeignKey + '"}',
            dataType: "json",
        }).done(function (data) {
            if (data != null && $.isArray(data.Context)) {
                $("#tbody-comentarios").empty();
                $.each(data.Context, function (index, value) {
                    if (value.Comentario == "") {
                        value.Comentario = 'Sin comentario';
                    }
                    if (value.Departamento == 1) {
                        value.Departamento = 'Gerencia';
                    }
                    if (value.Departamento == 2) {
                        value.Departamento = 'Almacén';
                    }
                    if (value.Departamento == 3) {
                        value.Departamento = 'Dirección';
                    }
                    if (value.Departamento == 5) {
                        value.Departamento = 'Crédito y Cobranza';
                    }
                    if (value.Departamento == 6) {
                        value.Departamento = 'Sistemas';
                    }
                    $("#tbody-comentarios").append(
                        "<tr>\
                            <td>" + value.Departamento + "</td>\
                            <td>" + value.Usuario + "</td >\
                            <td>" + value.Comentario + "</td >\
                        </tr>");
                });
            }
        }).always(function (data) {
        }).fail(function (data) {
        });
    }

    // aprobaciones de nota de credito para credito usuario luis
    function getHistoricoNotaCreditoAllStatusCredito() {

        $("#comentario").show();

        $("#table-invoice-history").empty();

        $.ajax({
            contentType: "application/json; charset=utf-8",
            url: '@Url.Action("GetNotaCreditoEstatusCredito", "Venta")',
            async: false,
            timeout: 3000,
            type: 'POST',
            data: '{}',
            dataType: "json",
            success: function (data) {
                if (data != null && $.isArray(data.Context)) {

                    var VP = $('#factura-origen').DataTable();

                    VP.destroy();

                    $("#table-invoice-history").html('');

                    $.each(data.Context, function (index, value) {

                        if (value.TipoDocumento == 'S') {
                            value.TipoDocumento = 'Servicio'
                            if (value.Estatus == 1) {
                                value.Estatus = 'Aprobación pendiente por la dirección';
                            }
                        }
                        if (value.TipoDocumento == 'I') {
                            value.TipoDocumento = 'Inventario';
                            if (value.Estatus == 1) {
                                value.Estatus = 'Aprobación pendiente por el almacén';
                            }
                        }
                        if (value.Estatus == 0 && value.ConceptoDescuento != 39) {
                            value.Estatus = 'Aprobación pendiente por la gerencia'
                        }
                        if (value.Estatus == 0 && value.ConceptoDescuento == 39) {
                            console.log("Es para credito y corabnza");
                            value.Estatus = 'Aprobación pendiente por crédito y cobranza'
                        }

                        if (value.Estatus == 2) {
                            value.Estatus = 'Aprobación pendiente por dirección'
                        }
                        if (value.Estatus == 3) {
                            value.Estatus = 'Autorizada'
                        }
                        if (value.Estatus == 4) {
                            value.Estatus = 'SAP'
                        }
                        if (value.Estatus == 5) {
                            value.Estatus = 'Rechazado'
                        }
                        $("#table-invoice-history").append(
                            "<tr>\
                                <td>" + value.Sequence + "</td>\
                                <td>" + value.CardCode + " - " + value.CardName + "</td>\
                                <td>" + value.FolioOrigen + "</td>\
                                <td>" + value.FolioDestino + "</td>\
                                <td>" + value.TipoDocumento + "</td>\
                                <td>" + value.Concepto + "</td>\
                                <td>" + value.Comentario + "</td>\
                                <td>" + value.Usuario + "</td>\
                                <td>" + value.Estatus + "</td>\
                                <td>" + moment(value.Fecha).format("YYYY-MM-DD HH:mm:ss") + "</td>\
                                <td style='text-align:center;'>\
                                    <a class='btn btn-primary' data-target='#gestionCreditoCobranza' data-toggle='modal' onclick='getAprobacionCredito("+ value.Sequence + ")' data-id='" + value.Sequence + "' href= '#'>\
                                        <i class='fa fa-cogs'></i>\
                                    </a>\
                                </td>\
                                <td style='text-align:center;'>\
                                    <a class='btn btn-info' data-target='#verComentarios' data-toggle='modal' onclick='verComentarios("+ value.Sequence + ")' data-id='" + value.Sequence + "' href= '#'>\
                                        <i class='fa fa-comment'></i>\
                                    </a>\
                                </td>\
                                <td style='text-align:center;'>\
                                    <a class='btn btn-info' data-target='#verImagenes' data-toggle='modal' onclick='verImagenesNC("+ value.Sequence + ")' data-id='" + value.Sequence + "' href= '#'>\
                                        <i class='fa fa-eye'></i>\
                                    </a>\
                                </td>\
                            </tr>");

                    });

                    $('#factura-origen').DataTable({
                        "lengthMenu": [[10, 20, 30, -1], [10, 20, 30, "All"]],
                        dom: 'Bfrtip',
                        stateSave: true,
                        buttons: [
                            'excel', 'pdf'
                        ],
                        order: [[1, 'desc']],
                        "paging": true,
                        "searching": true,
                        "language": {
                            "url": "//cdn.datatables.net/plug-ins/1.10.13/i18n/Spanish.json"
                        }
                    });

                }
            },
            error: function () {
                swal("Error en la api: GetNotaCreditoEstatusCredito");
            }
        });
    }

    // VISTA PARA APROBACIÓN CREDITO Y COBRNAZA
    function getAprobacionCredito(FolioNotaCredito) {
        initModule();
        initModule1();
        initModule2();
        initModule3();


        $("#sequence-credito").val(FolioNotaCredito);
        $("#NotaCreditoIdCobranza").val(FolioNotaCredito);


        $.ajax({
            contentType: "application/json; charset=utf-8",
            url: '@Url.Action("GetNotaCreditoItem", "NotaCredito")',
            async: false,
            timeout: 3000,
            type: 'POST',
            data: '{"NotaCredito":"' + FolioNotaCredito + '"}',
            dataType: "json",
            success: function (data) {
                if (data != null) {
                    let FechaFormato = moment(data.Context.Fecha).format("YYYY-MM-DD HH:mm:ss");
                    $("#usuario-credito").val(data.Context.Usuario);
                    let ConceptoDescuento = data.Context.ConceptoDescuento;

                    if (ConceptoDescuento == 39) {
                        $(".line-time-change-text").text("Aprobación");
                        $(".line-time-change").text("credito");
                        $(".gestor-timeline-change").css("visibility", "visible");
                    }
                    if (ConceptoDescuento == 38) {
                        $(".line-time-change-text").text("Aprobación");
                        $(".line-time-change").text("almacén");
                        $(".gestor-timeline-change").css("visibility", "visible");
                    }
                    if (ConceptoDescuento != 38 && ConceptoDescuento != 39) {
                        $(".line-time-change-text").text("");
                        $(".line-time-change").text("");
                        $(".gestor-timeline-change").css("visibility", "hidden");
                    }

                    let TypeDoc = data.Context.TipoDocumento;

                    if (TypeDoc == 'S') {
                        TypeDoc = 'Servicio';
                    }
                    if (TypeDoc == 'I') {
                        TypeDoc = 'Inventario';
                    }

                    let Total = 0;
                    $.each(data.Context.Items, function (index, value) {
                        let SubTotalDetail = 0;
                        switch (data.Context.TipoDocumento) {
                            case 'I':
                                SubTotalDetail = value.Cantidad * value.Precio;
                                value.Descuento = SubTotalDetail;
                                break;
                            case 'S':
                                SubTotalDetail = value.Cantidad * value.Descuento;
                                break;
                            default:
                        }
                        Total = Total + SubTotalDetail;

                        $("#table-invoice-detail-gestion-credito").append(
                            "<tr>\
                                <td>" + value.ItemCode + "</td>\
                                <td style='text-align: center;' >" + value.Cantidad + "</td >\
                                <td style='text-align: center;'>" + formatNumber.new(value.Precio.toFixed(2), "$ ") + "</td>\
                                <td style='display:none'><input type='text' class='' value='" + SubTotalDetail + "' style='width:80px'/></td>\
                                <td style='text-align: center;'>" + formatNumber.new(value.Descuento.toFixed(2), "$ ") + "</td>\
                                <td style='text-align: center;'>" + formatNumber.new(SubTotalDetail.toFixed(2), "$ ") + "</td>\
                                <td style='display:none'><input type='text' class='sub-total-detail-gestion-credito' value='" + SubTotalDetail + "'/></td>\
                            </tr>");
                    });
                    calculateValuesDetailGestionCredito();

                    let Estatus = data.Context.Valor;
                    //alert(Estatus);
                    switch (Estatus) {
                        case 0:
                            $("#estatus-pendiente-gestion-credito").removeClass("meta-date-pendiente-gestion");
                            $("#estatus-almacen-gestion-credito").removeClass("meta-date-almacen-gestion");
                            $("#estatus-direccion-gestion-credito").removeClass("meta-date-direccion-gestion");
                            $("#estatus-autorizado-gestion-credito").removeClass("meta-date-autorizado-gestion");

                            $("#gestion-credito-rechazar").attr("disabled", false);
                            $("#gestion-credito-aprobar").attr("disabled", false);
                            break;
                        case 1:
                            $("#estatus-autorizado-gestion-credito").removeClass("meta-date-autorizado-gestion");
                            $("#estatus-direccion-gestion-credito").removeClass("meta-date-direccion-gestion");
                            $("#estatus-almacen-gestion-credito").removeClass("meta-date-almacen-gestion");
                            $("#estatus-pendiente-gestion-credito").addClass("meta-date-pendiente-gestion");

                            $("#gestion-credito-rechazar").attr("disabled", true);
                            $("#gestion-credito-aprobar").attr("disabled", true);
                            break;
                        case 3:
                            $("#estatus-pendiente-gestion-credito").addClass("meta-date-pendiente-gestion");
                            $("#estatus-almacen-gestion-credito").addClass("meta-date-almacen-gestion");
                            $("#estatus-direccion-gestion-credito").addClass("meta-date-direccion-gestion");
                            $("#estatus-autorizado-gestion-credito").removeClass("meta-date-pendiente-gestion");

                            $("#gestion-credito-rechazar").attr("disabled", true);
                            $("#gestion-credito-aprobar").attr("disabled", true);
                            break;
                        case 4:
                            $("#estatus-pendiente-gestion-credito").addClass("meta-date-pendiente-gestion");
                            $("#estatus-almacen-gestion-credito").addClass("meta-date-almacen-gestion");
                            $("#estatus-direccion-gestion-credito").addClass("meta-date-direccion-gestion");
                            $("#estatus-autorizado-gestion-credito").addClass("meta-date-autorizado-gestion");

                            $("#gestion-credito-rechazar").attr("disabled", true);
                            $("#gestion-credito-aprobar").attr("disabled", true);
                            break;
                        case 5:
                            $("#gestion-credito-rechazar").attr("disabled", true);
                            $("#gestion-credito-aprobar").attr("disabled", true);
                            break;
                        //getAprobacionAlmacen
                    }

                    $("#set-Sequence-gestion-credito").text("FOLIO SIE: " + data.Context.Identifier);
                    $("#set-Cliente-gestion-credito").text("CLIENTE: " + data.Context.ClienteName);
                    $("#set-FolioOrigen-gestion-credito").text("FOLIO ORIGEN: " + data.Context.FolioOrigen);
                    $("#set-FolioDestino-gestion-credito").text("FOLIO DESTINO: " + data.Context.FolioDestino);
                    $("#set-TipoDocumento-gestion-credito").text("TIPO DOCUMENTO: " + TypeDoc);
                    $("#set-Comentario-gestion-credito").text("COMENTARIO: " + data.Context.Comentario);
                    $("#set-Usuario-gestion-credito").text("USUARIO: " + data.Context.Usuario);
                    $("#set-Fecha-gestion-credito").text("FECHA: " + FechaFormato);
                    console.log(FechaFormato);

                }
            }, error: function (data) {
                swal("Error en la api: GetNotaCreditoItem: " + data);
            }
        });


    }
    // aprueba nota de credito Servicio(Credito)

    function aprobarNotaCreditoCobranza() {
        swal({
            title: "¿Autorizar por parte de Crédito y Cobranza?",
            text: "Esta nota de crédito será aprobada",
            icon: "warning",
            buttons: true,
            dangerMode: true,
        })
        .then((willDelete) => {
            if (willDelete) {
                let SequenceForeignKey = $("#sequence-credito").val();
                let UsuarioEmail = $("#usuario-credito").val();

                let Valor = 2;
                let Usuario = localStorage.getItem("UserEmail");
                let Accion = "Se cambio a estatus crédito y cobranza.";
                $.ajax({
                    contentType: "application/json; charset=utf-8",
                    url: '@Url.Action("UpdateGestionNotaCreditoDireccion", "Venta")',
                    async: false,
                    timeout: 3000,
                    type: 'POST',
                    data: '{"SequenceForeignKey":"' + SequenceForeignKey + '","Valor":"' + Valor + '","Usuario":"' + Usuario + '","Accion":"' + Accion + '"}',
                    dataType: "json",
                    success: function (data) {
                    },
                    error: function () {
                        swal("Error en la api: UpdateGestionNotaCreditoDireccion");
                    }
                });
                let ComentarioCredito = $("#comentario-credito").val();

                $.ajax({
                    contentType: "application/json; charset=utf-8",
                    url: '@Url.Action("InsertComentarioNotaCredito", "Venta")',
                    async: false,
                    timeout: 3000,
                    type: 'POST',
                    data: '{"Usuario":"' + Usuario + '","Comentario":"' + ComentarioCredito + '","SequenceForeignKey":"' + SequenceForeignKey + '","Departamento":"' + 5 + '"}',
                    dataType: "json",
                    success: function (data) {
                    },
                    error: function () {
                        swal("Error en la api: InsertComentarioNotaCredito");
                    }
                });
                // PRODUCTIVO
                let ToEmail = UsuarioEmail;
                let ToEmail2 = Usuario;
                // pruebas
                //let ToEmail = '@System.Configuration.ConfigurationManager.AppSettings["EmailSistemas"]';
                //let ToEmail2 = '@System.Configuration.ConfigurationManager.AppSettings["EmailSistemas"]';

                let ToEmail3 = '@System.Configuration.ConfigurationManager.AppSettings["EmailSistemas"]';

                let FromEmail = '@System.Configuration.ConfigurationManager.AppSettings["EmailSistemasFussion"]';

                let SubjectEmail = 'GESTIÓN NOTA DE CRÉDITO (APROBADA POR CRÉDITO Y COBRANZA)';
                var html_code = "<div>";
                        html_code += "<h3 style='font-family: arial, sans-serif;'>GESTIÓN NOTA DE CRÉDITO (APROBADA POR CRÉDITO Y COBRANZA)</h3>";
                        html_code += "</br>";
                        html_code += "<h3 style='font-family: arial, sans-serif;'>Aprobado por: " + Usuario + "</h3>";
                        html_code += "</br>";
                        html_code += "<h3 style='font-family: arial, sans-serif;'>Folio SIE nota de crédito: " + SequenceForeignKey + "</h3>";
                        html_code += "</br>";
                        html_code += "<h5 style='font-family: arial, sans-serif;'>Comentario: " + ComentarioCredito + "</h5>";
                    html_code += "</div>";

                $.ajax({
                    contentType: "application/json; charset=utf-8",
                    url: '@Url.Action("EmailSendNotaCredito", "Venta")',
                    async: false,
                    timeout: 3000,
                    type: 'POST',
                    data: '{"ToEmail":"' + ToEmail + '","ToEmail2":"' + ToEmail2 + '","ToEmail3":"' + ToEmail3 + '","ToEmail4":"' + ToEmail3 + '","FromEmail":"' + FromEmail + '","SubjectEmail":"' + SubjectEmail + '","BodyEmail":"' + html_code + '"}',
                    dataType: "json",
                }).done(function (data) {

                }).always(function (data) {
                    console.log("always executed in api AffectCreditNoteSap");
                }).fail(function (data) {
                    swal("Error en la api: EmailSendNotaCredito");
                    });
                $("#comentario-credito").val('');

                if ($("#NotaCreditoIdCobranza").val() != "") {

                    var formData = new FormData($("#frm-addImagenes-cobranza")[0]);
				    $.ajax({
					    url: '@Url.Action("AddNotaCreditoEvidenciaCreditoCobranza", "NotaCredito")',
					    type: "POST",
					    data: formData,
					    contentType: false,
					    processData: false,
                        success: function (data) {
						    if (data != null) {
                                if (data.Context != null) {
                                    if (data.Context) {
                                        initModule();
                                        initModule1();
                                        initModule2();
                                        initModule4();
                                    }
                                    else {
                                        console.log("Ha fallado al guardar la evidencia. Error: " + data.Message);
                                        initModule();
                                        initModule1();
                                        initModule2();
                                        initModule4();
                                        $("#NotaCreditoIdCobranza").val("");
                                    }
							    }
							    else
							    {
								    swal({
									    title: 'Error!',
									    text: 'Ocurrio un error al intentar guardar la evidencia. Error:',
									    icon: 'Error'
								    });
							    }
						    }
					    }
				    });
			    }
                else{
				        alert("No se ha seleccionado la nota de crédito a evidenciar.");
			    }
                // load nota credito direccion
                getHistoricoNotaCreditoAllStatusCredito();

            } else {
                swal("Operacion cancelada");
            }
        });
    }

    // rechaza nota de
    function rechazaNotaCreditoCobranza() {
        swal({
            title: "¿Esta seguro de rechazar la nota de credito?",
            text: "Esta operación rechazara la nota de credito",
            icon: "warning",
            buttons: true,
            dangerMode: true,
        })
        .then((willDelete) => {
            if (willDelete) {
                let SequenceForeignKey = $("#sequence-credito").val();
                let UsuarioEmail = $("#usuario-credito").val();

                let Valor = 5;
                let Usuario = localStorage.getItem("UserEmail");
                let Accion = "Rechazó del departamento de Crédito y Cobranza";
                $.ajax({
                    contentType: "application/json; charset=utf-8",
                    url: '@Url.Action("UpdateRejectGestionNotaCredito", "Venta")',
                    async: false,
                    timeout: 3000,
                    type: 'POST',
                    data: '{"SequenceForeignKey":"' + SequenceForeignKey + '","Valor":"' + Valor + '","Usuario":"' + Usuario + '","Accion":"' + Accion + '"}',
                    dataType: "json",
                }).done(function (data) {
                    //getHistoricoNotaCreditoAllStatusCredito();
                }).always(function (data) {
                    console.log("always executed in api UpdateRejectGestionNotaCredito");
                }).fail(function (data) {
                    swal("Error en la api: UpdateRejectGestionNotaCredito");
                });

                // departamento 5 es de Credito y cobranza
                let ComentarioCredito = $("#comentario-credito").val();
                $.ajax({
                    contentType: "application/json; charset=utf-8",
                    url: '@Url.Action("InsertComentarioNotaCredito", "Venta")',
                    async: false,
                    timeout: 3000,
                    type: 'POST',
                    data: '{"Usuario":"' + Usuario + '","Comentario":"' + ComentarioCredito + '","SequenceForeignKey":"' + SequenceForeignKey + '","Departamento":"' + 5 + '"}',
                    dataType: "json",
                    success: function (data) {

                    },
                    error: function () {
                        swal("Error en la api: InsertComentarioNotaCredito");
                    }
                });
                //let ToEmail = '@System.Configuration.ConfigurationManager.AppSettings["EmailSistemas"]';;
                //let ToEmail2 = '@System.Configuration.ConfigurationManager.AppSettings["EmailSistemas"]';
                // PRODUCTIVO
                let ToEmail = UsuarioEmail;
                let ToEmail2 = Usuario;
                let ToEmail3 = '@System.Configuration.ConfigurationManager.AppSettings["EmailSistemas"]';

                let FromEmail = '@System.Configuration.ConfigurationManager.AppSettings["EmailSistemasFussion"]';

                let SubjectEmail = 'GESTIÓN NOTA DE CRÉDITO (RECHAZADA POR CRÉDITO Y COBRANZA)';
                var html_code = "<div>";
                        html_code += "<h3 style='font-family: arial, sans-serif;'>Comunicado.</h3>";
                        html_code += "</br>";
                        html_code += "<h3 style='font-family: arial, sans-serif;'>GESTIÓN NOTA DE CRÉDITO (RECHAZADA POR CRÉDITO Y COBRANZA)</h3>";
                        html_code += "</br>";
                        html_code += "<h3 style='font-family: arial, sans-serif;'>Rechazado por: " + Usuario + "</h3>";
                        html_code += "</br>";
                        html_code += "<h3 style='font-family: arial, sans-serif;'>Folio SIE nota de crédito: " + SequenceForeignKey + "</h3>";
                        html_code += "</br>";
                        html_code += "<h5 style='font-family: arial, sans-serif;'>Comentario: " + ComentarioCredito + "</h5>";
                    html_code += "</div>";
                $.ajax({
                    contentType: "application/json; charset=utf-8",
                    url: '@Url.Action("EmailSendNotaCredito", "Venta")',
                    async: false,
                    timeout: 3000,
                    type: 'POST',
                    data: '{"ToEmail":"' + ToEmail + '","ToEmail2":"' + ToEmail2 + '","ToEmail3":"' + ToEmail3 + '","ToEmail4":"' + ToEmail3 + '","FromEmail":"' + FromEmail + '","SubjectEmail":"' + SubjectEmail + '","BodyEmail":"' + html_code + '"}',
                    dataType: "json",
                }).done(function (data) {

                }).always(function (data) {
                    console.log("always executed in api AffectCreditNoteSap");
                }).fail(function (data) {
                    swal("Error en la api: EmailSendNotaCredito");
                    });
                $("#comentario-credito").val('');

                // historio de notas de credito aprobado por Credito Cobranza
                getHistoricoNotaCreditoAllStatusCredito();
            } else {
                swal("Operación cancelada");
            }
        });
    };


    // el usuario de direccin solo mostrar notas de credito por aprobar
    $(window).on('load', function () {
        $('#loading').hide();
        console.log('valor del combo' + $("#cmbEstatus").val());
    })

    let Rol = localStorage.getItem("Rol");
    let UserEmail = localStorage.getItem("UserEmail");

    //let UserEmail = "ricardo_prieto@fussionweb.com";
    //alert(UserEmail);
    if (UserEmail == "adrian_rivera@fussionweb.com") {
        getHistoricoNotaCreditoZero();
    }
    if (UserEmail == "eduardo.masso@fussionweb.com") {
        getHistoricoNotaCreditoZero();
    }
    if (UserEmail == '@System.Configuration.ConfigurationManager.AppSettings["Email.SIE.NC.Retail"]') {
        getHistoricoNotaCreditoZero();
    }

    // if (UserEmail == "rafael.massorivera@fussionweb.com") { -->
      //  <!-- getHistoricoNotaCreditoZero(); -->
	//	<!-- $("#cmbFiltros").show(); -->
    //<!-- } -->
    if (UserEmail == "ricardo_prieto@fussionweb.com") {
        $('#loading').show();
        $('#cmbFiltros').hide();
        getHistoricoNotaCreditoOne();
    }
    if (Rol == "Credito") {
        if (UserEmail == '@System.Configuration.ConfigurationManager.AppSettings["EmailCreditoCobranza"]') {
            getHistoricoNotaCreditoAllStatusCredito();
        }
        else {
            getHistoricoNotaCreditoCobranzaOne();
        }
       // getHistoricoNotaCreditoCobranzaOne();
    }

    if (UserEmail == 'rafael_masso@fussionweb.com' || UserEmail == 'luis@interdev.mx' || UserEmail == 'daniel@interdev.mx'  || UserEmail == 'rafael.massorivera@fussionweb.com') {
        //UserEmail = 'rafael_masso@fussionweb.com';
        console.log(UserEmail);
        $("#cmbEstatus").val(2);//Aprobacion pendiente por dirección
        getHistoricoNotaCreditoAllStatusDireccion();
        $("#cmbFiltros").show();

    }

</script>
<script>

    nc_row_inventarioarticuloalmacen_actualizar = [];
    function agregarNotaCreditoInventarioAlmacen_actualizar(NotaCreditoArrayAlmacen, CodeArticulo, cantidad) {

        var item = nc_row_inventarioarticuloalmacen_actualizar.find(item => item.Articulo === CodeArticulo);
        console.log('agregarNotaCreditoInventarioAlmacen_actualizar item ' + JSON.stringify(item));
        if (item != null) {

            objIndex = nc_row_inventarioarticuloalmacen_actualizar.findIndex((obj => obj.Articulo == CodeArticulo));

            //Log object to Console.
            console.log("Before update: ", nc_row_inventarioarticuloalmacen_actualizar[objIndex])

            //Update object's name property.
            nc_row_inventarioarticuloalmacen_actualizar[objIndex].ItemNcAlmacen = NotaCreditoArrayAlmacen;

            //Log object to console again.
            console.log("After update: ", nc_row_inventarioarticuloalmacen_actualizar[objIndex])
        }
        else {
            var res = {
                ItemNcAlmacen: NotaCreditoArrayAlmacen,
                Articulo: CodeArticulo,
                Cantidad: cantidad,
            }
            nc_row_inventarioarticuloalmacen_actualizar.splice(0, 0, res);
            console.log(JSON.stringify(nc_row_inventarioarticuloalmacen_actualizar));
        }
    }

    var nc_row_inventarioarticuloalmacen = [];
    function agregarNotaCreditoInventarioAlmacen(CodeNotaCredito, CodeArticulo, CodeAlmacen, cantidad,contador) {
        var res = {
            FolioNotaCredito: CodeNotaCredito,
            Articulo: CodeArticulo,
            Almacen: CodeAlmacen,
            Cantidad: cantidad,
            IndexRow: contador
        }
        nc_row_inventarioarticuloalmacen.splice(0, 0, res);
        console.log(JSON.stringify(res));
    }

    function cambiar(CodeNotaCredito, CodeArticulo, contador) {
        let CodeAlmacen = $('#cmbAlmacenPartida-' + CodeArticulo + '-' + contador + ' option:selected').val()

        $.each(nc_row_inventarioarticuloalmacen, function (index, value) {
            if (value.FolioNotaCredito == CodeNotaCredito && value.Articulo == CodeArticulo && value.IndexRow == contador) {
                nc_row_inventarioarticuloalmacen[index].Almacen = CodeAlmacen;
                //console.log(nc_row_inventarioarticuloalmacen);
            }
        });
    }


    function getDegloseAlmacenPardida(FolioNotaCredito, ItemCode, ItemCodeCount, tipo) {

        let estatus = $("#usuario-almacen-estatus").val();
        let TDocument = $("#usuario-almacen-tipodocumento").val();

        if (Number(estatus) != 1 && TDocument == 'I' && Number(tipo) == 0) {
            $("#detalleAlmacenPartida").toggle();
            swal("Estatus no valido para desglose de partidas, contactar a administrador");
            return;
        }


        recargarvaloresAlmacenPartida();
        loadAlmacenes();

        getNotaCreditoItemAlmacen(FolioNotaCredito, ItemCode);

        $('#gestion-almacen-folioNC-partida').val(FolioNotaCredito);
        $('#gestion-almacen-articulo-partida').val(ItemCode);
        $('#gestion-almacen-articulo-partida-cantidadoriginal').val(ItemCodeCount);

        $('#gestion-almacen-articulo-partida-value').val(ItemCode);
        $('#gestion-almacen-articulo-partida-cantidad-value').val(ItemCodeCount);

        // desglosar el detalle seleccionado
        if (tipo == 0) {

            $('#gestion-almacen-generar-partida-continuar').show();
            $('#gestion-almacen-generar-partida').show();

            var item = nc_row_inventarioarticuloalmacen_actualizar.find(item => item.Articulo === ItemCode);

            let registerEncontrado = jQuery.isEmptyObject(item.ItemNcAlmacen);

            if (item != null && registerEncontrado) {
                console.log(JSON.stringify(arrayNotaCreditoItemCodeAlmacen));

                item = arrayNotaCreditoItemCodeAlmacen.find(item => item.Articulo === ItemCode);

            }

            console.log('registerEncontrado ' + registerEncontrado);
            let message = '';

            if (item != null) {
                console.log('entro para partida');
                swal({
                    title: "Se ha encontrado referencias de deglose realizado  " + ItemCode,
                    text: "¿Desea continuar?, ya que se tendra que realizar desde cero el desglose de partidas.",
                    icon: "warning",
                    buttons: true,
                    dangerMode: true,
                }).then((willDelete) => {
                    if (willDelete) {

                        $.each(arrayNotaCreditoItemCodeAlmacen, function (index1, value1) {

                            $.ajax({
                                contentType: "application/json; charset=utf-8",
                                url: '@Url.Action("DeleteNotaCreditoArticuloAlmacenPartida_Eliminar", "Venta")',
                                async: false,
                                timeout: 3000,
                                type: 'POST',
                                data: '{"NotaCredito":"' + value1.FolioNotaCredito + '","articulo":"' + value1.Articulo + '","almacen":"' + value1.Almacen + '","cantidad":"' + value1.Cantidad + '","orden":"' + value1.Orden + '"}',
                                dataType: "json",
                                success: function (data) {
                                    if (data != null) {
                                        if (data.Context == 1) {
                                            //console.log(' IdError '+data.Context+' FolioNotaCredito ' + value.FolioNotaCredito + ' Articulo ' + value.Articulo + ' Almacen ' + value.Almacen);
                                        }
                                        else {
                                            message = message + data.Context.Message;
                                        }
                                    }
                                }
                            });
                        });

                        if (message != '') {
                            swal("Ocurrio un error api: UpdateNotaCreditoAlmacenPartida_Actualizar " + message);
                        }
                        else {
                            nc_row_inventarioarticuloalmacen_actualizar.splice($.inArray(tem => item.Articulo === ItemCode, nc_row_inventarioarticuloalmacen_actualizar), 1);
                            //console.log(JSON.stringify(nc_row_inventarioarticuloalmacen_actualizar));
                        }
                    }
                    else {
                        swal("Operacion cancelada");
                        $('#detalleAlmacenPartida').modal('toggle');
                    }
                });
            }
        }
        if (tipo == 1) {

            $('#gestion-almacen-generar-partida-continuar').hide();
            $('#gestion-almacen-generar-partida').hide();

            let htmlBodyAlmacenpartida = '';
            let sum = 0;
            if (arrayNotaCreditoItemCodeAlmacen.length > 0) {
                $.each(arrayNotaCreditoItemCodeAlmacen, function (index1, value) {

                    $.each(ItemArrayPartidaAlmacen, function (index, valuerow) {

                        if (value.Almacen == valuerow.Identifier) {
                            htmlBodyAlmacenpartida = htmlBodyAlmacenpartida + "<option selected value='" + valuerow.Identifier + "'>" + valuerow.Nombre + "</option>";
                        }
                        else {
                            htmlBodyAlmacenpartida = htmlBodyAlmacenpartida + "<option value='" + valuerow.Identifier + "'>" + valuerow.Nombre + "</option>";
                        }
                    });

                    $("#tabla-invoice-detalle-almacen-partidas").append(
                        "<tr id=tr" + value.Orden + ">\
                            <td>" + value.Articulo + "</td>\
                            <td style='text-align: center;'><input disabled id='idrowcantidad-"+ value.Orden + "' type='text' onkeypress='return valideKey(event);'  maxlength='5' onkeyup='validarCantidadAlmacenPartida(event," + value.Cantidad + ")' class='sub-total-detail-gestion-credito' value='" + value.Cantidad + "' style='text-align:center;' /></td>\
                            <td class='unselectable' style='text-align: center;'>\
                                <div class='form-group'>\
                                    <div class='input-group'>\
                                        <select disabled name='cmbAlmacenPartida-"+ value.Articulo + "-" + value.Orden + "' id='cmbAlmacenPartida-" + value.Articulo + "-" + value.Orden + "' onchange=cambiar(" + value.Identifier + ",'" + value.Articulo + "'," + value.Orden + ") class='form-control'>\
                                            "+ htmlBodyAlmacenpartida + "\
                                        </select>\
                                     </div>\
                                </div>\
                            </td>\
                            <td align='center'>\
                                <a class='btn btn-primary btnDelete invisible' disabled onclick=removerAlmacenPartida("+ value.IndexRow + ") href='#'>\
                                    <i class='fa fa-trash' disabled aria-hidden='true'></i>\
                                </a>\
                            </td>\
                        </tr>");
                    sum = sum + Number(value.Cantidad);
                });

                $('#gestion-almacen-articulo-partida-cantidad-utilizado').text('Cantidad utilizada: ' + sum);
            }
        }
    }

    arrayNotaCreditoItemCodeAlmacen = [];
    function getNotaCreditoItemAlmacen(FolioNotaCredito, Articulo) {
        $.ajax({
            contentType: "application/json; charset=utf-8",
            url: '@Url.Action("GetNotaCreditoItemAlmacen", "Venta")',
            async: false,
            timeout: 3000,
            type: 'POST',
            data: '{"NotaCredito":"' + FolioNotaCredito + '","Articulo":"' + Articulo + '"}',
            dataType: "json",
            success: function (data) {
                if (data != null) {
                    arrayNotaCreditoItemCodeAlmacen = data.Context;
                }
            }
        });
    }

    function recargarvaloresAlmacenPartida() {
        $('#gestion-almacen-folioNC-partida').val('');
        $('#gestion-almacen-articulo-partida').val('');
        $('#gestion-almacen-articulo-partida-cantidadoriginal').val('');
        $('#gestion-almacen-articulo-partida-cantidadactual').val('');

        $('#gestion-almacen-articulo-partida-value').val('');
        $('#gestion-almacen-articulo-partida-cantidad-value').val('');
        $('#gestion-almacen-articulo-partida-cantidad-utilizado').text('');

        $("#tabla-invoice-detalle-almacen-partidas").html('');

        // resetear valores
        nc_row_inventarioarticuloalmacen = [];
    }

    let ItemArrayPartidaAlmacen = [];

    function loadAlmacenes() {

        $.ajax({
            contentType: "application/json; charset=utf-8",
            url: '@Url.Action("ObtenerAlmacenPartidas", "Venta")',
            async: false,
            timeout: 3000,
            type: 'POST',
            data: '{}',
            dataType: "json",
            success: function (data) {
                //console.log(JSON.stringify(data));
                if (data != null && $.isArray(data.Context)) {
                    ItemArrayPartidaAlmacen = data.Context;
                }
            }, error: function (data) {
               // console.log(JSON.stringify(data));
            }
        });



    }

    function valideKey(evt, index) {

        var code = (evt.which) ? evt.which : evt.keyCode;

        if (code == 8) { // backspace.
            return true;
        } else if (code >= 48 && code <= 57) { // is a number.
            return true;
        } else { // other keys.
            return false;
        }
    }

    let contadorAlmacen = 0;

    function agregarpartidaItemAlmacen() {

        let FolioNotaCredito = $('#gestion-almacen-folioNC-partida').val();
        let ItemCode = $('#gestion-almacen-articulo-partida').val();

        let cantidadoriginal = $('#gestion-almacen-articulo-partida-cantidadoriginal').val();
        let cantidadactual = $('#gestion-almacen-articulo-partida-cantidadactual').val();

        //console.log('cantidadoriginal ' +cantidadoriginal);
        //console.log('cantidadactual ' + cantidadactual);

        if (cantidadoriginal == cantidadactual && cantidadoriginal != 1) {
            swal('Advertencia','Has superado la cantidad para desglosar las partidas del articulo seleccionado','warning');
            return;
        }

        if (ItemArrayPartidaAlmacen.length == 0) {
            swal('Ocurrio un error no se cargo los datos correctamente para deglosar los almacenes para las partidas');
            return;
        }

        let ItemRowAlmacen = ItemArrayPartidaAlmacen[0];

        let htmlBodyAlmacenpartida = '';

        $.each(ItemArrayPartidaAlmacen, function (index, value) {
            if (value.Identifier != 'CEDIS') {
                htmlBodyAlmacenpartida = htmlBodyAlmacenpartida + "<option value='" + value.Identifier + "'>" + value.Nombre + "</option>";
            }
        });


        $("#tabla-invoice-detalle-almacen-partidas").append(
            "<tr id=tr" + contadorAlmacen+">\
                <td>" + ItemCode + "</td>\
                <td style='text-align: center;'><input id='idrowcantidad-"+ contadorAlmacen+"' type='text' onkeypress='return valideKey(event);'  maxlength='5' onkeyup='validarCantidadAlmacenPartida(event,"+ contadorAlmacen+")' class='sub-total-detail-gestion-credito' value='" + 0 + "' style='text-align:center;' /></td>\
                <td style='text-align: center;'>\
                    <div class='form-group'>\
                        <div class='input-group'>\
                            <select name='cmbAlmacenPartida-"+ ItemCode + "-" + contadorAlmacen + "' id='cmbAlmacenPartida-" + ItemCode + "-" + contadorAlmacen +"' onchange=cambiar(" + FolioNotaCredito + ",'" + ItemCode + "',"+contadorAlmacen+") class='form-control'>\
                                <option selected value='"+ ItemRowAlmacen.Identifier + "'>" + ItemRowAlmacen.Nombre + "</option>\
                                    "+ htmlBodyAlmacenpartida +"\
                            </select>\
                         </div>\
                    </div>\
                </td>\
                <td align='center'>\
                    <a class='btn btn-primary btnDelete' onclick=removerAlmacenPartida("+ contadorAlmacen+") href='#'>\
                        <i class='fa fa-trash' aria-hidden='true'></i>\
                    </a>\
                </td>\
            </tr>");
        agregarNotaCreditoInventarioAlmacen(FolioNotaCredito, ItemCode, ItemRowAlmacen.Identifier, cantidadactual, contadorAlmacen);
        contadorAlmacen++;
    }

    function removerAlmacenPartida(index) {
        let CantidadAgregadaActual = $('#gestion-almacen-articulo-partida-cantidadactual').val();
        let CantidadCapturada = $("#idrowcantidad-" + index + "").val();

        if (Number(CantidadCapturada) != 0) {
            let suma = Number(CantidadAgregadaActual) - Number(CantidadCapturada);
            //console.log(suma);
            $("#idrowcantidad-" + index + "").val('');

            if (suma <= 0) {
                suma = 0;
            }

            $('#gestion-almacen-articulo-partida-cantidadactual').val(suma);
        }
        else {
            $('#gestion-almacen-articulo-partida-cantidadactual').val('');
        }
        if (contadorAlmacen == index) {
            contadorAlmacen--;
        }
        $("#tr" + index + "").remove();

    }

    function validarCantidadAlmacenPartida(event, indexRow) {

        let cantidadOriginal = $('#gestion-almacen-articulo-partida-cantidadoriginal').val();
        let cantidadActualSumada = $('#gestion-almacen-articulo-partida-cantidadactual').val();

        let suma = 0, sumaAux = 0;

        let cantidadCapturada = event.target.value;

        $.each(nc_row_inventarioarticuloalmacen, function (index, value) {
            if (value.IndexRow == indexRow) {
                if (Number(cantidadActualSumada) <= Number(cantidadOriginal)) {
                    value.Cantidad = cantidadCapturada;
                }
                else {
                    //console.log('cantidad superada ' + suma);
                }
            }
            suma = suma + Number(value.Cantidad);
        });

        //let cantidadNueva = 0;
        if (suma > Number(cantidadOriginal)) {
            sumaAux = suma - Number(cantidadOriginal);
            // cant = 50 - cantidad
            let cantidadNueva = Number(cantidadCapturada) - sumaAux;
            event.target.value = cantidadNueva;
            $('#gestion-almacen-articulo-partida-cantidadactual').val(cantidadOriginal);
            $('#gestion-almacen-articulo-partida-cantidad-utilizado').text('Cantidad utilizado: ' + cantidadOriginal);
            actualiarArrayPartidaAlmacen(cantidadNueva, indexRow)
        }
        else {
            if (suma > 0) {
                $('#gestion-almacen-articulo-partida-cantidadactual').val(suma);
                $('#gestion-almacen-articulo-partida-cantidad-utilizado').text('Cantidad utilizado: ' + suma);
            }
        }
    }

    function actualiarArrayPartidaAlmacen(cantidad, indexRow) {
        $.each(nc_row_inventarioarticuloalmacen, function (index, value) {
            if (value.IndexRow == indexRow) {
                value.Cantidad = cantidad
            }
        });
        //console.log(JSON.stringify(nc_row_inventarioarticuloalmacen));
    }

    function continuarAgregarPartidaAlmacen() {
        let TDocument = $("#usuario-almacen-tipodocumento").val();

        if (nc_row_inventarioarticuloalmacen.length == 0) {
            swal('Advertencia', 'No se ha definido las partidas del articulo actual, reintentar de nuevo', 'error');
            return;
        }

        let cantidadOriginal = $('#gestion-almacen-articulo-partida-cantidadoriginal').val();
        let cantidadActualSumada = $('#gestion-almacen-articulo-partida-cantidadactual').val();



        let suma = Number(cantidadOriginal) - Number(cantidadActualSumada);

        if (Number(cantidadOriginal) == Number(cantidadActualSumada)) {
            ActualizarNotaCreditoArticuloAlmacen();

            if (TDocument == 'I') {
                let itemcode = $("#gestion-almacen-articulo-partida").val();
                $('#almacen-mensaje-almacen-partida-desglosada').text('Partidas deglosadas para el articulo ' + itemcode);
            }
            $('#detalleAlmacenPartida').modal('toggle');
        }
        else {
            swal('Advertencia', 'No se ha definido el desglose la cantidad de partida, articulos faltantes para partida: ' + suma + ' ', 'error');
            return;
        }

    }

    function ActualizarNotaCreditoArticuloAlmacen()
    {

        let cantidad = 0;
        let cantidadOriginal = $('#gestion-almacen-articulo-partida-cantidadoriginal').val();
        let cantidadActualSumada = $('#gestion-almacen-articulo-partida-cantidadactual').val();
        let articuloCode = $('#gestion-almacen-articulo-partida').val();
        if (Number(cantidadOriginal) == Number(cantidadActualSumada)) {
            cantidad = cantidadActualSumada;
        }


        let message = '';
        if (nc_row_inventarioarticuloalmacen.length > 0) {
            //console.log(nc_row_inventarioarticuloalmacen);

            $.each(nc_row_inventarioarticuloalmacen, function (index, value) {
                if (value != null) {

                    $.ajax({
                        contentType: "application/json; charset=utf-8",
                        url: '@Url.Action("AddNotaCreditoArticuloAlmacenPartida", "Venta")',
                        async: false,
                        timeout: 3000,
                        type: 'POST',
                        data: '{"NotaCredito":"' + value.FolioNotaCredito + '","articulo":"' + value.Articulo + '","almacen":"' + value.Almacen + '","cantidad":"' + value.Cantidad + '","orden":"' + value.IndexRow + '"}',
                        dataType: "json",
                        success: function (data) {
                            if (data != null) {
                                if (data.Context == 1) {
                                    //console.log(' IdError '+data.Context+' FolioNotaCredito ' + value.FolioNotaCredito + ' Articulo ' + value.Articulo + ' Almacen ' + value.Almacen);
                                }
                                else {
                                    message = message + data.Context.Message;
                                }
                            }
                        }
                    });
                }
            });
            if (message != '') {
                swal("Ocurrio un error api: AddNotaCreditoArticuloAlmacenPartida " + message);
            }
            else {
                agregarNotaCreditoInventarioAlmacen_actualizar(nc_row_inventarioarticuloalmacen, articuloCode, cantidad);
            }
        }
    }


    // actualizar los estatus al momento de aprobar la nota de credito almacen
    function actualizarNotaCreditoAlmacenAgregado() {

        if (nc_row_inventarioarticuloalmacen_actualizar.length == 0) {
            swal('Advertencia', 'No se ha definido las partidas del articulo actual, reintentar de nuevo', 'error');
            $('#detalleAlmacenPartida').modal('show');
            return;
        }

        let cantidadOriginal = $('#gestion-almacen-articulo-partida-cantidadoriginal').val();
        let cantidadActualSumada = $('#gestion-almacen-articulo-partida-cantidadactual').val();

        let suma = Number(cantidadOriginal) - Number(cantidadActualSumada);

        if (Number(cantidadOriginal) == Number(cantidadActualSumada)) {

            UpdateNotaCreditoAlmacenPartida_Actualizar();
        }
        else {
            swal('Advertencia', 'No se ha definido el desglose la cantidad de partida, articulos faltantes para partida: ' + suma + ' ', 'error');
            return;
        }
    }

    // actualiza a estatus 1 los registrados anteriormente
    function UpdateNotaCreditoAlmacenPartida_Actualizar() {

        let message = '';

        if (nc_row_inventarioarticuloalmacen_actualizar.length > 0) {
            //console.log(nc_row_inventarioarticuloalmacen);

            $.each(nc_row_inventarioarticuloalmacen_actualizar, function (index, value) {

                $.each(value.ItemNcAlmacen, function (index1, value1) {

                    if (value1 != null) {

                    $.ajax({
                        contentType: "application/json; charset=utf-8",
                        url: '@Url.Action("UpdateNotaCreditoArticuloAlmacenPartida_Actualizar", "Venta")',
                        async: false,
                        timeout: 3000,
                        type: 'POST',
                        data: '{"NotaCredito":"' + value1.FolioNotaCredito + '","articulo":"' + value1.Articulo + '","almacen":"' + value1.Almacen + '","cantidad":"' + value1.Cantidad + '","orden":"' + value1.IndexRow + '"}',
                        dataType: "json",
                        success: function (data) {
                            if (data != null) {
                                if (data.Context == 1) {
                                    //console.log(' IdError '+data.Context+' FolioNotaCredito ' + value.FolioNotaCredito + ' Articulo ' + value.Articulo + ' Almacen ' + value.Almacen);
                                }
                                else {
                                    message = message + data.Context.Message;
                                }
                            }
                        }
                    });
                }
                });
            });
            if (message != '') {
                swal("Ocurrio un error api: UpdateNotaCreditoAlmacenPartida_Actualizar " + message);
            }

        }
    }

</script>