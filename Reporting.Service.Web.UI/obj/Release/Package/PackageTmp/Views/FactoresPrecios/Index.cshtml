<style>
    .errorMsg {
        color: red;
    }
</style>
<section class="content-header">
    <h1>
        Productos
        <small>Gestión de factores de precios</small>
    </h1>
    <ol class="breadcrumb">
        <li><a href="#"><i class="fa fa-dashboard"></i> Precios </a></li>
        <li class="active"> Factores precios</li>
        <li class="active">APG</li>
    </ol>
</section>

<section class="content">
    <div class="row">
        <div class="col-md-12">
            <div class="box box-default">
                <div class="box-header with-border">
                    <i class="fa fa-money"></i>
                    <h3 class="box-title">Administración de factores de precios</h3>
                </div>
                <!-- /.box-header -->
                <div class="box-body">
                    <div class="col-md-6">
                        <table id="datosFactores" class="table table-bordered table-striped" style="text-align:center">
                            <thead>
                                <tr>
                                    <th class="th-stationery" width="20%">Tipo de precio </th>
                                    <th class="th-stationery" width="30%">Canal</th>
                                    <th class="th-stationery" width="20%">Factor</th>
                                    <th class="th-stationery" width="20%">Editar</th>

                                </tr>
                            </thead>
                            <tbody id="bodyTablaFactores"></tbody>
                        </table>
                        <div id="cargando" style="display:none;" class="overlay">
                            <i class="fa fa fa-refresh fa-spin"></i>
                        </div>

                    </div>
                    <div class="col-md-6">


                        <div class="box box-danger">
                            <div class="box-header with-border">
                                <h3 class="box-title">Agregar Factor</h3>
                                <div class="box-tools pull-right">
                                    <button type="button" class="btn btn-box-tool" data-widget="collapse">
                                        <i class="fa fa-minus"></i>
                                    </button>
                                </div>
                                <!-- /.box-tools -->
                            </div>
                            <!-- /.box-header -->
                            <div class="box-body">                                

                                    <div class="row">
                                        <label for="cmbTiposPrecios" class="col-sm-4" control-label">Tipo de precio:</label>
                                        <div class="col-sm-4">
                                            <select class="form-control" id="cmbTiposPrecios" name="cmbTiposPrecios">
                                                <option value="0">Seleccione un tipo de precio </option>
                                            </select>
                                            <span class="errorMsg " id="spanTipos" hidden="hidden"></span>
                                        </div>
                                        <div class="col-sm-4">
                                            <button class="btn btn-success" data-toggle='modal' href='#modalTipoPrecio'><i class="fa fa-plus"></i></button>&nbsp;<label>Agregar</label>

                                        </div>
                                    </div>
                                    <br />
                                    <br />

                                    <div class="row">
                                        <label for="cmbCanales" class="col-sm-4 control-label">Tipo de canal:</label>
                                        <div class="col-sm-4">
                                            <select class="form-control" id="cmbCanales" name="cmbCanales">
                                                <option value="0">Seleccione un tipo de canal </option>
                                            </select>
                                            <span class="errorMsg " id="spanCanal" hidden="hidden"></span>
                                        </div>
                                        <div class="col-sm-4">
                                            @*<button class="btn btn-success" data-toggle='modal' href='#modalCanales'><i class="fa fa-plus"></i></button>&nbsp;<label>Agregar</label>*@
                                        </div>
                                    </div>
                                    <br />
                                    <br />

                                    <div class="row">
                                        <label for="correo" class="col-sm-4 control-label">Factor:</label>
                                        <div class="col-sm-4">
                                            <input type="text" class="form-control" id="nuevoFactor" name="factor">
                                            <span class="errorMsg " id="spanFactor" hidden="hidden"></span>
                                        </div>
                                        <br />
                                        <br />
                                        <button class="btn btn-primary pull-right" onclick="guardarFactor()">Guardar</button>
                                    </div>
                                   
                                   
                              
                            </div>
                            <!-- /.box-body -->
                        </div>
                        <!-- /.box -->
                    </div>

                </div>
                <!-- /.box-body -->
            </div>
            <!-- /.box -->
        </div>
       
        <!-- /.col -->
    </div>
    <div class="modal fade" id="modalTipoPrecio" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title">Agragar Nuevo Tipo de Precio</h4>
                </div>
                <div class="modal-body">
                   
                        <div class="box-body">
                            <div class="form-group">
                                <label class="col-sm-4 control-label">Tipo de precio:</label>
                                <div class="col-sm-8">
                                    <input class="form-control" id="tipoPrecio" placeholder="Ej.NUEVO,LINEA,OFERTA,etc." type="text" autocomplete="off" onkeyup="mayus(this);" />
                                    <span class="errorMsg " id="spanTipoPrecio" hidden="hidden"></span>
                                </div>
                            </div>
                        </div>

                    
                </div>
                <div class="modal-footer">
                    <button type="button" id="cerrarModalTipo"class="btn btn-danger pull-left" data-dismiss="modal">Cancelar</button>
                    <button type="button" id="guardarTipoPrecio" class="btn btn-success pull-right" onclick="guardarTipoPrecioArticulo()">Guardar</button>

                </div>
            </div>
        </div>
    </div>
    @*<div class="modal fade" id="modalCanales" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title">Agregar Nuevo Canal </h4>
                </div>
                <div class="modal-body">
                   
                        <div class="box-body">
                            <div class="form-group">
                                <label class="col-sm-2 control-label">Descripción:</label>
                                <div class="col-sm-10">
                                    <input class="form-control" id="nuevoCanal" placeholder="Ej.Franquicia Mayoreo, Precio WEB Foraneo, Precio Sucursal Local " type="text" autocomplete="off"  />
                                    <span class="errorMsg " id="spanNuevoCanal" hidden="hidden"></span>
                                </div>
                            </div>
                        </div>
                        <div class="box-body">
                            <div class="form-group">
                                <label class="col-sm-2 control-label">Abreviatura: </label>
                                <div class="col-sm-10">
                                    <input class="form-control" id="idCanal" placeholder="Ej.FM,PWF,PSL" type="text" autocomplete="off" onkeyup="mayus(this)" />
                                    <span class="errorMsg " id="spanIdCanal" hidden="hidden"></span>
                                </div>
                            </div>
                        </div>

               
                </div>
                <div class="modal-footer">
                    <button type="submit" id="guardarCanal" class="btn btn-success pull-right" onclick="guardarTipoCanal()">Guardar</button>
                    <button type="button" id="cerrarModalCanal" class="btn btn-danger pull-left" data-dismiss="modal">Cancelar</button>
                </div>
            </div>
        </div>
    </div>*@
    <div class="modal fade" id="modalEdicion" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title">Editar Factor </h4>
                </div>
                <div class="modal-body">
                    <input id="edicionIdFactor" type="hidden" />
                    <div class="box-body">
                        <div class="form-group">
                            <label class="col-sm-2 control-label">TipoPrecio:</label>
                            <div class="col-sm-10">
                                <input class="form-control" id="edicionTipoPrecio" type="text" autocomplete="off" disabled />
                            </div>
                        </div>
                    </div>
                    <div class="box-body">
                        <div class="form-group">
                            <label class="col-sm-2 control-label">Canal: </label>
                            <div class="col-sm-10">
                                <input class="form-control" id="edicionCanal" type="text" autocomplete="off" disabled />
                            </div>
                        </div>
                    </div>
                    <div class="box-body">
                        <div class="form-group">
                            <label class="col-sm-2 control-label">Factor: </label>
                            <div class="col-sm-10">
                                <input class="form-control" id="edicionFactor" type="text" autocomplete="off" />
                                <span class="errorMsg " id="spanEdicionFactor" hidden="hidden"></span>
                            </div>
                        </div>
                    </div>

                </div>
                <div class="modal-footer">
                    <button type="submit" id="actualizarFactor" class="btn btn-success pull-right" onclick="actualizarFactor()">Actualizar</button>
                    <button type="button" id="cerrarModalEdicion" class="btn btn-danger pull-left" data-dismiss="modal">Cancelar</button>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
    var expSoloLetra = "^[a-z A-Z\u00f1\u00d1\u00E0-\u00FC]{2,50}$";
    var expDecimal = /^[0-9]+([.])?([0-9]+)?$/;
    var seleccionadoTipo;
    var seleccionadoCanal;
    var arregloTipoPrecioArticulo = new Array();
    var arregloTipoPrecioCanal = new Array();
    var arregloAbreviado = new Array();
    var arregloFactores = new Array();
    /**
    *Funcion Jquery, se ejecuta una vez que el DOM esta listo
    *returns void
    */
    $(document).ready(function () {

        $("#guardarTipoPrecio").click(function (event) {
            event.preventDefault();
        })       
        cargarTipoPrecioArticulos();
        cargarTipoPrecioCanal();
        cargarFactores();
    });
    /**
    *Funcion cargar factores de BD y llenar tabla de factores
    *returns void
    */
    function cargarFactores() {
        $('#cargando').show();
        $.ajax({
            contentType: "application/json; charset=utf-8",
            url: '@Url.Action("GetFactores", "FactoresPrecios")',
            async: false,
            timeout: 4000,
            type: 'POST',
            data: null,
            dataType: "json",
            success: function (data) {
               
                if (data != null && $.isArray(data.Context)) {
                    
                    let tablaFactores = $('#datosFactores').DataTable();
                    $("#bodyTablaFactores").empty();
                    tablaFactores.destroy();                  

                    $.each(data.Context, function (index, value) {
                       
                        $("#bodyTablaFactores").append(
                            "<tr>\
                                <td>" + data.Context[index].TipoPrecioArticulo.Descripcion + "</td>\
                                <td>" + data.Context[index].TipoPrecioCanal.Descripcion + "</td>\
                                <td>" + data.Context[index].Factor + "</td>\
                                <td> <button class='btn btn - primary' data-toggle='modal' data-target='#modalEdicion' onclick='modificarFactor(" + data.Context[index].Identifier + ',' + data.Context[index].Factor + ',"' + data.Context[index].TipoPrecioArticulo.Descripcion + '","' + data.Context[index].TipoPrecioCanal.Descripcion + '"' +")' ><i class='fa  fa-edit - square - o>'</i></button></td>\
                            </tr>");
                    });                                   

                    $('#datosFactores').dataTable({
                        "paging": true,
                        "searching": true,
                        "language": {
                            "url": "//cdn.datatables.net/plug-ins/1.10.13/i18n/Spanish.json"
                        }
                    });
                    $('#cargando').hide();
               
                    
                }
            },
            error: function () {
                alert("Error al cargar datos de factores ");
            }
        });
    }
    /**
    *Funcion cargarTipoPrecioArticulos para cargar el select tipos de precios
    *returns void
    */
    function cargarTipoPrecioArticulos() {
        $.ajax({
            contentType: "application/json; charset=utf-8",
            url: '@Url.Action("GetTipoPrecioArticulos", "FactoresPrecios")',
            async: true,
            type: 'POST',
            data: '{}',
            dataType: "json",
            success: function (data) {

                if (data != null && $.isArray(data.Context)) {

                    let selectTipos = $("#cmbTiposPrecios");
                    selectTipos.empty();
                    selectTipos.append(
                        '<option selected value=0 >Selecciona un tipo...</option>'
                    );
                    $.each(data.Context, function (index, value) {
                        let tipoPrecioArticulo = value.Descripcion.trim()
                        arregloTipoPrecioArticulo.push(tipoPrecioArticulo)
                        
                        selectTipos.append(
                            "<option value=" + value.Identifier + ">" + value.Descripcion + "</option>")
                    });
                    
                }
            },
            error: function () {
                swal("Error al cargar los tipos de precio");
            }
        });
    }
    /**
    *Funcion cargarTipoPrecioCanal para cargar el select tipos de canales
    *returns void
    */
    function cargarTipoPrecioCanal() {

         $.ajax({
            contentType: "application/json; charset=utf-8",
            url: '@Url.Action("GetTipoPrecioCanales", "FactoresPrecios")',
            async: true,
            type: 'POST',
            data: '{}',
            dataType: "json",
            success: function (data) {

                if (data != null && $.isArray(data.Context)) {

                    let selectCanales = $("#cmbCanales");
                    selectCanales.empty();
                    selectCanales.append(
                        '<option selected value=0 >Selecciona un canal...</option>'
                    );
                    $.each(data.Context, function (index, value) {
                        let tipoPrecioCanal = value.Descripcion.trim()
                        let abreviado = value.Identifier.trim()
                        arregloTipoPrecioCanal.push(tipoPrecioCanal)
                        arregloAbreviado.push(abreviado)

                        //selectCanales.append(
                        //    "<option value=" + value.Identifier + ">" + value.Descripcion + "</option>")
                    });
                    
                }
            },
            error: function () {
                swal("Error al cargar los canales");
            }
        });
    }
    /**
    *Funcion guardarTipoPrecioArticulo Guarda los nuevos tipo de precio de articulos
    *returns void
    */
    function guardarTipoPrecioArticulo() {
        let tipoPrecio = $('#tipoPrecio').val().trim();
        //tipoPrecio = tipoPrecio
        $('#spanTipoPrecio').text("");

        if (tipoPrecio != '' && validaInput("#tipoPrecio", expSoloLetra)) {

            if (arregloTipoPrecioArticulo.includes(tipoPrecio)) {

                mostrarError("#spanTipoPrecio", "Este tipo de precio ya existe")

            } else {
                quitarError("#spanTipoPrecio")
                swal({
                title: "¿Confirmar?",
                text: "Estas a punto de crear un nuevo tipo de precio",
                icon: "warning",
                buttons: [
                    'No, cancelar esta operación',
                    'Si, estoy seguro'
                ],
                dangerMode: true,
                 }).then(function (isConfirm) {
                    if (isConfirm) {
                        $.ajax({
                            contentType: "application/json; charset=utf-8",
                            url: '@Url.Action("AddTipoPrecio", "FactoresPrecios")',
                            async: false,
                            timeout: 3000,
                            type: 'POST',
                            data: '{"tipo":"' + tipoPrecio + '"}',
                            dataType: "json",
                            success: function (data) {
                                swal({
                                    title: 'Correcto',
                                    text: 'Se guardo con éxito ',
                                    icon: 'success',
                                    buttons: false,
                                    timer: 2000
                                })
                      
                                $('#cerrarModalTipo').click();
                                cargarTipoPrecioArticulos();
                            },
                            error: function () {
                                swal({
                                    title: 'Error',
                                    text: 'No se ha guardado',
                                    icon: 'error',
                                    buttons: false,
                                    timer: 2000
                                })
                            }
                        });
                    } else{
                        swal({
                            title: 'Cancelado',
                            text: 'Operación cancelada',
                            icon: 'error',
                            buttons: false,
                            timer: 1000
                        })
                    }
                });
            }

        } else {
            mostrarError("#spanTipoPrecio", "El tipo de precio no puede estar vacío o incluir caracteres especiales")

        }
    }
     /**
    *Funcion guardarTipoCanal Guarda los nuevos tipo de canal
    *returns void
    */
    @*function guardarTipoCanal() {
        let canal = $('#nuevoCanal').val().trim();
        let abreviatura = $('#idCanal').val().trim();
        let banderaCanalCorrecto = false;
        let banderaAbreviaturaCorrecto = false;
        
        $('#spanNuevoCanal').text("");
        $('#spanIdCanal').text("");
        //validacion para el campo de nuevo canal
        if (canal != '' && validaInput("#nuevoCanal", expSoloLetra)) {


            if (arregloTipoPrecioCanal.includes(canal)) {

                mostrarError("#spanNuevoCanal", "Este canal ya existe")
                banderaCanalCorrecto = false;
                return

            } else {
                quitarError("#spanNuevoCanal")
                banderaCanalCorrecto = true;
            }
        } else {
            mostrarError("#spanNuevoCanal", "El canal no puede estar vacío o incluir caracteres especiales")
            banderaCanalCorrecto = false;
            return
        }
        //validacion para el campo de abreviatura
        if (abreviatura != '' && validaInput("#idCanal", expSoloLetra)) {

            if (arregloAbreviado.includes(abreviatura)) {

                mostrarError("#spanIdCanal", "Esta abreviatura ya existe")
                banderaAbreviaturaCorrecto = false;
                return
            } else {
                quitarError("#spanIdCanal")
                banderaAbreviaturaCorrecto = true;
            }

        } else {
            mostrarError("#spanIdCanal", "La abrevitura no puede estar vacío o incluir caracteres especiales")
            banderaAbreviaturaCorrecto = false;
            return
        }
        //validacion campos correctos, procede a guardar
        if (banderaAbreviaturaCorrecto && banderaCanalCorrecto) {

            swal({
                title: "¿Confirmar?",
                text: "Estas a punto de crear un nuevo tipo de canal",
                icon: "warning",
                buttons: [
                    'No, cancelar esta operación',
                    'Si, estoy seguro'
                ],
                dangerMode: true,
                 }).then(function (isConfirm) {
                    if (isConfirm) {
                        $.ajax({
                            contentType: "application/json; charset=utf-8",
                            url: '@Url.Action("AddTipoCanal", "FactoresPrecios")',
                            async: false,
                            timeout: 3000,
                            type: 'POST',
                            data: '{"IDTipoPrecioCanal":"' + abreviatura + '","Descripcion":"' + canal + '"}',
                            dataType: "json",
                            success: function (data) {
                                swal({
                                    title: 'Correcto',
                                    text: 'Se guardo con éxito ',
                                    icon: 'success',
                                    buttons: false,
                                    timer: 2000
                                })
                      
                                $('#cerrarModalCanal').click();                                
                                cargarTipoPrecioCanal();
                            },
                            error: function () {
                                swal({
                                    title: 'Error',
                                    text: 'No se ha guardado',
                                    icon: 'error',
                                    buttons: false,
                                    timer: 2000
                                })
                            }
                        });
                    } else{
                        swal({
                            title: 'Cancelado',
                            text: 'Operación cancelada',
                            icon: 'error',
                            buttons: false,
                            timer: 1000
                        })
                    }
                });
        } else {
            return 
        }
    }*@
    /**
    *Funcion modificarFactor pasa los valores del factor al modal para edición
    *returns void
    */
    function modificarFactor(idFactor, factor, tipoPrecioArticulo, tipoPrecioCanal) {
        quitarError("#spanEdicionFactor");
        $('#edicionIdFactor').val(idFactor)
        $('#edicionFactor').val(factor)
        $('#edicionTipoPrecio').val(tipoPrecioArticulo)
        $('#edicionCanal').val(tipoPrecioCanal)
        
    }
    /**
    *Funcion actualizarFactor actualiza las modificaciones de los factores en BD
    *returns void
    */
    function actualizarFactor() {
        let idFactor = $('#edicionIdFactor').val();
        let factor = $('#edicionFactor').val();

        if (factor != "" && validaInput("#edicionFactor", expDecimal)) {
            quitarError("#spanEdicionFactor");
            swal({
                title: "¿Estas seguro?",
                text: "Este cambio afectara las listas de precios",
                icon: "warning",
                buttons: [
                    'No, cancelar esta operación',
                    'Si, estoy seguro'
                ],
                dangerMode: true,
            }).then(function (isConfirm) {
                if (isConfirm) {
                    $.ajax({
                        contentType: "application/json; charset=utf-8",
                        url: '@Url.Action("UpdateFactor", "FactoresPrecios")',
                        async: false,
                        timeout: 3000,
                        type: 'POST',
                        data: '{"idfactor":"' + idFactor + '","factor":"' + factor + '"}',
                        dataType: "json",
                        success: function (data) {
                            swal({
                                title: 'Correcto',
                                text: 'Se ha actualizado el factor',
                                icon: 'success',
                                buttons: false,
                                timer: 2000

                            })
                      
                            $('#cerrarModalEdicion').click();
                            document.location.reload();
                        },
                        error: function () {
                            swal({
                                title: 'Error',
                                text: 'No se ha actualizado',
                                icon: 'error',
                                buttons: false,
                                timer: 1000
                            })
                        }
                    });
                } else{
                    swal({
                        title: 'Cancelado',
                        text: 'Operación cancelada',
                        icon: 'error',
                        buttons: false,
                        timer: 1000
                    })
                }
            });

        } else {
            mostrarError("#spanEdicionFactor", "El factor no puede estar vacío o incluir letras o caracteres especiales")
            return
        }
    }
    /**
    *Funcion guardarFactor guarda los nuevos factores en BD
    *returns void
    */
    function guardarFactor() {
        let nuevoFactor = $('#nuevoFactor').val();
        let tipoCanal = $('#cmbCanales').val();
        let tipoPrecio = $('#cmbTiposPrecios').val();
        let banderaCanalCorrecto = false;
        let banderaTipoCorrecto = false;
        let banderaFactorCorrecto = false;
        let seleccionCanal = $("#cmbCanales option:selected").text();
        let selecciontipo = $("#cmbTiposPrecios option:selected").text();

        if (tipoCanal == 0) {
            mostrarError("#spanCanal", "Seleccione un tipo de canal")
            banderaCanalCorrecto = false;
            
        } else {
            quitarError("#spanCanal")
            banderaCanalCorrecto = true;

        }
        if (tipoPrecio == 0) {
            mostrarError("#spanTipos", "Seleccione un tipo de precio")
            banderaTipoCorrecto = false;
            
        } else {
            quitarError("#spanTipos")
            banderaTipoCorrecto = true;
        }
        if (nuevoFactor != "" && validaInput("#nuevoFactor", expDecimal)) {
            quitarError("#spanFactor")
            banderaFactorCorrecto = true;           

        } else {
            mostrarError("#spanFactor", "El factor no puede ir vacio,incluir letras o caracteres especiales");
            banderaFactorCorrecto = false;
            
        }

        if (banderaCanalCorrecto && banderaTipoCorrecto && banderaFactorCorrecto) {
            $.ajax({
                contentType: "application/json; charset=utf-8",
                url: '@Url.Action("FindDuplicates", "FactoresPrecios")',
                async: false,
                timeout: 3000,
                type: 'POST',
                data: '{"IDTipoPrecioArt":"' + tipoPrecio + '","IDTipoPrecioCanal":"' + tipoCanal + '"}',
                dataType: "json",
                success: function (data) {
                    if (data.Context.length>0) {
                   
                        swal({
                            title: 'Atención',
                            text: 'Ya existe este factor.\n' + selecciontipo + '  ' + seleccionCanal + '\nPuedes editarlo en la tabla. ',
                            icon: 'warning',
                            buttons: false,
                            timer: 3000
                        })


                    } else {
                        swal({
                            title: "Confirmar",
                            text: "Deseas agregar este nuevo factor",
                            icon: "warning",
                            buttons: [
                                'No, cancelar esta operación',
                                'Si, estoy seguro'
                            ],
                            dangerMode: true,
                        }).then(function (isConfirm) {
                            if (isConfirm) {
                                $.ajax({
                                    contentType: "application/json; charset=utf-8",
                                    url: '@Url.Action("AddFactor", "FactoresPrecios")',
                                    async: false,
                                    timeout: 3000,
                                    type: 'POST',
                                    data: '{"IDTipoPrecioArt":"' + tipoPrecio + '","IDTipoPrecioCanal":"' + tipoCanal + '","factor":"' + nuevoFactor + '"}',
                                    dataType: "json",
                                    success: function (data) {
                                        swal({
                                            title: 'Correcto',
                                            text: 'Se ha guardado el factor',
                                            icon: 'success',
                                            buttons: false,
                                            timer: 2000

                                        })
                                        
                                        $('#nuevoFactor').val('');
                                        document.location.reload();


                                    },
                                    error: function () {
                                        swal({
                                            title: 'Error',
                                            text: 'No se ha guardado',
                                            icon: 'error',
                                            buttons: false,
                                            timer: 2000
                                        })
                                    }
                                });
                            } else{
                                swal({
                                    title: 'Cancelado',
                                    text: 'Operación cancelada',
                                    icon: 'error',
                                    buttons: false,
                                    timer: 2000
                                })
                            }
                        });
                       
                    }
                  
                },
                error: function () {
                    swal({
                        title: 'Error',
                        text: 'Ha ocurrido un error vuelve a intentarlo',
                        icon: 'error',
                        buttons: false,
                        timer: 1000
                    })
                }
            });
        }
        



    }
    /**
    *Funcion listener para evento change del select tipo precios, busca el valor en la tabla 
    *returns void
    */
    $('#cmbTiposPrecios').on('change', function () {
        //seleccionadoTipo = '';
        //seleccionadoTipo = this.options[this.selectedIndex].innerHTML.trim();
        let IdTipoPrecioArt = $('#cmbTiposPrecios').val();
       
         $.ajax({
            contentType: "application/json; charset=utf-8",
            url: '@Url.Action("GetCanalesDisponibles", "FactoresPrecios")',
            async: true,
            type: 'POST',
             data: '{"IDTipoPrecioArt":"' + IdTipoPrecioArt + '"}',
            dataType: "json",
            success: function (data) {
                
                if (data.Context.length > 0) {
                    
                    let selectCanales = $("#cmbCanales");
                    selectCanales.empty();
                    selectCanales.append(
                        '<option selected value=0 >Selecciona un tipo...</option>'
                    );
                    $.each(data.Context, function (index, value) {

                        selectCanales.append(
                            "<option value=" + value.Identifier + ">" + value.Descripcion + "</option>")
                    });

                } else {
                    swal({
                        title: 'Atención',
                        text: 'No hay canales disponibles para este tipo',
                        icon: 'warning',
                        buttons: false,
                        timer: 2000
                    })
                }
            },
            error: function () {
                swal({
                    title: 'Error',
                    text: 'Ha ocurrido un error',
                    icon: 'error',
                    buttons: false,
                    timer: 1000
                })
            }
        });

        
      
    });
    /**
    *Funcion listener para evento change del select tipo precios, busca el valor en la tabla 
    *returns void
    */
    $('#cmbCanales').on('change', function () {
        seleccionadoCanal=''
        seleccionadoCanal = this.options[this.selectedIndex].innerHTML.trim();

    });
    /**
    *Funcion mayus convierte las letras en mayusculas
    *returns void
    */
    function mayus(e) {
        e.value = e.value.toUpperCase();
    }
    //Funcion para validar input
    function validaInput(idInput, pattern) {
        return $(idInput).val().match(pattern) ? true : false;
    }
    //Funcion para mostrar span con error de validacion
    function mostrarError(idSpan,mensajeError) {
        $(idSpan).removeAttr('hidden');
        $(idSpan).text(mensajeError);
    }
    //Funcion para quitar span con error de validacion
    function quitarError(idSpan) {
        $(idSpan).attr("hidden", "true");
    }
</script>
